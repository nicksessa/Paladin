<!DOCTYPE html>
<html lang="en">

<head>
  <title>Paladin</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


  <!-- Font Awesome JS -->
  <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
    integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
    crossorigin="anonymous"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
    integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
    crossorigin="anonymous"></script>


  <!-- Import Custom Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IM Fell English SC">

  <style>
    body {
      background: #f4511e;
      background: -webkit-linear-gradient(to right, #0099cc, #203042);
      background: linear-gradient(to right, #0099cc, #203042);
      min-height: 100vh;
      font-family: 'IM Fell English SC', serif;
    }
    
  a.anchor {
    display: block;
    position: relative;
    top: -60px;
    visibility: hidden;
  }
  </style>
</head>

<body>
  <div class="px-4 px-lg-0">
    <!-- page header -->
    <div class="container text-white py-5 text-center">
      <h1 class="display-4 mb-0">Paladin</h1>
    </div>
    <!-- End page header -->

    <div class="pb-5">
      <div class="container">

      </div>
    </div>

    <div class="pb-5">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 px-4 pt-2 bg-white rounded shadow-sm mb-5">
            <h4 id="PC_Name" class="display-5 mb-1">Sir Roland</h4>
            <div class="table-responsive">
              <table class="table" id="characterSheetTable">
                <thead>
                  <tr>
                    <th scope="col" class="border-0 bg-light">
                      <div class="p-1 px-3 text-uppercase text-center">Max HP</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="p-1 px-3 text-uppercase text-center">Current HP</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-1 text-uppercase text-center">Exp</div>
                    </th>
                  </tr>
                  <tr>
                    <td scope="col" class="border-0">
                      <div id="sheet_PC_max_HP" class="p-1 px-3 text-center">0</div>
                    </td>
                    <td scope="col" class="border-0">
                      <div id="sheet_PC_cur_HP" class="p-1 px-3 text-center">0</div>
                    </td>
                    <td scope="col" class="border-0">
                      <div id="sheet_PC_Exp" class="py-1 text-center">0</div>
                    </td>
                  </tr>
                  <tr>
                    <th scope="col" class="border-0 bg-light">
                      <div class="p-1 px-3 text-uppercase text-center">Att</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="p-1 px-3 text-uppercase text-center">DMG</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-1 text-uppercase text-center">Armor</div>
                    </th>
                  </tr>
                  <tr>
                    <td scope="col" class="border-0">
                      <div id="sheet_PC_Att" class="p-1 px-3 text-center">0</div>
                    </td>
                    <td scope="col" class="border-0">
                      <div id="sheet_PC_Dmg" class="p-1 px-3 text-center">0</div>
                    </td>
                    <td scope="col" class="border-0">
                      <div id="sheet_PC_Armor" class="py-1 text-center">0</div>
                    </td>
                  </tr>
                </thead>
                <tbody id="characterSheetTableBody">
                  <!-- Javascript fills in the table here -->
                </tbody>
              </table>
            </div> <!-- End Table container -->
          </div>
        </div>
        <div class="row">
          <!-- <a class="anchor" id="storyAnchor"></a> -->
          <div id="storyDiv" class="col-lg-12 p-4 bg-white rounded shadow-sm mb-5">
            
              
            <p>Click the button below to generate an opponent to fight!</p>
            <div class="col text-center">
              <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i
                  class="mt-2 mr-2"></i>Summon Opponent!</button>
            </div>
          </div>

        </div>


        <div class="row">
          <div class="col-lg-12 p-4 bg-white rounded shadow-sm mb-5">
            Adventure Log
            <!-- roll and results table -->
            <div class="table-responsive">
              <table class="table" id="adventureLogTable">
                <thead>
                  <tr>
                    <th scope="col" class="border-0 bg-light">
                      <div class="p-2 px-3 text-uppercase">Turn</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="p-2 px-3 text-uppercase">Roll</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase">Result</div>
                    </th>
                  </tr>
                </thead>
                <tbody id="adventureLogTableBody">
                  <!-- Javascript fills in the table here -->
                </tbody>
              </table>
            </div> <!-- End Table container -->
          </div> <!-- END column 1-->
        </div> <!-- End row -->

        <!-- third Row can go here -->

      </div> <!-- bootstrap container -->
    </div> <!-- another div setting padding bottom to 5-->
  </div> <!-- outer div setting padding x (left and right) to 4 and set large things to have padding 0 -->
  <script type="text/javascript">
  
    playerCharacter = {
      name: "Sir Roland",
      max_hp: 40,
      cur_hp: 40,
      armor: 1,
      attack: 0,
      dmg_bonus: 2,
      exp: 0,
      money: 20,
      species: "human",
      sex: "male",
      healing_potions: 2,
      alive: true
    }
    npc = [
      {
        name: "Guy of Gisborne",
        cur_hp: 25,
        armor: 1,
        dmg_bonus: 1,
        species: "human",
        sex: "male",
        alive: true
      },
      {
        name: "The Green Knight",
        cur_hp: 30,
        armor: 2,
        dmg_bonus: 2,
        species: "human",
        sex: "male",
        alive: true
      },
      {
        name: "Morgana",
        cur_hp: 30,
        armor: 1,
        dmg_bonus: 2,
        species: "human",
        sex: "female",
        alive: true
      },
      {
        name: "Mordred",
        cur_hp: 30,
        armor: 3,
        dmg_bonus: 2,
        species: "human",
        sex: "male",
        alive: true
      }
    ]
    var npc_Name = ""
    var npc_id = 0
    var combatLog = []
    var round = 1
    var initiative = "pc"
    // Start Game
    $(document).ready(function () {
      // Populate the PC stats
      updatePC()
      initGame()
    })
    function initGame() {
      round = 1
      playerCharacter.cur_hp = playerCharacter.max_hp
      playerCharacter.exp = 0
      playerCharacter.attack = 0
      playerCharacter.dmg_bonus = 2
      playerCharacter.armor = 1
      playerCharacter.healing_potions = 2
      playerCharacter.alive = true
      updatePC()
      
      $("#storyDiv").empty()
      $("#combatTableBody").empty()
      let rowString = `<p>Click the button below to generate an opponent to fight!</p>
          <div class="col text-center">
          <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i
            class="mt-2 mr-2"></i>Summon Opponent!</button>
          </div>`
      $("#storyDiv").append(rowString)
      $("#beginAdventure").off("click")
      $("#beginAdventure").on('click', function () {
        console.log("begin")
        $("#storyDiv").empty()
        //$("#storyDiv").append("<p>Your Opponent is: </p>")
        
        rollNPCTable()
      })
    }
    function updatePC() {
     
      $("#sheet_PC_max_HP").html(playerCharacter.max_hp)
      $("#sheet_PC_cur_HP").html(playerCharacter.cur_hp)
      $("#sheet_PC_Exp").html(playerCharacter.exp)
      $("#sheet_PC_Att").html(playerCharacter.attack)
      $("#sheet_PC_Dmg").html(playerCharacter.dmg_bonus)
      $("#sheet_PC_Armor").html(playerCharacter.armor)
      
    }
    function rollNPCTable() {
      round = 1
      let roll_1d4 = Math.floor(Math.random() * 4);
      console.log("NPC ID: " + roll_1d4)
      npc_name = npc[roll_1d4].name
      npc_id = [roll_1d4]
      
      $("#storyDiv").append("<p id='npcParagraph'>Your Opponent is: <strong>" + npc_name + "!!!</strong></p>")
      let rowString = `<div class="d-flex mt-2 justify-content-between">
      <button id="attackBtn" class="attackBtn btn btn-dark px-4 rounded-pill">Fight!</button>
      <button id="fleeBtn"class="innBtn btn btn-dark px-4 rounded-pill">Flee!</button>
      <button id="parlayBtn"class="innBtn btn btn-dark px-4 rounded-pill">Parlay!</button>
      </div>`
      $("#storyDiv").append(rowString)
      $("#attackBtn").off("click")
      $(document).off("click")
      $(document).on('click', '#attackBtn', function () {
      //$("#attackBtn").on('click', function() {
        console.log("fight (attackbtn) button clicked")
        //$(document.body).scrollTop($('#storyAnchor').offset().top);
        combat()
        //console.log(this.value);
      });
      $(document).on('click', '#fleeBtn', function () {
        console.log("first flee button clicked")
        flee()
        //console.log(this.value);
      });
      $(document).on('click', '#parlayBtn', function () {
        console.log("first parlay button clicked")
        parlay()
        //console.log(this.value);
      });
    }
    function combat() {
      console.log("combat function round: " + round)
      $("#storyDiv").empty()
      //$("#attackBtn").html('Attack')
      //let round = 1
      if (round == 1) {
        $("#storyDiv").append("<p id='npcParagraph'>Your Opponent is: <strong>" + npc_name + "!!!</strong></p>")
        let roll_1d6 = Math.floor(Math.random() * 6) + 1;
        if (roll_1d6 < 4) {
          initiative = "npc"
          $("#storyDiv").append("<p id='storyDivHead'>" + npc_name + " won initiative and has attacked first!</p>")
        } else {
          initiative = "pc"
          $("#storyDiv").append("<p id='storyDivHead'>You have won initiative.  Attack, flee... or talk.</p>")
        }
      }

      //console.log("made it here")
      // add buttons to the top of the div
      // they will stay until combat is over
      //let rowString = "<p><strong>" + npc_name + "</strong> has the initiative.</p>"

      let rowString = `<div id="combatCommandButtons" class="d-flex my-3 justify-content-between">
      <button id="attackBtn2" class="attackBtn btn btn-dark px-4 rounded-pill">Attack!</button>
      <button id="fleeBtn2"class="innBtn btn btn-dark px-4 rounded-pill">Flee!</button>
      <button id="parlayBtn2"class="innBtn btn btn-dark px-4 rounded-pill">Parlay!</button>
      </div>`
      $("#storyDiv").append(rowString)
      // Add a table to log combat
      rowString =
          `<div class="table-responsive">
            <table class="table" id="combatTable">
              <thead>
                <tr>
                  <th scope="col" class="border-0 bg-light">
                    <div class="p-1 px-3 text-uppercase">Round</div>
                  </th>
                  <th scope="col" class="border-0 bg-light">
                    <div class="p-1 px-3 text-uppercase">Result</div>
                  </th>
                </tr>
              </thead>
              <tbody id="combatTableBody">
                <!-- Javascript fills in the table here -->
              </tbody>
            </table>
          </div> <!-- End Table container -->`
        $("#storyDiv").append(rowString)
      if (round == 1 && initiative == "npc") {
        // npc attacks first
        console.log("npc has the initiative")
        npcAttack(round)
      }
      // attach onClick events
      $("#attackBtn2").off("click")
      $(document).off("click")
      $(document).on('click', '#attackBtn2', function () {
      //$("attackBtn").on('click', function() {
        //$(document.body).scrollTop($('#storyAnchor').offset().top);
        
      if (round > 1) {
      	if (initiative == "npc") {
          $("#storyDivHead").html('<p>' + npc_name + ' still has the initiative</p>')
        } else {
          $("#storyDivHead").html('<p>' + playerCharacter.name + ' has the initiative</p>')
        }
      }
        
        console.log("attack button2 clicked")
        console.log("round: " + round)
        console.log("initiative: " + initiative)
        if (initiative == "pc") {
          playerAttack(round)
          npcAttack(round)
        }
        if (initiative == "npc" && round == 1) {
          playerAttack(round)
        }
        if (initiative == "npc" && round > 1) {
          npcAttack(round)
          playerAttack(round)
        } 
        round++
      });
      $("#fleeBtn2").off("click")
      $(document).on('click', '#fleeBtn2', function () {
      //$(fleeBtn).on('click', function () {
        console.log("second flee button clicked")
        flee()
        //console.log(this.value);
      });
      $("#parlayBtn").off("click")
      $(document).on('click', '#parlayBtn2', function() {
      //$("#parlayBtn").on('click', function () {
        console.log("second parlay button clicked")
        parlay()
        //console.log(this.value);
      });
    }
    function playerAttack(round) {

      // roll to hit
      let first_d6Roll = Math.floor(Math.random() * 6) + 1;
      let second_d6Roll = Math.floor(Math.random() * 6) + 1;
      let twoD6 = first_d6Roll + second_d6Roll
      if (twoD6 > 6) {
        // a hit!  now calc dmg
        console.log("PC rolled a hit!")
        let dmg = twoD6 - 6
        dmg += playerCharacter.dmg_bonus
        if (dmg <= npc[npc_id].armor) {
          // saved by armor!
          console.log("hit but made armor save")
          rowString = `<tr><td class="border-0 text-center">${round}</td>`
          rowString += `<td class="border-0"> You hit ${npc_name} for 0 damage!</td></tr>`
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-center"> You hit ' + npc_name + " 0 damage!</td></tr>")
          $("#combatTableBody").append(rowString)
        } else {
          // pc takes damage
          dmg = dmg - npc[npc_id].armor
          npc[npc_id].cur_hp = npc[npc_id].cur_hp - dmg
          console.log("you hit for " + dmg + " points of damage")
          rowString = `<tr><td class="border-0 text-center">${round}</td>`
          rowString += `<td class="border-0">You hit ${npc_name} for ${dmg} points of damage!`
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-center">You hit ' + npc_name + " for " + dmg + " points of damage!</td></tr>")
          $("#combatTableBody").append(rowString)
        }
      } else {
        console.log("You attacked but missed!")
        rowString = `<tr><td class="border-0 text-center">${round}</td>`
        rowString += `<td class="border-0">You attacked ${npc_name} but missed!</td></tr>`
        //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
        //$("#combatTableBody").append('<td class="border-0 text-center">You attacked ' + npc_name + " but missed!</td></tr>")
        $("#combatTableBody").append(rowString)
      }
    }
    function npcAttack(round) {
      let rowString = ""
      // npc attacks first
      // if the PC is not dead the the PC can act
      let first_d6Roll = Math.floor(Math.random() * 6) + 1;
      let second_d6Roll = Math.floor(Math.random() * 6) + 1;
      let twoD6 = first_d6Roll + second_d6Roll
      if (twoD6 > 6) {
        // a hit!  now calc dmg
        console.log("npc rolled a hit")
        let dmg = twoD6 - 6
        dmg += npc[npc_id].dmg_bonus
        if (dmg <= playerCharacter.armor) {
          // saved by armor!
          console.log("hit but made armor save")
          rowString = `<tr><td class="border-0 text-center">${round}</td>`
          rowString += `<td class="border-0">${npc_name} hits you for 0 damage!</td></tr>`
          $("#combatTableBody").append(rowString)
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-center">' + npc_name + " hits you for 0 damage!</td></tr>")
        } else {
          // pc takes damage
          dmg = dmg - playerCharacter.armor
          playerCharacter.cur_hp = playerCharacter.cur_hp - dmg
          console.log("you were hit for " + dmg + " point(s) of damage")
          rowString = `<tr><td class="border-0 text-center">${round}</td>`
          rowString += `<td class="border-0">${npc_name} hits you for ${dmg} points of damage!</td></tr>`
          $("#combatTableBody").append(rowString)
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-center">' + npc_name + " hits you for " + dmg + " points of damage!</td></tr>")
          
          // check to see if the pc is alive, knocked out or dead
          if (playerCharacter.cur_hp < 6 && playerCharacter.cur_hp > 0) {
        	// PC is knocked out
            console.log("PC is alive but knocked out")
            $("#storyDivHead").empty()
            $("#npcParagraph").empty()
            $("#storyDivHead").html('<p>' + playerCharacter.name + ' has been knocked out by ' + npc[npc_id].name + '!  You had best start praying for mercy!</p>')
            
            // empty the combatCommandButtons and then replace them with a single button to go to the start
            $("#combatCommandButtons").empty()
            
            let rowString = `<div class="col text-center">
                <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i class="mt-2 mr-2"></i>Click to Start Over</button>
                </div>`
            $("#combatCommandButtons").html(rowString)
            
            //$("#storyDiv").append(rowString)
            $("#beginAdventure").off('click')
            $("#beginAdventure").click(function () {
              //$("#storyDiv").empty()
              //$("#storyDiv").append("<p>Your Opponent is: </p>")
              initGame()
              //rollNPCTable()
            })
          }
          if (playerCharacter.cur_hp < 1) {
            // pc is dead!
            console.log("PC has died")
            $("#storyDivHead").empty()
            $("#npcParagraph").empty()
            $("#storyDivHead").html('<p>' + playerCharacter.name + ' has been slain by ' + npc[npc_id].name + '!  May God speed ' + playerCharacter.name + ' on his way to his eternal reward!</p>')
            
            // empty the combatCommandButtons and then replace them with a single button to go to the start
            $("#combatCommandButtons").empty()
            
            let rowString = `<div class="col text-center">
                <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i class="mt-2 mr-2"></i>Click to Start Over</button>
                </div>`
            $("#combatCommandButtons").html(rowString)
            
            //$("#storyDiv").append(rowString)
            $("#beginAdventure").off('click')
              $("#beginAdventure").click(function () {
              //$("#storyDiv").empty()
              //$("#storyDiv").append("<p>Your Opponent is: </p>")
              initGame()
              //rollNPCTable()
            })
          }
          updatePC()
        }
      } else {
        console.log("your opponent missed!")
        let rowString = `<tr><td class="border-0 text-center">${round}</td>`
        rowString += `<td class="border-0">${npc_name} attacked but missed!</td></tr>`
        $("#combatTableBody").append(rowString)
        //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
        //$("#combatTableBody").append('<td class="border-0 text-center">' + npc_name + " attacked but missed!</td></tr>")
      }
    }
    function flee() {
      console.log("flee function")
      $("#storyDiv").empty()
      $("#storyDiv").append("<p>" + npc_name + " laughs at you as you flee like a coward!</p>")
      $("#storyDiv").append("<p>If you're not too chicken to fight, click the button below to summon another opponent</p>")
      let rowString = `<div class="col text-center">
              <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i
                  class="mt-2 mr-2"></i>Summon Opponent!</button>
            </div>`
      $("#storyDiv").append(rowString)
      //initGame()
      
      $("#beginAdventure").click(function () {
        $("#storyDiv").empty()
        //$("#storyDiv").append("<p>Your Opponent is: </p>")
        rollNPCTable() 
      }) 
    }
    function parlay() {
      console.log("parlay function")
      let roll_1d6 = Math.floor(Math.random() * 6) + 1;
      
      if (roll_1d6 < 4) {
        let pronoun = (npc[npc_id].sex == "male") ? "He" : "She"
        
        console.log(npc[npc_id].name + " is: " + npc[npc_id].sex)
        
        $("#storyDiv").empty()
        $("#storyDiv").append("<p>" + npc_name + " is not interested in conversation. "+ pronoun + " attacks!</p>")
        /*let rowString = `<div class="d-flex mt-2 justify-content-between">
  <a href="#" id="attackBtn3" class="attackBtn btn btn-dark px-4 rounded-pill">Go To Combat!</a></div>`*/
  
        var rowString = `<div class="col text-center">
            <button id="attackBtn3" type="button" class="btn btn-dark px-4 rounded-pill"><i
            class="mt-2 mr-2"></i>Go To Combat!</button>
            </div>`
            
        $("#storyDiv").append(rowString)
        $(document).off('click')
        $(document).on('click', '#attackBtn3', function () {
          combat()
          //console.log(this.value);
        });
      } else {
        peace = true
        $("#storyDiv").empty()
        $("#storyDiv").append("<p>" + npc_name + " agrees to live and let live... for now.</p>")
        let rowString = `<div class="col text-center">
              <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i
                  class="mt-2 mr-2"></i>Summon Opponent!</button>
            </div>`
        $("#storyDiv").append(rowString)
        $("#beginAdventure").off('click')
        $("#beginAdventure").click(function () {
          $("#storyDiv").empty()
          //$("#storyDiv").append("<p>Your Opponent is: </p>")
          rollNPCTable()
        })
      }
    }
  </script>

</body>

</html>
