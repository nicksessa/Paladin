<!DOCTYPE html>
<html>

<head>
  <title>The Grail Quest</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <!-- Import Custom Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IM Fell English SC">

  <style>
    body {
      font-family: 'IM Fell English SC', serif;
      color: blanchedalmond;
      /* Location of the image */
      background-image: url("https://cdna.artstation.com/p/assets/images/images/001/796/342/large/andreas-rocha-oldforestb02.jpg?1452860763");
      
      /* this is the google drive version: */
      background-image: url("http://drive.google.com/uc?export=view&id=14muus5B7-Qj1L57aNh2vAeERkGQq9eTU");
      
      /* Background image is centered vertically and horizontally at all times */
      background-position: center center;
      /* Background image doesn't tile */
      background-repeat: no-repeat;
      /* Background image is fixed in the viewport so that it doesn't move when 
       the content's height is greater than the image's height */
      background-attachment: fixed;
      /* This is what makes the background image rescale based
       on the container's size */
      background-size: cover;
      /* Set a background color that will be displayed
       while the background image is loading */
      background-color: #464646;
    }
    .parchment {
      background-image: url("http://drive.google.com/uc?export=view&id=1ekfXcSNZ2xz4JmwGsq1xjx1ywGM5J7Sw");
      /* Background image is centered vertically and horizontally at all times */
      background-position: center center;
      /* Background image doesn'=t tile */
      background-repeat: no-repeat;
      /* Background image is fixed in the viewport so that it doesn't move when 
       the content's height is greater than the image's height */
      background-attachment: fixed;
      /* This is what makes the background image rescale based
       on the container's size */
      background-size: cover;
      /* Set a background color that will be displayed
       while the background image is loading */
      background-color: #464646;
      background-size: 100% 100%;
      box-shadow: 7px 7px 8px black, -4px -1px 8px black;
      box-shadow: 7px 7px 8px #1c1d1f, -4px -1px 8px #1c1d1f;
      
    }
    .topBar {
      /*order-radius: 30px;*/
      border-bottom-right-radius: 30px;
      border-top-right-radius: 30px;
      opacity: 0.9;
      border: 2px solid blanchedalmond;
      color: blanchedalmond;
    }
    /* change the background color */
    .navbar-custom {
      background-color: #ff5500;
    }
    /* change the brand and text color */
    .navbar-custom .navbar-brand,
    .navbar-custom .navbar-text {
      color: blanchedalmond;
    }
    /* change the link color */
    .navbar-custom .navbar-nav .nav-link {
      color: blanchedalmond;
    }
    /* change the color of active or hovered links */
    .navbar-custom .nav-item.active .nav-link,
    .navbar-custom .nav-item:focus .nav-link,
    .navbar-custom .nav-item:hover .nav-link {
      color: gold;
    }
    .bottom-right {
      bottom: 0;
      right: 0;
    }
    .textBlock-bg {
      opacity: 0.9;
      color: blanchedalmond;
    }
    .customBtn {
      border: 2px solid blanchedalmond;
    }
    .btn {
      color: blanchedalmond;
    }
    .sideMenuBtn {
      color: black;
    }
    .sideMenuBtn:hover {
      color: blue;
      text-shadow: 1px 1px 2px black, 0 0 25px yellow, 0 0 5px red;
      color: black;
      text-shadow: 1px 1px 2px black, 0 0 25px yellow, 0 0 5px red;
      font-size: x-large;
    }
    .footer {
      border: 2px solid blanchedalmond;
      border-top-left-radius: 30px;
      border-bottom-left-radius: 30px;
      position: fixed;
      right: 0;
      bottom: 0;
      /*width: 50%;*/
      background: rgba(41, 43, 44, 0.8);
      text-align: center;
    }
    .modal-body {
      background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.9) 100%), url("https://cdna.artstation.com/p/assets/images/images/007/566/572/large/dominik-mayer-inktober-02.jpg?1507027593");
      /* Background image is centered vertically and horizontally at all times */
      background-position: top center;
      /* Background image doesn't tile */
      background-repeat: no-repeat;
      /* Background image is fixed in the viewport so that it doesn't move when 
       the content's height is greater than the image's height */
      background-attachment: fixed;
      /* This is what makes the background image rescale based
       on the container's size */
      background-size: cover;
      /* Set a background color that will be displayed
       while the background image is loading */
      background-color: #464646;
      background-color: rgba(41, 43, 44, 0.8);
    }
    .modal-title {
      color: blanchedalmond;
    }

    .defaultText {
      color: blanchedalmond;
    }
    
    .modal-dialog{
      position: relative;
      display: table; /* This is important */ 
      overflow-y: auto;    
      overflow-x: auto;
      width: auto;
      min-width: 300px;   
	}
    
    .table {
      color: black;
    }
    
    th, tr {
      border: none;
      text-align: center;
      padding: 0px 5px;
      
    }
    .bodyDiv {
      height: 80%;
      height: 375px;
      
      overflow-y: auto;
    }
    .text-left {
      text-align: left !important;
    }
    
    .wideModal {
      width: 80%;
    }
    
  </style>
</head>

<body>

  <div class="container-fluid">

    <div class="row">
      <!-- top row -->
      <!-- <div class="col-6 pl-0"> -->
      <div class="pt-0 bg-dark d-flex flex-wrap topBar p-1 border-left-0 border-top-0">
        <button type="button" class="btn btn-dark" data-toggle="collapse" data-target="#collapseExample"
          aria-expanded="false" aria-controls="collapseExample">Menu</button>


        <button type="button" class="btn btn-dark text-left"><strong>The Grail Quest</strong></button>
        
        
        <!-- top div table -->
        <div>
          <table class="table-condensed">
          <thead>
          <tr>
            <th class="m-0 p-0">
              <button onclick="setCharacterModal()" data-toggle="modal" href="#myModal" type="button" class="btn btn-dark">
          <span id="topDivCharName" class="text-left"><strong>Sir Percival</strong></span>
          
        </button>
            </th>
            <th class="align-bottom">Piety</th>
            <th class="align-bottom"><button type="button" class="btn btn-dark text-center align-bottom py-0"><strong>Healing <br> Potions</strong>
        </button></th>
            <th class="align-bottom">Money</th>
            <th class="align-bottom">Rumors</th>
            <th class="align-bottom">Rebellion<br> Level</th>
            <th class="align-bottom">Turn</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <span>HP: </span>
              <span id="topDivCurHP" class="bg-success rounded px-1 pb-1 mr-1">999 </span>
              <span> of </span>
              <span id="topDivMaxHP">999</span>
            </td>
            <td class="text-center"><span id="topDivPiety">999</span></td>
            <td class="text-center"><span id="topDivPotions">999</span></td>
            <td class="text-center"><span id="topDivMoney">999</span></td>
            <td class="text-center"><span id="topDivRumors">999</span></td>
            <td class="text-center"><span id="topDivRebellionLevel">999</span></td>
            <td class="text-center"><span id="topDivTurnCounter">999</span></td>
          </tr>

        </tbody>
        </table>
        
        </div>
      </div>
      <!-- </div> -->
      <!-- col -->
    </div> <!-- top row -->



    <div class="pt-5">
      <!-- spacer that we don't really need-->
    </div>

    <div class="row bodyDiv">
      <!-- body row -->

      <div class="col-3 px-0">
        <!-- first col (side menu goes here) -->

        <div class="d-flex flex-wrap">
          <div class="col px-0">

            <div class="collapse" id="collapseExample">

              <div class="bg-dark d-flex flex-wrap textBlock-bg parchment rounded">
                <div class="btn-group-vertical">
                  <button type="button" class="btn sideMenuBtn">Sign In/Sign Up</button>

                  <button type="button" class="btn sideMenuBtn">Save Game</button>

                  <button type="button" class="btn sideMenuBtn">Restart Game</button>
                  <button id="backgroundURL1_btn" class="btn sideMenuBtn rounded">Background 1</button>
                  <button id="backgroundURL2_btn" class="btn sideMenuBtn rounded">Background 2</button>

                </div>
              </div>
            </div>
          </div>

        </div> <!-- col -->
      </div> <!-- col -->
      
<!-- main body column -->
      
      <div class="col"> 
        <div class="d-flex flex-wrap">
          <div id="gameTableTitle" class="px-4 py-2 mb-2 bg-dark rounded shadow-sm textBlock-bg">
            GAME TABLE TITLE
          </div>
        </div>
        
        <div class="d-flex flex-wrap">
          <div id="gameTableText" class="px-4 py-2 bg-dark rounded shadow-sm textBlock-bg">
            --- GAME TABLE TEXT --- 
          </div>
        </div>

        <div id="gameButtons">
        </div>

      </div> <!-- column 2-->
      <div class="col-3"></div> <!-- column 3-->
    </div>
  </div>


  <!-- The Modal -->
  <div class="modal fade" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-white">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 id="modalTitle" class="modal-title">Character Sheet</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
          <div id="characterStatsModal" class="container text-dark">
            <h1>Name: Sir NOBODY</h1>
            <hr>
            <p>Hit Points: 30/30</p>
            <p>Attack: 7+</p>
            <p>Damage Modifier: +2 (longsword)</p>
            <p>Armor: 1 (padding)</p>
            <h3>Equipment</h3>
            <hr>
            <p>Longsword</p>
            <p>Chainmail</p>
            <p>Potion of Healing (x3)</p>

          </div>
        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div> <!-- modal -->
   
  </div> <!-- col -->
  </div> <!-- row -->
  </div> <!-- container -->


  </div> <!-- body col -->
  </div> <!-- body row -->



  <div class="container-fluid">
    <div class="row">
      <!-- footer row-->

      <div
        class="footer textBlock-bg pl-3 pt-2  border-bottom-0 border-right-0 bg-dark d-flex flex-wrap d-flex justify-content-end ">
        <button onclick="showInventory()" type="button" class="btn btn-dark text-left" data-toggle="modal" href="#myModal">Inventory</button>
        <button onclick="setCharacterModal()" type="button" class="btn btn-dark text-left" data-toggle="modal" href="#myModal">Character</button>
        <button onclick="showRetainersModal()" id="openRetainerModal" type="button" class="btn btn-dark text-left" data-toggle="modal" href="#myModal">Retainers</button>
        <button type="button" class="btn btn-dark text-left">View Log</button>
      </div>


    </div> <!-- footer row-->

  </div>




  <script>
  

  
  $('#myModal').on('show.bs.modal', function () {
      $('.modal-body',this).css({width:'auto',height:'auto', 'max-height':'100%'});
});

  
  
    let backgroundImageURL1 = "https://cdna.artstation.com/p/assets/images/images/001/796/342/large/andreas-rocha-oldforestb02.jpg?1452860763"
    let backgroundImageURL2 = "https://cdnb.artstation.com/p/assets/images/images/020/284/017/large/andreas-rocha-cursedforesthr.jpg?1567153102"
    backgroundImageURL1 = "https://drive.google.com/uc?export=view&id=14muus5B7-Qj1L57aNh2vAeERkGQq9eTU"
    $(document).ready(function () {
      $("#backgroundURL1_btn").click(function () {
        //alert("Background color = " + $("p").css("background-color"));
        //alert("Background url = " + $("body").css("background-image"));
        $('body').css('background-image', 'url(' + backgroundImageURL1 + ')');
      });
      $("#backgroundURL2_btn").click(function () {
        //alert("Background color = " + $("p").css("background-color"));
        //alert("Background url = " + $("body").css("background-image"));
        $('body').css('background-image', 'url(' + backgroundImageURL2 + ')');
      });
    });
    
    // import the character.js file for the character object
    // check local storage for file.
    // Microsoft Edge does not like this: 
    /*
    let playerCharacterStats = localStorage.getItem("theGrailQuest_ryu2012_character")
    if (playerCharacterStats !== null && localStorage.playerCharacterStats !== '') {
    
    }
    let playerCharacterEquipment = localStorage.getItem("theGrailQuest_ryu2012_equipment")
    if (playerCharacterEquipment !== null && localStorage.playerCharacterEquipment !== '') {
    
    }
    let playerCharacterLog = localStorage.getItem("theGrailQuest_ryu2012_log")
    if (playerCharacterLog !== null && localStorage.playerCharacterLog !== '') {
    
    }
    */
    // Go here for more examples: https://www.w3schools.com/jsref/obj_storage.asp
    
    
  // this will close the menu on click outside the menu
  
  $(document).mouseup(function(e) 
  {
      var container = $("#collapseExample");
      // if the target of the click isn't the container nor a descendant of the container
      if (!container.is(e.target) && container.has(e.target).length === 0) 
      {
          container.collapse('hide');
      }
  });  
    
    
    let playerCharacter = {
      name: "Sir Percival",
      max_hp: 40,
      cur_hp: 35,
      armor: 1,
      attack: 7,
      att_mod: 0,
      dmg_mod: 2,
      exp: 0,
      money: 20,
      species: "human",
      sex: "male",
      healingPotions: 2,
      alive: true,
      rumors: 5,
      rumorModifier: 0,
      rebellionLevel: 0,
      rebellionLevelMod: 0,
      turn: 5,
      piety: 2,
      sideQuests: 0,
      findRetainerModifier: 0,
      wasLost: false,
      captainsSlain: 0,
      onPilgrimage: false,
      pilgrimageModifier: 0
    }
    
    
    
let retainers = [
    {
      name: "Fred",
      profession: "Mercenary",
      employed: true,
      cur_hp: 20,
      max_hp: 20,
      weapon: "Longsword",
      armor: "Padded",
      attack: 7,
      damage_bonus: 2,
      armor_bonus: 1,
      morale: 1,
      cost: 5
    },
    {
      name: "Oliver",
      profession: "Rogue",
      employed: true,
      cur_hp: 15,
      max_hp: 15,
      weapon: "Shortsword",
      armor: "Leather Jerkin",
      attack: 7,
      damage_bonus: 2,
      armor_bonus: 1,
      morale: -1,
      cost: 5
    },
    {
      name: "Trogdor",
      profession: "Woodsman",
      employed: true,
      cur_hp: 20,
      max_hp: 20,
      weapon: "Longbow and Shortsword",
      armor: "Leather Jerkin",
      attack: 7,
      damage_bonus: 2,
      armor_bonus: 1,
      morale: 0,
      cost: 5
    }
  ]
    
    
    let availableRetainers = []
    
    
  // -------------------------------------
  // Retainer Names
  
let retainerNameFirst_A = [
      "Bard",
      "Cadm",
      "Guel",
      "Har",
      "Mael",
      "Rayg"
    ]
    
    let retainerNameSecond_A = [
      "an",
      "ar",
      "oc"
    ]
    
    let retainerNameFirst_B = [
      "Adal",
      "Childe",
      "Ed",
      "Leof",
      "Theud",
      "Wulf"
    ]
    let retainerNameSecond_B = [
      "berg",
      "mund",
      "ric"
    ]
    
    let retainerNameFirst_C = [
      "Berw",
      "Cadw",
      "Gwrh",
      "Llyw",
      "Ow",
      "Tyw"
    ]
    let retainerNameSecond_C = [
      "en",
      "yr",
      "yn"
    ]
    
    let retainerNameFirst_D = [
      "Aligr",
      "Bedin",
      "Dion",
      "Gaheri",
      "Guivr",
      "Mordr"
    ]
    let retainerNameSecond_D = [
      "auz",
      "es",
      "et"
    ]
  
  // -------------------------------------
    

    let adventureLog = []
    
    
    let merchant = 0
    let woodsman = 0
    let mercenary = 0
    let rogue = 0
    
    // get some totals for retainers
    
    $.each(retainers, function(key, value) {

      let retainer_name = value.name
      let retainer_profession = value.profession
      if (retainer_profession == "Mercenary") mercenary++
      if (retainer_profession == "Rogue") rogue++
      if (retainer_profession == "Woodsman") woodsman++
      if (retainer_profession == "Merchant") merchant++
      
    })
    
    let manageRetainersComplete = false
    
    
    
    //alert("Num Retainers: " + retainers.length)
    console.log("Num Retainers: " + retainers.length)
    
    
    // -----------------------------------------------------
    // On Load set the top div
    // -----------------------------------------------------
    
    updateNavbar()
    
    function updateNavbar() {
      // attack bonus 
      // rebellion level 1 = +1
      // rebellion level 2-3 = +2
      // rebellion level 4 = +3
    
      let rebellionLevel = playerCharacter.rebellionLevel
      let rebellionLevelMod = 0
      let hpMod = 0
      switch(rebellionLevel) {
        case 0: 
          playerCharacter.rebellionLevelMod = 0
        break;
        case 1: 
          playerCharacter.rebellionLevelMod = 1
        break;
        case 2:
        case 3:
          playerCharacter.rebellionLevelMod = 2
        break;
        default: 
          playerCharacter.rebellionLevelMod = 3
        break;
      }
    
      $("#topDivCharName").html(`<strong>${playerCharacter.name}</strong>`)
      $("#topDivCurHP").html(playerCharacter.cur_hp)
      $("#topDivMaxHP").html(playerCharacter.max_hp)
      $("#topDivPiety").html(playerCharacter.piety)
      $("#topDivPotions").html(playerCharacter.healingPotions)
      $("#topDivMoney").html(playerCharacter.money)
      $("#topDivRumors").html(playerCharacter.rumors)
      $("#topDivRebellionLevel").html(playerCharacter.rebellionLevel)
      $("#topDivTurnCounter").html(playerCharacter.turn)
      // set color for HP
      // first unset all colors
      $("#topDivCurHP").removeClass(["bg-success", "bg-warning", "bg-danger", "bg-secondary"]);
      let a = Math.floor(playerCharacter.max_hp / 3);
      let firstThird = (playerCharacter.max_hp - a)
      let secondThird = (playerCharacter.max_hp - (a * 2))
      //console.log("a: " + a)
      //console.log("firstThird: " + firstThird)
      //console.log("secondThird: " + secondThird)
      if (playerCharacter.cur_hp >= firstThird) {
        $("#topDivCurHP").addClass("bg-success")
      } else if (playerCharacter.cur_hp < firstThird && playerCharacter.cur_hp >= secondThird) {
        $("#topDivCurHP").addClass("bg-warning")
      } else if (playerCharacter.cur_hp > 0 && playerCharacter.cur_hp < secondThird) {
        $("#topDivCurHP").addClass("bg-danger")
      } else {
        $("#topDivCurHP").addClass("bg-secondary")
      }
    }
    
    // -----------------------------------------------------
    // Set the Character Stats Modal
    // -----------------------------------------------------
    
    function setCharacterModal() {
      $("#modalTitle").html("Character Stats")
      let characterStats = `
        <div>
          <h1>${playerCharacter.name}</h1>
          <hr>
          <span>Hit Points: ${playerCharacter.cur_hp} / ${playerCharacter.max_hp}</span><br>
          <span>Attack: ${playerCharacter.attack}+</span><br>
          <span>Damage Modifier: ${playerCharacter.dmg_mod}</span><br>
          <span>Armor Modifier: ${playerCharacter.armor}</span><br>
          <hr>
          <h3>Equipment</h3>
          <span>Longsword</span><br>
          <span>Chainmail</span><br>
          <span>Shield</span><br>
        </div>
      `
      $("#characterStatsModal").html(characterStats)
    }
    // -----------------------------------------------------
    // Journey Table
    // -----------------------------------------------------
        // Tables
    let journeyTable = [
      "You have found an inn at a Crossroads. You may choose to stay at the inn or face the danger that awaits. Choose wisely.",
      "finds an inn.  You may choose to stay at the inn or or bypass it by clicking on the Journey On button.",
      "You are lost! If you have a Merchant retainer, he knows of a shortcut, treat as a result of 1 on this table instead. If you don not have a merchant, roll on this table again with a +1.",
      "Roll on the Encounter Table (3).",
      "If the Rebellion Level is 4, roll on the Challenge Table (7). Otherwise, roll on the Encounter Table (3).",
      "If the Rebellion Level is 4, roll on the Challenge Table (7). Otherwise, roll on the Traitors Attack Table (4)."
    ]
    let innTable = [
      "Your paladin is turned away, roll on the Journey Table (1) again.",
      "Roll 2d6. If the result is 7 or less one of your retainers (if any) is killed in an ambush by ruffians. (randomly choose which one) Deduct -1 from the Rumor Roll. No new retainers are available.",
      "Roll 2d6. If the result is 5 or less, if you have coins, 3d6gp is stolen by a pickpocket. Deduct -1 from the Find Retainer roll.",
      "Greedy traders, all items cost double, and you sell treasures at half their value. Ignore this if you have a merchant retainer.",
      "Talkative innkeeper. Add +1 to the Rumor Roll.",
      "Add +1 to the Find Retainer roll if the roll is 5 or less.",
      "You get free food and lodging. Add +1 to the Find Retainer roll if the roll is 5 or less. New retainers are hired for 5gp.",
      "A wealthy noble donates 3d6 x 5gp to your worthy cause."
    ]
    
    let traitorsTable = [
      "hears that a questing paladin has been killed by the traitors in a distant location. The Rebellion Level has increased!",
      "finds a questing paladin, mortally wounded by the traitors. Before he dies, he gives you some information. You have gained one rumor but the Rebellion Level has also increased!",
      "finds signs of a brave fight, but no dead questing paladin. This was a lucky escape, the traitors did not get their kill."
    ]
    
    
    // -----------------------------------------------------
    // Journey Table / Start Game
    // -----------------------------------------------------
    
    $(document).ready(function () {
      startGame()
    })
      
    // Start Game: Roll on the Journey Table
    function startGame() {
      $("#gameTableTitle").empty()
      $("#gameTableTitle").html("Journey Table")
      $("#gameButtons").empty()
      $("#gameTableText").html("Click below to journey onward!")
      
      let runJourneyButton = `
          <div class="mt-2">
          <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
        `
      $("#gameButtons").html(runJourneyButton)
    }
    
    function rollJourneyTable() {
      $("#gameTableTitle").empty()
      $("#gameTableTitle").html("Journey Table")
      $("#gameTableText").empty()
      $("#gameTableText").html(`${playerCharacter.name} sets off on a journey and ...`)
      console.log("roll on the journey table")
      playerCharacter.turn++
      updateNavbar()
      
      let journeyRoll = rollDie(6)
      
      if (playerCharacter.wasLost) {
        journeyRoll++
        playerCharacter.wasLost = false
      }
      
      //journeyRoll = 4
      //alert("The begin adventure button was clicked. You rolled: " + d6Roll);
      // Save turn data in the log (we'll push this to MySql at some point)
      adventureLog.push({ 'turn': playerCharacter.turn, 'roll': journeyRoll, 'result': journeyTable[journeyRoll - 1] });
      //logTurn()
      
      $("#gameButtons").empty()
      
      switch (journeyRoll) {
        // crossroads
        case 1:
          $("#gameTableTitle").append(" - Crossroads")
          crossroads()
          break;
        // Inn table or roll again
        case 2:
          $("#gameTableTitle").append(" - Journey on or Stay at Inn")
          journeyOrInn()
          break;
        // lost
        case 3:
          $("#gameTableTitle").append(" - Lost!")
          youAreLost()
          break;
        // Encounter
        case 4:
          $("#gameTableTitle").append(" - An Encounter!")
          rollEncounterTable()
          break;
        // Encounter or Challenge
        case 5:
          if (playerCharacter.rebellionLevel > 3) {
            $("#gameTableTitle").append(" - A Challenge!")
            rollChallengeTable()
          } else {
            $("#gameTableTitle").append(" - An Encounter!")
            rollEncounterTable()
          }
          break;
        // Traitors or Challenge
        case 6:
          if (playerCharacter.rebellionLevel > 3) {
            $("#gameTableTitle").append(" - A Challenge!")
            rollChallengeTable()
          } else {
            $("#gameTableTitle").append(" - Traitors!")
            rollTraitorsTable()
          }
          break;
      }
    };
    
// --- Crossroads ---
    
    function crossroads() {
      //$("#gameButtons").empty()
      $("#gameTableText").empty()
      $("#gameTableText").append(journeyTable[0])
      //$("#adventureLogTableBody").empty()
      // Inn or Encounter
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Inn
        </button>
        <button onclick="startEncounter()" data-id="startEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go To Encounter!
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)
    }
    
// --- Journey or Inn Choice---
    
    function journeyOrInn() {
      $("#gameTableText").append(journeyTable[1])
      
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey Onward!
        </button>
        <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Inn
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)  
    }
    
// --- Roll on the Inn Table ---    
    
    function rollInnTable() {
      // Successfully completed side quests will modify this roll.
      // 1 quest = +1
      // 2-3 quests = +2
      // 4 or more = +3
      
      let modifier = 0
      switch (playerCharacter.sideQuests) {
        case 0:
          modifier = 0
        break;
        case 1:
          modifier = 1
        break;
        case 2:
        case 3:
          modifier = 2
        break
        default:
          modifier = 3
      }
      
      $("#gameTableTitle").html("Inn Table")
      
      let rowString = ""
      // clear the story div
      $("#gameTableText").empty()
      playerCharacter.findRetainerModifier = 0
      
      console.log("roll on the inn table")
      adventureLog.push({ 'turn': playerCharacter.turn, 'roll': 'Player Choice', 'result': 'Stay at the Inn' });
      let roll_1d6 = rollDie(6) + modifier;
      console.log("roll + modifier: " + roll_1d6)
      //roll_1d6 = 1
      
      //$("#gameTableText").append(innTable[roll_1d6 - 1])
      
      switch (roll_1d6) {
        case 1:
          console.log("[1] Your paladin is turned away!  Journey on...")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': innTable[0] });
          $("#gameTableText").append("<p>Your paladin is turned away.</p>")
        break;
        case 2:
          console.log("[2] Grumpy Patrons")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Grumpy patrons' });
          playerCharacter.rumorModifier = -1
          updateNavbar()
          rowString = "<p>Grumpy patrons (rumor modifier -1)</p>"
          
          if (retainers > 0) {
            let first_d6Roll = Math.floor(Math.random() * 6) + 1;
            let second_d6Roll = Math.floor(Math.random() * 6) + 1;
            let twoD6 = first_d6Roll + second_d6Roll
            if (twoD6 < 8) {
              // random retainer has been killed
              rowString += "<br>If that wasn't bad enough, one of your retainers has been killed in an ambush!"
              adventureLog.push({ 'turn': playerCharacter.turn, 'roll': twoD6, 'result': 'One of your retainers has been killed!' });
            }
          }
          $("#gameTableText").append(rowString)
        break;
        case 3:
          console.log("[3] Shady Characters")
          $("#gameTableText").append("<p>Shady characters abound, making it hard to find good help. (-1 to the retainer roll)</p>")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Shady Characters.' });
          let first_d6Roll = Math.floor(Math.random() * 6) + 1;
          let second_d6Roll = Math.floor(Math.random() * 6) + 1;
          let twoD6 = first_d6Roll + second_d6Roll
          if (twoD6 < 6) {
            let first_d6Roll = Math.floor(Math.random() * 6) + 1;
            let second_d6Roll = Math.floor(Math.random() * 6) + 1;
            let third_d6Roll = Math.floor(Math.random() * 6) + 1;
            let threeD6 = first_d6Roll + second_d6Roll + third_d6Roll
            rowString = "Robbed!"
            rowString += "<br>You lose " + threeD6 + " silver pieces.<br>"
            adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'You have been robbed!' });
            playerCharacter.money -= threeD6
            updateNavbar()
            $("#gameTableText").append(rowString)
          }
        break;
        case 4:
          console.log("[4] Greedy Traders")
          
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Greedy traders.' });
          if (merchant < 1) {
            // items cost double. items sold for half
            console.log("Greedy traders. Items cost double and are sold for half!")
            $("#gameTableText").append("<p>Greedy Traders, everything costs double and everything you sell is at half the normal value!</p>")
          } else {
            $("#gameTableText").append("<p>Greedy Traders but your merchant is able to counter them!</p>")
          }
        break;
        case 5:
          $("#gameTableText").append("<p>Talkative innkeeper.  Add +1 to the Rumor Roll</p>")
          console.log("[5] Talkative innkeeper")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Talkative innkeeper.' });
          playerCharacter.rumorModifier = 1
          updateNavbar()
          break;
        case 6:
          let num = rollDie(6)
          if (num < 6) {
            console.log("[6] Abundant Retainers looking for work")
            $("#gameTableText").append("<p>Abundant Retainers looking for work.  +1 to the Find Retainer Roll</p>")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Add +1 to the Find Retainer roll.' });
            playerCharacter.findRetainerModifier++
          } else {
            $("#gameTableText").append("<p>Nothing special happens this time.</p>")
          }
        break;
        case 7:
          num = rollDie(6)
          if (num < 6) {
            console.log("[6] Free Food & Abundant Retainers looking for work!")
            $("#gameTableText").append("<p>Abundant Retainers looking for work.  +1 to the Find Retainer Roll</p>")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Add +1 to the Find Retainer roll.' });
            playerCharacter.findRetainerModifier++
          }
          $("#gameTableText").append("<br>Free food and lodging!<br>")
          console.log("[7] Free food and lodging!")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Free food and lodging!' });
        break;
        case 8:
          console.log("[8] Wealthy patron donates to your cause!")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Wealthy nobel donates money to your cause!' });
          let money = 0
          for (let i=0; i<3; i++) {
            money += rollDie(6)
          }
          money = (5 * money)
          console.log("You gain: " + money + " silver pieces")
          $("#gameTableText").append(`<p>A wealthy patron donates to your cause! You gain ${money} silver pieces! </p>`)
          playerCharacter.money += money
          updateNavbar()
        break;
      }
      //logTurn()
      if (roll_1d6 > 1) {
        stayAtInn()
      } else {
        rowString = `
          <div class="d-flex mt-2">
            <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Journey On
            </button>
          </div>`
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      }
      
      
    }
    
// --------------------    
// Stay at Inn    
  function stayAtInn() {
    let rowString = ""
    if (playerCharacter.money < 10) {
      // charity
      $("#gameTableText").append(`<p>Since you don't have enough money, the local church, having heard of your daring exploits, puts you up for the night for free. </p>`)
      healUp()
      // Re-employ all retainers.
      // Since they default to hired, then there is nothing to do here.
      rowString = `
      <div class="d-flex mt-2">
        <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Journey On
    	</button>
      </div>`
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)
    } else {
      playerCharacter.money -= 10
      $("#gameTableText").append(`<p>You pay the innkeeper 10 silver pieces for food and lodging for the night. </p>`)
      healUp()
      rollForRumors()
      // retain/fire retainers

      let numRetainers = retainers.length
      let newRetainers = numAvailableRetainers()
      
      if (newRetainers > 0 ) {
        $("#gameTableText").append(`<p>New possible retainers are available.</p>`)
        // roll em up now, not on click.
        // then add them to the new retainers object
        
        for (let i=0; i<newRetainers; i++) {
          createRetainer(i)
        }

      }
        rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
          Journey Onward!
        </button>
        <button onclick="manageRetainersModal()" data-id="manageRetainersBtn" type="button" data-toggle="modal" href="#myModal" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
          Manage Retainers
        </button>
        <button onclick="generalStore()" data-id="generalStoreBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
          General Store
        </button>
        </div>
        `
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      }    
    updateNavbar()
  }
    
  function healUp() {
    // heal if cur_hp < max_hp
    if (playerCharacter.cur_hp < playerCharacter.max_hp) {
      let num1 = rollDie(6)
      let num2 = rollDie(6)
      let num3 = num1 + num2
      $("#gameTableText").append(`<p>Healing Roll: ${num1} + ${num2} = ${num3}</p>`)
      if ((num3 + playerCharacter.cur_hp) >= playerCharacter.max_hp) {
        playerCharacter.cur_hp = playerCharacter.max_hp

        $("#gameTableText").append("<p>After a good night's sleep, ALL of your wounds have healed!</p>")
      } else {
        playerCharacter.cur_hp = num3 + playerCharacter.cur_hp
        $("#gameTableText").append("<p>After a good night's sleep, some of your wounds have healed.</p>")

      }
      $("#gameTableText").append(`<p>Current Health: ${playerCharacter.cur_hp}</p>`)
      updateNavbar()
    }
  }
    
  function rollForRumors() {
    let randomNum = rollDie(6) 
    let rumorMod = playerCharacter.rumorModifier
    let rogueMod = 0
    
    let haveRogue = false
    $.each(retainers, function(key, value) {
        let retainer_profession = value.profession
        if (retainer_profession == "Rogue") haveRogue = true
    })
    if (haveRogue) {
      rogueMod = 2
    }
    let total = randomNum + rumorMod + rogueMod
    if (haveRogue) {
      $("#gameTableText").append(`<p>Rumor Roll: ${randomNum} + modifier: ${rumorMod} + rogue: ${rogueMod} = ${total}</p>`)
    } else {
      $("#gameTableText").append(`<p>Rumor Roll: ${randomNum} + modifier: ${rumorMod} = ${total}</p>`)
    }
    if (total > 3) {
      playerCharacter.rumors++
      $("#gameTableText").append("You gain 1 rumor!")
    } else {
      $("#gameTableText").append("Sorry pal, no new rumors for you.")
    }
  }
    
    
    function generalStore() {
      $("#gameTableText").append("<p>The store is closed.</p>")
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
    }

    function numAvailableRetainers () {
      let num1 = rollDie(6)
      //alert("You rolled a: " + num1)
      let numRetainers = retainers.length
      let total = num1 - numRetainers
      //alert("Total: " + total)
      return total
    }
    
    function createRetainer (i) {
      availableRetainers = []
      // get name
      retainerName = createName(i)

      // get profession
      retainerProfession = getRetainerProfession(i)

      let newObj = {
        name: retainerName,
        profession: retainerProfession,
        employed: false,
        cost: 10
      }
      // push to availableRetainers[]

      availableRetainers.push(newObj)

    }
    
  function createName(i) {
    let firstPart = ""
    let secondPart = ""
    let retainerName = ""
    let firstRoll = 0
    let secondRoll = 0
    
    firstRoll = rollDie(6)
    switch(firstRoll) {
      case 1:
      case 2:
        secondRoll = rollDie(retainerNameFirst_A.length)
        firstPart = retainerNameFirst_A[secondRoll -1]
        console.log("First Part is: " + firstPart)
        thirdRoll = rollDie(retainerNameSecond_A.length)
        secondPart = retainerNameSecond_A[thirdRoll -1]
        console.log("Second Part is: " + secondPart)
        retainerName = firstPart + secondPart
        console.log("Retainer Name is: " + retainerName)
      break;
      case 3:
      case 4:
        secondRoll = rollDie(retainerNameFirst_B.length)
        firstPart = retainerNameFirst_B[secondRoll -1]
        console.log("First Part is: " + firstPart)
        thirdRoll = rollDie(retainerNameSecond_B.length)
        secondPart = retainerNameSecond_B[thirdRoll -1]
        console.log("Second Part is: " + secondPart)
        retainerName = firstPart + secondPart
        console.log("Retainer Name is: " + retainerName)
      break;
      case 5:
        secondRoll = rollDie(retainerNameFirst_C.length)
        firstPart = retainerNameFirst_C[secondRoll -1]
        console.log("First Part is: " + firstPart)
        thirdRoll = rollDie(retainerNameSecond_C.length)
        secondPart = retainerNameSecond_C[thirdRoll -1]
        console.log("Second Part is: " + secondPart)
        retainerName = firstPart + secondPart
        console.log("Retainer Name is: " + retainerName)
      break;
      case 6:
        secondRoll = rollDie(retainerNameFirst_D.length)
        firstPart = retainerNameFirst_D[secondRoll -1]
        console.log("First Part is: " + firstPart)
        thirdRoll = rollDie(retainerNameSecond_D.length)
        secondPart = retainerNameSecond_D[thirdRoll -1]
        console.log("Second Part is: " + secondPart)
        retainerName = firstPart + secondPart
        console.log("Retainer Name is: " + retainerName)
      break;
    }
    //alert("Retainer ["+ i + "] is " + retainerName)
    return retainerName
  }
  
  
  function getRetainerProfession() {
    let num1 = rollDie(6)
    switch(num1) {
      case 1:
      case 2:
      case 3:
        return "Mercenary"
      break;
      case 4:
        return "Woodsman"
      break;
      case 5:
        return "Merchant"
      break;
      case 6:
        return "Rogue"
      break;
    }
  }
    
   
   
 
   
   
   
    
    
// Stay At Inn
// --------------------
    
// --- You are lost ---
    function youAreLost() {
      $("#gameTableText").append("<p>becomes lost!</p>")
      console.log(journeyTable[2])
      let rowString = ""
      if (merchant == 0) {
        // roll again but with +1 to the roll
        // set wasLost to true which tells the journey table to add +1 to the journey roll
        $("#gameTableText").append("<br>You have no choice but to continue on...")
        playerCharacter.wasLost = true
        rowString += `
        <div class="d-flex mt-2">
        <button onclick="rollJourneyTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
        </button>
        </div>`
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      } else {
        // go to the crossroads
        $("#gameTableText").append("But luckily your Merchant friend knew a way to get you to an inn.")
        
        rowString += `
        <div class="d-flex mt-2">
        <button onclick="crossroads()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Crossroads
        </button>
        </div>`
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      }
    }
    
    
    
    // -----------------------------------------------------
    // Encounter Table
    // -----------------------------------------------------
    
    function rollDie (dieType) {
  	  let result = Math.floor(Math.random() * dieType + 1);
      return result
    }
    
    const encounterTable = {
      2: "Morgana",
      3: "Castle Perilous",
      4: "Village of Plague and Death",
      5: "Grail Castle",
      6: "Minions",
      7: "Undertake a Challenge!",
      8: "Minions",
      9: "A Heroic Quest",
      10: "Village of Poverty and Famine",
      11: "Test of Piety",
      12: "Merlin"
    }
    
    
    let castlePerilousTable = [
      "The White Knight. In a room you see a white shield with red cross, the Shield of Evalach. It is guarded by a white† knight, level 7 with 8 life points. No quarter is asked or given. If you defeat the white knight, you may take the shield and get one XP roll. If you already have the shield, roll on this table again.",
      "Penance. You fall asleep. If you committed an act of Dishonor during the game, you wake up outside an abandoned church. Any armor, shield and weapon you had are stolen (except magical ones), and you are left with only a dagger (light slashing weapon). Treasures, coins and retainers remain with you. Otherwise, you heal 1 life point for a good night’s sleep.",
      "The Wanderer. You meet an immortal, over 1,000 years old. If you are currently under Dishonor, it is removed. He takes you to a crossroads, treat as if a 1 was rolled on the Inn Table (2)",
      "The Black Knight or the Red Knight? Opening a door you see two scenes. First: A questing paladin is about to be killed by a black† knight . Second: A maiden is about to be attacked by a red† knight . Choose who to save. If you save the maiden, roll for a piety point, but the Rebellion Level increases by 1 as the questing paladin dies. If you save the questing paladin, do not increase the Rebellion Level. You only fight one of the knights; they are both level 7 with 8 life points. You get an XP roll if you win. No quarter is asked or given. There is no treasure. ",
      "The Hermit. You meet an old hermit who can sell you up to 3 rumors for 50gp each (or at least that value in treasure).",
      "The Dwarf. At the castle gate, a dwarf with a cart offers you a lift. If you pay him 50 gold pieces (or at least that value in treasure), you, along with retainers, can be taken to any quest of your choice from the Side Quest Table (9). You can also ride for free, roll a d6; on a 1-3 go to event 7, and on a 4-6 go to event 9 on the Encounter Table (3)."
    ]  
    
    //let numRumors = 3
    //let pietyPoints = 1
    let altEncounter = false
    let theEncounter = "THE UNDERWORLD"
    
    //startEncounter()
    
    function startEncounter() {
      $("#gameTableTitle").html("Encounter Table")
      $("#gameButtons").empty()
      $("#gameTableText").html("Click below to generate an encounter.")
      
      let createEncounterButton = `
          <div class="mt-2">
          <button onclick="rollEncounterTable()" data-id="createEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Create Encounter
          </button>
        `
      $("#gameButtons").html(createEncounterButton)
    }
    
    
    // get encounter
    function rollEncounterTable() {
      $("#gameButtons").empty()
      $("#gameTableText").empty()
      
      let firstRoll = rollDie(6)
      let secondRoll = rollDie(6)
      let totalRoll = firstRoll + secondRoll
      
      //totalRoll = 7
      
      altEncounter = false
      //alert("Roll: (" + firstRoll + " + " + secondRoll + ") = " + totalRoll)
      theEncounter = encounterTable[totalRoll]
      console.log("The encounter rolled: "+ theEncounter)
      //alert("You encounter: " + theEncounter)
      // create an encounter list in anticipation of the player spending rumor points to modify the results
      let encounterChoices = []
      // The table consists of two steps above and two steps below the result.
      // For example, if the player rolled a 7, then this object will consist of:
      // 5, 6, 8, 9
      // Note: cannot go lower than 2 or higher than 12
      if (totalRoll == 2) {
        encounterChoices.push(encounterTable[3])
        encounterChoices.push(encounterTable[4])
      }
      if (totalRoll == 3) {
        encounterChoices.push(encounterTable[2])
        encounterChoices.push(encounterTable[4])
        encounterChoices.push(encounterTable[5])
      }
      if (totalRoll == 4) {
        encounterChoices.push(encounterTable[2])
        encounterChoices.push(encounterTable[3])
        encounterChoices.push(encounterTable[5])
        encounterChoices.push(encounterTable[6])
      }
      if (totalRoll == 5) {
        encounterChoices.push(encounterTable[3])
        encounterChoices.push(encounterTable[4])
        encounterChoices.push(encounterTable[6])
        encounterChoices.push(encounterTable[7])
      }
      if (totalRoll == 6) {
        encounterChoices.push(encounterTable[4])
        encounterChoices.push(encounterTable[5])
        encounterChoices.push(encounterTable[7])
        encounterChoices.push(encounterTable[8])
      }
      if (totalRoll == 7) {
        encounterChoices.push(encounterTable[5])
        encounterChoices.push(encounterTable[6])
        encounterChoices.push(encounterTable[8])
        encounterChoices.push(encounterTable[9])
      }
      if (totalRoll == 8) {
        encounterChoices.push(encounterTable[6])
        encounterChoices.push(encounterTable[7])
        encounterChoices.push(encounterTable[9])
        encounterChoices.push(encounterTable[10])
      }
      if (totalRoll == 9) {
        encounterChoices.push(encounterTable[7])
        encounterChoices.push(encounterTable[8])
        encounterChoices.push(encounterTable[10])
        encounterChoices.push(encounterTable[11])
      }
      if (totalRoll == 10) {
        encounterChoices.push(encounterTable[8])
        encounterChoices.push(encounterTable[9])
        encounterChoices.push(encounterTable[11])
        encounterChoices.push(encounterTable[12])
      }
      if (totalRoll == 11) {
        encounterChoices.push(encounterTable[9])
        encounterChoices.push(encounterTable[10])
        encounterChoices.push(encounterTable[12])
      }
      if (totalRoll == 12) {
        encounterChoices.push(encounterTable[10])
        encounterChoices.push(encounterTable[11])
      }
      $("#gameTableText").empty()
      $("#gameTableTitle").html("An Encounter!")
      if (playerCharacter.rumors < 3) {
        $("#gameTableText").html(theEncounter)
        $("#gameButtons").empty()
        let gotoEncounterButton = `
          <div class="mt-2">
          <button onclick="gotoEncounter()" data-id="gotoEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go To Encounter
          </button>
        `
        $("#gameButtons").append(gotoEncounterButton)
      } else {
        //$("#gameTableInfo").parent().empty()
        //$("#gameTableText").html(theEncounter)
        $("#gameTableText").append("You have rolled a " + totalRoll + " (" + theEncounter + ") on the Encounter table.  Go to that encounter OR you may spend 3 rumors to select an encounter from the list below.")
        // show radio
        let formDiv = `
          <form id="altEncountersForm"></form>
        `
        $("#gameTableText").append(formDiv)
        $.each(encounterChoices, function( index, value ) {
          //alert( index + ": " + value );
          let myRadio = `
            <div class="mt-2 custom-control custom-radio">
              <input id="myRadio${index}" class="custom-control-input" type="radio" name="customRadio" disabled> 
              <label class="custom-control-label" for="myRadio${index}">${value}</label>
            </div>
      `
          $("#altEncountersForm").append(myRadio)
        });
        // Spend rumors Y/N  (button)
        
        let rumorButton = `
          <div class="mt-2">
          <button onclick="enableEncounters()" data-id="spendRumorsBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Click here to Spend 3 Rumors
          </button>
        `
        // Show radio options but make them all inactive
        $("#gameButtons").html(rumorButton)
        let gotoEncounterButton = `
          <div class="mt-2">
          <button onclick="gotoEncounter()" data-id="gotoEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go To Encounter
          </button>
        `
        $("#gameButtons").append(gotoEncounterButton)
      }
    }
    
    
    
    function enableEncounters () {
      playerCharacter.rumors = playerCharacter.rumors -3
      $("#topDivRumors").html(playerCharacter.rumors)
      
      
      $("input[type=radio]").attr('disabled', false);
      // remove the rumor button (empty the div)and then add back the gotoEncounter button
      $("#gameButtons").empty()
      let gotoEncounterButton = `
        <div class="mt-2">
        <button onclick="gotoEncounter()" data-id="gotoEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Go To Encounter
        </button>
      `
      $("#gameButtons").append(gotoEncounterButton)
      $("#gameTableText").append("Select one of the following encounters.")
      altEncounter = true
    }
    
    function gotoEncounter() {
      // check to see if the user went for the alternative encounters
      console.log("Alternative Encounter selected? " + altEncounter)
      if (altEncounter) {
        //theEncounter = $("#altEncountersForm input[type='radio']:checked").val()
        //theEncounter = $("input[name='customRadio']:checked").val()
        
        $("input[type='radio']:checked").each(function() {
          var idVal = $(this).attr("id");
          //alert($("label[for='"+idVal+"']").text());
          theEncounter = ($("label[for='"+idVal+"']").text());
        });
      } 
      // 'theEncounter' is either the alt or the original
      // Now run the encounter
      //alert("The encounter is: " + theEncounter)
      
      $("#gameTableText").empty()
      
      switch (theEncounter) {
        case "Morgana": 
          $("#gameTableTitle").html("An Encounter with Morgana!")
          runMorgana()
        break;
        case "Castle Perilous":
          $("#gameTableTitle").html("An Encounter in Castle Perilous!")
          runCastlePerilous()
        break;
        case "Village of Plague and Death":
          $("#gameTableTitle").html("Village of Plague and Death!")
          runPlagueVillage()
        break;
        case "Grail Castle":
          $("#gameTableTitle").html("An Encounter in the Grail Castle!")
          runGrailCastle()
        break;
        case "Minions":
          $("#gameTableTitle").html("An Encounter with Minions!")
          runMinions()
        break;
        case "Undertake a Challenge!":
          $("#gameTableTitle").html("Undertake a Challenge!")
          runKnightChallengeQuest()
        break;
        case "A Heroic Quest":
          $("#gameTableTitle").html("A Heroic Quest!")
          runHeroicQuest()
        break;
        case "Village of Poverty and Famine":
          $("#gameTableTitle").html("Village of Poverty and Famine!")
          runPovertyVillage()
        break;
        case "Test of Piety":
          $("#gameTableTitle").html("A Test of Piety!")
          runTestOfPiety()
        break;
        case "Merlin":
          $("#gameTableTitle").html("An Encounter with Merlin!")
          runMerlin()
        break;
        
      }
    }
    
    function runMorgana() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      $("#gameTableText").html("Morgana uses trickery to make you forget.")
      
      //let pcRumors = playerCharacter.rumors
      let savesFailed = 0
      let outOfRumors = false
      
      // make three saves
      for (i=1; i<4; i++) {
        let savingThrow = rollDie(6)
        if (savingThrow < 4) {
          playerCharacter.rumors--
          savesFailed++
          if (playerCharacter.rumors < 0) outOfRumors = true
        }
      }
      
      if (playerCharacter.rumors < 0) playerCharacter.rumors = 0
      $("#topDivRumors").html(playerCharacter.rumors)
      
      if (savesFailed == 0) {
        $("#gameTableText").append("<p>You have successfully resisted Morgana's spell!</p>")
      } else {
      
        if (savesFailed > 1 && outOfRumors) {
          $("#gameTableText").append(`<p>You failed ${savesFailed} saves and face a challenger!</p>`)
        }
        if (savesFailed == 1 && outOfRumors) {
          $("#gameTableText").append(`<p>You failed ${savesFailed} save and face a challenger!</p>`)
        }
        if (savesFailed == 1  && !outOfRumors) {
          $("#gameTableText").append("<p>She causes you to forget 1 rumor.  Consider yourself lucky!</p>")
        }
        if (savesFailed > 1  && !outOfRumors) {
          $("#gameTableText").append(`<p>She causes you to forget ${savesFailed} rumors.  Consider yourself lucky!</p>`)
        }
      }
      // click to go to the Journey table  -- startEncounter for now!
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(gotoJourneyButton)
    }
    
    function runCastlePerilous() {
    
      //$("#gameTableText").empty()
      //$("#gameTableText").parent().empty()
      //$("#gameTableInfo").parent().empty()
      $("#gameButtons").empty()
      
      let castlePerilousQuest = castlePerilousTable[rollDie(6) -1]
      //let castlePerilousQuest = ""
      //alert("Your event is: " + castlePerilousQuest)
      $("#gameTableText").append(castlePerilousQuest)
      
      
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runPlagueVillage() {
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runGrailCastle() {
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runMinions() {
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runKnightChallengeQuest() {
      
      // NOTE! Fight a Knight OR Visit a Shrine (Pilgrimage Table)
      $("#gameTableText").append("You may fight a knight or undertake a perilous Pilgrimage to a Shrine.")
      
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollChallengeTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Fight Challenger!
        </button>
        <button onclick="rollPilgrimageTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to a Shrine!
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)        
    }
    
    
    
    function runHeroicQuest() {
    
      // NOTE! Heroic Quest OR Visit a Shrine (Pilgrimage Table)
      $("#gameTableText").append("You may embark on a Heroic Quest or undertake a perilous Pilgrimage to a Shrine!")
      
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollHeroicQuestTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Heroic Quest!
        </button>
        <button onclick="rollPilgrimageTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to a Shrine!
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString) 
      
      
      
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runPovertyVillage() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runTestOfPiety() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runMerlin() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    // -----------------------------------------------------
    // Encounter Table
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Traitors Table
    // -----------------------------------------------------
    
    function rollTraitorsTable() { 
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // number of captains slain modifies this roll
      // 1 captain = +1
      // 2-3 captains = +2
      // 4+ captains = +3
      let modifier = 0
      switch (playerCharacter.captainsSlain) {
        case 0:
          modifier = 0
        break;
        case 1:
          modifier = 1
        break;
        case 2:
        case 3:
          modifier = 2
        break;
        default:
          modifier = 3
      }
      let roll = (rollDie(6) + modifier)
      
      if (playerCharacter.onPilgrimage) roll = 1
      
      switch (roll) {
        case 1:
        case 2:
          $("#gameTableText").append(traitorsTable[0])
          playerCharacter.rebellionLevel++
          updateNavbar()
        break
        case 3:
        case 4:
          $("#gameTableText").append(traitorsTable[1])
          playerCharacter.rumors++
          playerCharacter.rebellionLevel++
          updateNavbar()
        break
        default:
          $("#gameTableText").append(traitorsTable[2])
      }
      let rowString = ""
      if (playerCharacter.onPilgrimage) {
        $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
        rowString = `
          <div class="d-flex mt-2">
          <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Continue Pilgrimage
          </button>
        </div>`
      } else {
        rowString = `
          <div class="d-flex mt-2">
          <button onclick="rollJourneyTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
        </div>`
      }
      $("#gameButtons").html(rowString)
    }
    
    // -----------------------------------------------------
    // Traitors Table
    // -----------------------------------------------------
    
    // -----------------------------------------------------
    // Challenge Table
    // -----------------------------------------------------
    
    let challengerName = ""
    
    function rollChallengeTable() {
      $("#gameTableText").empty()
      // add rebellion level to this roll
      let modifier = 0
      switch (playerCharacter.rebellionLevel) {
        case 0:
          modifier = 0
        break;
        case 1:
          modifier = 1
        break;
        case 2:
        case 3:
          modifier = 2
        break;
        default:
          modifier = 3
      }
      let roll = (rollDie(6) + modifier)
      
      switch (roll) {
        case 1:
        case 2:
        case 3:
        case 4:
        case 5:
          $("#gameTableText").append("A knight issues a challenge!")
          //gotoCombat()
          $("#gameTableTitle").append(" - a Knight")
          challengerName = "Sir Blank"
        break;
        case 6:
          $("#gameTableText").append("Sir Agravain issues a challenge!")
          $("#gameTableTitle").append(" - Sir Agravain")
          challengerName = "Sir Agravain"
        break;
        case 7:
          $("#gameTableText").append("Sir Garlon issues a challenge!")
          $("#gameTableTitle").append(" - Sir Garlon")
          challengerName = "Sir Agravain"
        break;
        case 8:
          $("#gameTableText").append("Sir Turquine issues a challenge!")
          $("#gameTableTitle").append(" - Sir Turquine")
          challengerName = "Sir Turquine"
        break;
        default:
          $("#gameTableText").append("Sir Mordred issues a challenge!")
          $("#gameTableTitle").append(" - Sir Mordred")
          challengerName = "Sir Mordred"
        break;
      }
      let rowString = `
        <div class="d-flex mt-2">
          <button onclick="knightChallenge(challengerName)" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Challenge
          </button>
        </div>`
      $("#gameButtons").html(rowString)
    }
    
    // -----------------------------------------------------
    // Challenge Table
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Pilgrimage Table
    // -----------------------------------------------------
    
    function rollPilgrimageTable() {
      $("#gameTableTitle").html("Pilgrimage!")
      playerCharacter.turn++
      updateNavbar()
      let rowString = ""
      
      // keep rolling until a 6 is rolled
      let roll = rollDie(6)
      modifier = playerCharacter.pilgrimageModifier
      console.log("Pilgrimage mod: " + modifier)
      playerCharacter.onPilgrimage = true
      roll == roll + modifier
      switch (roll) {
        case 1: 
          playerCharacter.pilgrimageModifier = (merchant > 0) ? 2 : 1;
          /*if (merchant > 0) {
            playerCharacter.pilgrimageModifier = 2
          } else {
            playerCharacter.pilgrimageModifier = 1
          }*/
          console.log("Pilgrimage mod is now: " + playerCharacter.pilgrimageModifier)
          $("#gameTableText").html("<p>This is taking too long!  Time is running out and traitors have attacked!</p>")
          rollTraitorsTable()
        break;
        case 2:
          $("#gameTableText").html("You enter a dense forest, slowing you down.")
          if (woodsman > 0) {
            $("#gameTableText").append("<br>Good thing you have a woodsman though!")
            playerCharacter.pilgrimageModifier = 0
          } else {
            $("#gameTableText").append("<br>Too bad you didn't have a woodsman.")
            playerCharacter.pilgrimageModifier = -1
          }
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 3:
          $("#gameTableText").html("You enter lawless area with many bandits.")
          if (mercenary > 0) {
            $("#gameTableText").append("<br>Which are dispatched in no time due to the help of your man-at-arms!")
            playerCharacter.pilgrimageModifier = 0
          } else {
            $("#gameTableText").append("<br>Too bad you didn't have any men-at-arms.")
            playerCharacter.pilgrimageModifier = -1
          }
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 4:
          $("#gameTableText").html("You meet other pilgrims who insist on story telling and feasting, slowing you down.")
          if (rogue > 0) {
            $("#gameTableText").append("<br>Thankfully, your rogue friend is very entertaining!")
            playerCharacter.pilgrimageModifier = 0
          } else {
            $("#gameTableText").append("<br>Too bad you didn't have any rogues in your group of retainers.")
            playerCharacter.pilgrimageModifier = -1
          }
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 5:
          $("#gameTableText").html("You meet a physician.  He can heal you for 5 silver pieces")
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 6:
          $("#gameTableText").html("You reach the shrine, the pilgrimage is over!")
          rowString = `
            <div class="d-flex mt-2">
              <button onclick="rollJourneyTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Journey On
              </button>
            </div>`
          $("#gameButtons").html(rowString)
        break
      }
      
      
    }
    
    // -----------------------------------------------------
    // Pilgrimage Table
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Heroic Quest Table
    // -----------------------------------------------------
    
    function rollHeroicQuestTable() {
    
    }
    
    // -----------------------------------------------------
    // Heroic Quest Table
    // -----------------------------------------------------
    
    
    
    // -----------------------------------------------------
    // Retainers
    // -----------------------------------------------------
    
    function showRetainersModal() {
      $("#modalTitle").html("Retainers")
      let retainersTable = `
        <div class='row'>
        <div class="col-lg-12 bg-white rounded shadow-sm mb-5">
            <div class="table-responsive">
              <table class="table" id="showRetainersTable">
                <thead>
                  <tr>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Name</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Profession</div>
                    </th>
                  </tr>
                </thead>
                <tbody id="showRetainerTableBody">
                  <!-- Javascript fills in the table here -->
                </tbody>
              </table>
            </div> <!-- End Table container -->
          </div> <!-- END column 1-->
      </div>  <!-- END row -->
      `
  
      $("#characterStatsModal").html(retainersTable)
      
      $.each(retainers, function(key, value) {

        let retainer_name = value.name
        let retainer_profession = value.profession

        let retainer_id = 0

        let retainerRow = `
          <tr>
            <td class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_name}</td>
            <td class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_profession}</td>
          </tr>
        `
        //console.log("Name: " + retainer_name + " Profession: " + retainer_profession);
        $("#showRetainersTable").append(retainerRow)
      });
    }
    
    function manageRetainersModal() {
      $("#modalTitle").html("Manage Retainers")
      let retainerHireFireTable = `
        <div class='row'>
        <div class="col-lg-12 bg-white rounded shadow-sm mb-5">
            <div class="table-responsive">
              <table class="table" id="manageRetainersTable">
                <thead>
                  <tr>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Name</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Profession</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Status</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Cost</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-center text-dark">Re-Employ / Fire</div>
                    </th>
                  </tr>
                </thead>
                <tbody id="retainerTableBody">
                  <!-- Javascript fills in the table here -->
                </tbody>
              </table>
            </div> <!-- End Table container -->
          </div> <!-- END column 1-->
      </div>  <!-- END row -->
      `
  
      $("#characterStatsModal").html(retainerHireFireTable)
  
      // this is the same as the jQuery loop below
      /*Object.keys(retainers).forEach(function (item) {
        retainter_name = retainers[item].name
        retainer_profession = retainers[item].profession
      })*/
  
      $.each(retainers, function(key, value) {

        let retainer_name = value.name
        let retainer_profession = value.profession
        let retainer_cost = value.cost

        value.employed = false

        let retainer_status = value.employed
        let retainer_id = 0
        var status = retainer_status ? retainer_status = "Retained" : retainer_status = "Not Retained"

        let retainerRow = `
          <tr>
          <td class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_name}</td>
          <td class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_profession}</td>
          <td id="${retainer_name}_status"class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_status}</td>
          <td id="${retainer_name}_cost"class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_cost}</td>
          <td class="border-0 align-center text-left text-dark p-2 px-3 justify"> 
            <div class="d-flex justify-content-center px-2">
            <button data-id="${retainer_name}" type="button" class="re-employBtn btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Re-Employ
            </button>
            <button data-id="${retainer_name}" type="button" class="fireBtn btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Fire
            </button>
            </div>
          </td>
          </tr>
        `
        //console.log("Name: " + retainer_name + " Profession: " + retainer_profession);
        $("#manageRetainersTable").append(retainerRow)
      
      });
    
    
      // add possible new retainers
      
      if (availableRetainers.length > 0) {
        $.each(availableRetainers, function(key, value) {
          let retainer_name = value.name
          let retainer_profession = value.profession
          let retainer_cost = value.cost

          value.employed = false

          let retainer_status = value.employed
          let retainer_id = 0
          var status = retainer_status ? retainer_status = "Retained" : retainer_status = "Not Retained"

        let retainerRow = `
          <tr>
          <td class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_name}</td>
          <td class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_profession}</td>
          <td id="${retainer_name}_status"class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_status}</td>
          <td id="${retainer_name}_cost"class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_cost}</td>
          <td class="border-0 align-center text-left text-dark p-2 px-3 justify"> 
            <div class="d-flex justify-content-center px-2">
            <button data-id="${retainer_name}" type="button" class="re-employBtn btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Hire
            </button>
            </div>
          </td>
          </tr>
        `
        //console.log("Name: " + retainer_name + " Profession: " + retainer_profession);
        $("#manageRetainersTable").append(retainerRow)
      });
    }
  }
  
  
  $(document).on('click', '.re-employBtn', function () {
    var id = $(this).attr('data-id');
    //alert("You clicked: " + id)
    let statusId = "#"+ id + "_status"
    $(statusId).text("Retained")
    // get a handle on the correct object
    var obj = $.grep(retainers, function(obj){return obj.name === id;})[0];
    // set the object value to: true
    obj.employed = true
    //alert("the value of employed: " + obj.employed)
    // remove 5 silver from the character's money total
    let cost = "#"+ id + "_cost"
    playerCharacter.money -= cost
    updateNavbar()
  })
  
  $(document).on('click', '.fireBtn', function () {
    var id = $(this).attr('data-id');
    // make this a choice.  "Are you sure..."
    if (confirm("Are you sure you want to fire " + id + " ?")) {
      txt = "You pressed OK!";
      let statusId = "#"+ id + "_status"
      $(statusId).text("Fired")
      // get a handle on the correct object
      var obj = $.grep(retainers, function(obj){return obj.name === id;})[0];
      // set the object value to: false
      obj.employed = false
      
      // remove the object from the array
      retainers = $.grep(retainers, function(e){ 
           return e.name != id; 
      });
      // next we have to refresh the screen
      createTable()
      
      //=alert("the value of employed: " + obj.employed)
    } else {
      txt = "You pressed Cancel!";
    }
    
  })
    
    
    // -----------------------------------------------------
    // Retainers
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Inventory
    // -----------------------------------------------------
    
    let inventory = [
      {
        id: 0,
        name: "Longsword",
        type: "Hand Weapon",
        ranged: false,
        readied: true,
        cost: 6,
        damage_bonus: 2
      },
      {
        id: 1,
        name: "Short sword",
        type: "Light Hand Weapon",
        ranged: false,
        readied: false,
        cost: 5,
        damage_bonus: 1
      },
      {
        id: 2,
        name: "Leather Jerkin",
        type: "Light Armor",
        ranged: false,
        readied: true,
        cost: 5,
        damage_bonus: 0
      },
      {
        id: 3,
        name: "Padded Armor",
        type: "Light Armor",
        ranged: false,
        readied: true,
        cost: 4,
        damage_bonus: 0
      }
    ]
    
    function showInventory() {
      $("#modalTitle").html("Inventory")
      let inventoryTable = `
        <div class='row'>
      	<div class="col-lg-12 bg-white rounded shadow-sm mb-5">
          <div class="table-responsive">
          <table class="table" id="equipmentTable">
            <thead>
            <tr>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-left">Name</div>
                </th>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-left">Type</div>
                </th>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-left">Cost</div>
                </th>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-left">Sale Price</div>
                </th>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-center">Sell Item</div>
            </th>
            </tr>
            </thead>
          	<tbody id="inventoryTableBody">
          <!-- Javascript fills in the table here -->
              </tbody>
              </table>
              </div> <!-- End Table container -->
        </div> <!-- END column 1-->
      </div>  <!-- END row -->
      `
      $("#characterStatsModal").html(inventoryTable)

 
      // this is the same as the jQuery loop below
      /*Object.keys(retainers).forEach(function (item) {
        retainter_name = retainers[item].name
        retainer_profession = retainers[item].profession
      })*/
  
      $.each(inventory, function(key, value) {
        let item_id = value.id
        let item_name = value.name
        let item_type = value.type
        let item_cost = value.cost
        let divisor = 2
        let res = (item_cost % divisor)
        let item_salePrice = (item_cost - res) / divisor
    
    
        let inventoryRow = `
          <tr>
          <td id="name_${item_id}" class="border-0 align-center text-left p-2 px-3"> ${item_name}</td>
          <td class="border-0 align-center text-left p-2 px-3"> ${item_type}</td>
          <td class="border-0 align-center text-left p-2 px-3"> ${item_cost}</td>
          <td id="salePrice_${item_id}" class="border-0 align-center text-left p-2 px-3"> ${item_salePrice}</td>
          <td class="border-0 align-center text-left p-2 px-3 justify"> 
            <div class="d-flex justify-content-center px-2">
            <button data-id="${item_id}" type="button" class="sellBtn btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Sell
            </button>
            </div>
          </td>
          </tr>
        `
    
      //console.log("Name: " + retainer_name + " Profession: " + retainer_profession);
      $("#inventoryTableBody").append(inventoryRow)
    });
    
    }
    
    
    // -----------------------------------------------------
    // Inventory
    // -----------------------------------------------------
    
    // -----------------------------------------------------
    // Combat
    // -----------------------------------------------------
    
    // Notes: 35 HP is probably a good amount for named/tough encounters
    // 20-25 for things like bears, boars, etc
    // 10-12 for minions
    // add 2 HP per Rebellion Level
    
    
    
    // Constructor function for NPC objects
    function NPC(name, cur_hp, max_hp, armor, attack, att_mod, dmg_mod, sex, isAlive) {
      this.name = name;
      this.cur_hp = cur_hp;
      this.max_hp = max_hp + (playerCharacter.rebellionLevel * 2);
      this.armor = armor + (playerCharacter.rebellionLevel);
      this.attack = attack;
      this.att_mod = att_mod + playerCharacter.rebellionLevelMod;
      this.dmg_mod = dmg_mod + playerCharacter.rebellionLevelMod;
      this.sex = sex;
      this.isAlive = isAlive;
    }

    var round = 1
    var initiative = "pc"
  
    function knightChallenge(name) {
      
    
      // Create a knight object
      //alert("a challenge from: " + name)
      let aKnight = new NPC(name, 35, 35, 1, 7, 2, 2, "male", "true");
      
      console.log("knight name: " + aKnight.name)
      combat(aKnight)
      
    }
    
    function combat(aKnight) {
      console.log("combat function round: " + round)
      $("#gameTableText").empty()
      //$("#attackBtn").html('Attack')
      //let round = 1

      //alert("A challenge from: " + aKnight.name)

      if (round == 1) {
        $("#gameTableText").append("<p id='npcParagraph'>Your Opponent is: <strong>" + aKnight.name + "!!!</strong></p>")
        let roll_1d6 = rollDie(6);
        if (roll_1d6 < 4) {
          initiative = "npc"
          $("#gameTableText").append("<p id='storyDivHead'>" + aKnight.name + " won initiative and has attacked first!</p>")
        } else {
          initiative = "pc"
          $("#gameTableText").append("<p id='storyDivHead'>You have won initiative.  Attack, flee... or talk.</p>")
        }
      }

      //console.log("made it here")
      // add buttons to the top of the div
      // they will stay until combat is over
      //let rowString = "<p><strong>" + npc_name + "</strong> has the initiative.</p>"

      let rowString = `<div id="combatCommandButtons" class="d-flex my-3 justify-content-between">
      <button id="attackBtn2" class="attackBtn btn btn-dark px-4 rounded-pill">Attack!</button>
      <button id="fleeBtn2"class="innBtn btn btn-dark px-4 rounded-pill">Flee!</button>
      <button id="parlayBtn2"class="innBtn btn btn-dark px-4 rounded-pill">Parlay!</button>
      </div>`
      $("#gameButtons").html(rowString)
      // Add a table to log combat
      rowString =
          `<div class="table-responsive">
            <table class="table" id="combatTable">
              <thead>
                <tr>
                  <th scope="col" class="border-0 bg-light">
                    <div class="p-1 px-3 text-uppercase">Round</div>
                  </th>
                  <th scope="col" class="border-0 bg-light">
                    <div class="p-1 px-3 text-uppercase">Result</div>
                  </th>
                </tr>
              </thead>
              <tbody id="combatTableBody">
                <!-- Javascript fills in the table here -->
              </tbody>
            </table>
          </div> <!-- End Table container -->`
        $("#gameTableText").append(rowString)
      if (round == 1 && initiative == "npc") {
        // npc attacks first
        console.log("npc has the initiative")
        npcAttack(round)
      }
      // attach onClick events
      $("#attackBtn2").off("click")
      $(document).off("click")
      $(document).on('click', '#attackBtn2', function () {
      //$("attackBtn").on('click', function() {
        //$(document.body).scrollTop($('#storyAnchor').offset().top);
        
      if (round > 1) {
      	if (initiative == "npc") {
          $("#storyDivHead").html('<p>' + aKnight.name + ' still has the initiative</p>')
        } else {
          $("#storyDivHead").html('<p>' + playerCharacter.name + ' has the initiative</p>')
        }
      }
        
        console.log("attack button2 clicked")
        console.log("round: " + round)
        console.log("initiative: " + initiative)
        if (initiative == "pc") {
          $("#combatTableBody").empty()
          playerAttack(round, aKnight)
          npcAttack(round, aKnight)
        }
        if (initiative == "npc" && round == 1) {
          playerAttack(round, aKnight)
        }
        if (initiative == "npc" && round > 1) {
          $("#combatTableBody").empty()
          npcAttack(round, aKnight)
          playerAttack(round, aKnight)
        } 
        round++
      });
      $("#fleeBtn2").off("click")
      $(document).on('click', '#fleeBtn2', function () {
      //$(fleeBtn).on('click', function () {
        console.log("second flee button clicked")
        flee(aKnight)
        //console.log(this.value);
      });
      $("#parlayBtn").off("click")
      $(document).on('click', '#parlayBtn2', function() {
      //$("#parlayBtn").on('click', function () {
        console.log("second parlay button clicked")
        parlay(aKnight)
        //console.log(this.value);
      });
    }
    
    function playerAttack(round, aKnight) {
      // roll to hit
      let first_d6Roll = Math.floor(Math.random() * 6) + 1;
      let second_d6Roll = Math.floor(Math.random() * 6) + 1;
      let twoD6 = first_d6Roll + second_d6Roll
      if (twoD6 >= playerCharacter.attack - playerCharacter.att_mod) {
        // a hit!  now calc dmg
        console.log("PC rolled a hit!")
        let dmg = twoD6 - playerCharacter.attack
        dmg += playerCharacter.dmg_mod
        if (dmg <= aKnight.armor) {
          // saved by armor!
          console.log("hit but made armor save")
          rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
          rowString += `<td class="border-0 defaultText"> You hit ${aKnight.name} for 0 damage!</td></tr>`
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-center"> You hit ' + npc_name + " 0 damage!</td></tr>")
          $("#combatTableBody").append(rowString)
        } else {
          // npc takes damage
          dmg = dmg - aKnight.armor
          aKnight.cur_hp = aKnight.cur_hp - dmg
          console.log("you hit for " + dmg + " points of damage")
          rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
          rowString += `<td class="border-0 defaultText">You hit ${aKnight.name} for ${dmg} points of damage!`
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-center">You hit ' + npc_name + " for " + dmg + " points of damage!</td></tr>")
          $("#combatTableBody").append(rowString)
        }
      } else {
        console.log("You attacked but missed!")
        rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
        rowString += `<td class="border-0 defaultText">You attacked ${aKnight.name} but missed!</td></tr>`
        //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
        //$("#combatTableBody").append('<td class="border-0 text-center">You attacked ' + npc_name + " but missed!</td></tr>")
        $("#combatTableBody").append(rowString)
      }
    }
    
    function npcAttack(round, aKnight) {
      let rowString = ""
      // npc attacks first
      // if the PC is not dead the the PC can act
      let first_d6Roll = Math.floor(Math.random() * 6) + 1;
      let second_d6Roll = Math.floor(Math.random() * 6) + 1;
      let twoD6 = first_d6Roll + second_d6Roll
      if (twoD6 > 6) {
        // a hit!  now calc dmg
        console.log("npc rolled a hit")
        let dmg = twoD6 - 6
        dmg += aKnight.dmg_mod
        if (dmg <= playerCharacter.armor) {
          // saved by armor!
          console.log("hit but made armor save")
          rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
          rowString += `<td class="border-0 defaultText">${aKnight.name} hits you for 0 damage!</td></tr>`
          $("#combatTableBody").append(rowString)
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-center">' + npc_name + " hits you for 0 damage!</td></tr>")
        } else {
          // pc takes damage
          dmg = dmg - playerCharacter.armor
          playerCharacter.cur_hp = playerCharacter.cur_hp - dmg
          console.log("you were hit for " + dmg + " point(s) of damage")
          rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
          rowString += `<td class="border-0 defaultText">${aKnight.name} hits you for ${dmg} points of damage!</td></tr>`
          $("#combatTableBody").append(rowString)
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-center">' + npc_name + " hits you for " + dmg + " points of damage!</td></tr>")
          
          // check to see if the pc is alive, knocked out or dead
          if (playerCharacter.cur_hp < 6 && playerCharacter.cur_hp > 0) {
        	// PC is knocked out
            console.log("PC is alive but knocked out")
            $("#storyDivHead").empty()
            $("#npcParagraph").empty()
            $("#storyDivHead").html('<p>' + playerCharacter.name + ' has been knocked out by ' + aKnight.name + '!  You had best start praying for mercy!</p>')
            
            // empty the combatCommandButtons and then replace them with a single button to go to the start
            $("#gameButtons").empty()
            
            let rowString = `<div class="col text-center">
                <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i class="mt-2 mr-2"></i>Click to Start Over</button>
                </div>`
            $("#gameButtons").html(rowString)
            
            //$("#storyDiv").append(rowString)
            $("#beginAdventure").off('click')
            $("#beginAdventure").click(function () {
              //$("#storyDiv").empty()
              //$("#storyDiv").append("<p>Your Opponent is: </p>")
              startGame()
              //rollNPCTable()
            })
          }
          if (playerCharacter.cur_hp < 1) {
            // pc is dead!
            console.log("PC has died")
            $("#storyDivHead").empty()
            $("#npcParagraph").empty()
            $("#storyDivHead").html('<p>' + playerCharacter.name + ' has been slain by ' + aKnight.name + '!  May God speed ' + playerCharacter.name + ' on his way to his eternal reward!</p>')
            
            // empty the combatCommandButtons and then replace them with a single button to go to the start
            $("#gameButtons").empty()
            
            let rowString = `<div class="col text-center">
                <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i class="mt-2 mr-2"></i>Click to Start Over</button>
                </div>`
            $("#gameButtons").html(rowString)
            
            //$("#storyDiv").append(rowString)
            $("#beginAdventure").off('click')
              $("#beginAdventure").click(function () {
              //$("#storyDiv").empty()
              //$("#storyDiv").append("<p>Your Opponent is: </p>")
              startGame()
              //rollNPCTable()
            })
          }
          updateNavbar()
        }
      } else {
        console.log("your opponent missed!")
        let rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
        rowString += `<td class="border-0 defaultText">${aKnight.name} attacked but missed!</td></tr>`
        $("#combatTableBody").append(rowString)
        //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
        //$("#combatTableBody").append('<td class="border-0 text-center">' + npc_name + " attacked but missed!</td></tr>")
      }
    }
    
    function flee(aKnight) {
      console.log("flee function")
      $("#gameTableText").empty()
      $("#gameTableText").append("<p>" + aKnight.name + " laughs at you as you flee like a coward!</p>")
      $("#gameTableText").append("<p>If you're not too chicken to fight, click the button below to summon another opponent</p>")
      let rowString = `<div class="col text-center">
              <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i
                  class="mt-2 mr-2"></i>Summon Opponent!</button>
            </div>`
      $("#gameTableText").append(rowString)
      //initGame()
      
      $("#beginAdventure").click(function () {
        $("#gameTableText").empty()
        //$("#storyDiv").append("<p>Your Opponent is: </p>")
        startGame() 
      }) 
    }
    
    function parlay(aKnight) {
      console.log("parlay function")
      let roll_1d6 = Math.floor(Math.random() * 6) + 1;
      
      if (roll_1d6 < 4) {
        let pronoun = (aKnight.sex == "male") ? "He" : "She"
        
        console.log(aKnight.name + " is: " + aKnight.sex)
        
        $("#gameTableText").empty()
        $("#gameTableText").append("<p>" + aKnight.name + " is not interested in conversation. "+ pronoun + " attacks!</p>")
        /*let rowString = `<div class="d-flex mt-2 justify-content-between">
  <a href="#" id="attackBtn3" class="attackBtn btn btn-dark px-4 rounded-pill">Go To Combat!</a></div>`*/
  
        var rowString = `<div class="col text-center">
            <button id="attackBtn3" type="button" class="btn btn-dark px-4 rounded-pill"><i
            class="mt-2 mr-2"></i>Go To Combat!</button>
            </div>`
            
        $("#gameTableText").append(rowString)
        $(document).off('click')
        $(document).on('click', '#attackBtn3', function () {
          combat()
          //console.log(this.value);
        });
      } else {
        peace = true
        $("#gameTableText").empty()
        $("#gameTableText").append("<p>" + aKnight.name + " agrees to live and let live... for now.</p>")
        let rowString = `<div class="col text-center">
              <button id="beginAdventure" type="button" class="btn btn-dark px-4 rounded-pill"><i
                  class="mt-2 mr-2"></i>Summon Opponent!</button>
            </div>`
        $("#storyDiv").append(rowString)
        $("#beginAdventure").off('click')
        $("#beginAdventure").click(function () {
          $("#gameTableText").empty()
          //$("#storyDiv").append("<p>Your Opponent is: </p>")
          startGame()
        })
      }
    }
    
    
    
    
    
    
    // -----------------------------------------------------
    // Combat
    // -----------------------------------------------------
    
    
    
    
    
  </script>

</body>

</html>
