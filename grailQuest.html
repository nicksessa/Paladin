<!DOCTYPE html>
<html>

<head>
  <title>The Grail Quest</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <!-- Import Custom Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IM Fell English SC">

  <style>
    body {
      font-family: 'IM Fell English SC', serif;
      color: blanchedalmond;
      /* Location of the image */
      background-image: url("https://cdna.artstation.com/p/assets/images/images/001/796/342/large/andreas-rocha-oldforestb02.jpg?1452860763");
      
      /* this is the google drive version: */
      background-image: url("https://drive.google.com/uc?export=view&id=14muus5B7-Qj1L57aNh2vAeERkGQq9eTU");
      
      /* Background image is centered vertically and horizontally at all times */
      background-position: center center;
      /* Background image doesn't tile */
      background-repeat: no-repeat;
      /* Background image is fixed in the viewport so that it doesn't move when 
       the content's height is greater than the image's height */
      background-attachment: fixed;
      /* This is what makes the background image rescale based
       on the container's size */
      background-size: cover;
      /* Set a background color that will be displayed
       while the background image is loading */
      background-color: #464646;
    }
    .parchment {
      background-image: url("http://drive.google.com/uc?export=view&id=1ekfXcSNZ2xz4JmwGsq1xjx1ywGM5J7Sw");
      /* Background image is centered vertically and horizontally at all times */
      background-position: center center;
      /* Background image doesn't tile */
      background-repeat: no-repeat;
      /* Background image is fixed in the viewport so that it doesn't move when 
       the content's height is greater than the image's height */
      background-attachment: fixed;
      /* This is what makes the background image rescale based
       on the container's size */
      background-size: cover;
      /* Set a background color that will be displayed
       while the background image is loading */
      background-color: #464646;
      background-size: 100% 100%;
      box-shadow: 7px 7px 8px black, -4px -1px 8px black;
      box-shadow: 7px 7px 8px #1c1d1f, -4px -1px 8px #1c1d1f;
      
    }
    .topBar {
      /*order-radius: 30px;*/
      border-bottom-right-radius: 30px;
      border-top-right-radius: 30px;
      opacity: 0.9;
      border: 2px solid blanchedalmond;
    }
    /* change the background color */
    .navbar-custom {
      background-color: #ff5500;
    }
    /* change the brand and text color */
    .navbar-custom .navbar-brand,
    .navbar-custom .navbar-text {
      color: blanchedalmond;
    }
    /* change the link color */
    .navbar-custom .navbar-nav .nav-link {
      color: blanchedalmond;
    }
    /* change the color of active or hovered links */
    .navbar-custom .nav-item.active .nav-link,
    .navbar-custom .nav-item:focus .nav-link,
    .navbar-custom .nav-item:hover .nav-link {
      color: gold;
    }
    .bottom-right {
      bottom: 0;
      right: 0;
    }
    .textBlock-bg {
      opacity: 0.9;
      color: blanchedalmond;
    }
    .customBtn {
      border: 2px solid blanchedalmond;
    }
    .btn {
      color: blanchedalmond;
    }
    .sideMenuBtn {
      color: black;
    }
    .sideMenuBtn:hover {
      color: blue;
      text-shadow: 1px 1px 2px black, 0 0 25px yellow, 0 0 5px red;
      color: black;
      text-shadow: 1px 1px 2px black, 0 0 25px yellow, 0 0 5px red;
      font-size: x-large;
    }
    .footer {
      border: 2px solid blanchedalmond;
      border-top-left-radius: 30px;
      border-bottom-left-radius: 30px;
      position: fixed;
      right: 0;
      bottom: 0;
      /*width: 50%;*/
      background: rgba(41, 43, 44, 0.8);
      text-align: center;
    }
    .modal-body {
      background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.9) 100%), url("https://cdna.artstation.com/p/assets/images/images/007/566/572/large/dominik-mayer-inktober-02.jpg?1507027593");
      /* Background image is centered vertically and horizontally at all times */
      background-position: top center;
      /* Background image doesn't tile */
      background-repeat: no-repeat;
      /* Background image is fixed in the viewport so that it doesn't move when 
       the content's height is greater than the image's height */
      background-attachment: fixed;
      /* This is what makes the background image rescale based
       on the container's size */
      background-size: cover;
      /* Set a background color that will be displayed
       while the background image is loading */
      background-color: #464646;
      background-color: rgba(41, 43, 44, 0.8);
    }
    .modal-title {
      color: blanchedalmond;
    }
    
    .table {
      color: blanchedalmond;
    }
    
    th, tr {
      border: none;
      text-align: center;
      padding: 0px 5px;
    }

    .bodyDiv {
      height: 80%;
      height: 350px;
      
      overflow-y: auto;
    }
    .text-left {
      text-align: left !important;
    }
  </style>
</head>

<body>

  <div class="container-fluid">

    <div class="row">
      <!-- top row -->
      <!-- <div class="col-6 pl-0"> -->
      <div class="pt-0 bg-dark d-flex flex-wrap topBar p-1 border-left-0 border-top-0">
        <button type="button" class="btn btn-dark" data-toggle="collapse" data-target="#collapseExample"
          aria-expanded="false" aria-controls="collapseExample">Menu</button>


        <button type="button" class="btn btn-dark text-left">The Grail Quest</button>
        
        
        <!-- top div table -->
        <div>
          <table class="table-condensed">
          <thead>
          <tr>
            <th class="m-0 p-0">
              <button data-toggle="modal" href="#myModal" type="button" class="btn btn-dark">
          <span id="topDivCharName" class="text-left">Sir Percival</span>
          
        </button>
            </th>
            <th class="align-bottom">Piety</th>
            <th class="align-bottom"><button type="button" class="btn btn-dark text-center align-bottom py-0"><strong>Healing <br> Potions</strong>
        </button></th>
            <th class="align-bottom">Money</th>
            <th class="align-bottom">Rumors</th>
            <th class="align-bottom">Rebellion<br> Level</th>
            <th class="align-bottom">Turn</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <span>HP: </span>
              <span id="topDivCurHP" class="bg-success rounded px-1 pb-1 mr-1">999 </span>
              <span> of </span>
              <span id="topDivMaxHP">999</span>
            </td>
            <td class="text-center"><span id="topDivPiety">999</span></td>
            <td class="text-center"><span id="topDivPotions">999</span></td>
            <td class="text-center"><span id="topDivMoney">999</span></td>
            <td class="text-center"><span id="topDivRumors">999</span></td>
            <td class="text-center"><span id="topDivRebellionLevel">999</span></td>
            <td class="text-center"><span id="topDivTurnCounter">999</span></td>
          </tr>

        </tbody>
        </table>
        
        </div>
      </div>
      <!-- </div> -->
      <!-- col -->
    </div> <!-- top row -->



    <div class="pt-5">
      <!-- spacer that we don't really need-->
    </div>

    <div class="row bodyDiv">
      <!-- body row -->

      <div class="col-3 px-0">
        <!-- first col (side menu goes here) -->

        <div class="d-flex flex-wrap">
          <div class="col px-0">

            <div class="collapse" id="collapseExample">

              <div class="bg-dark d-flex flex-wrap textBlock-bg parchment rounded">
                <div class="btn-group-vertical">
                  <button type="button" class="btn sideMenuBtn">Sign In/Sign Up</button>

                  <button type="button" class="btn sideMenuBtn">Save Game</button>

                  <button type="button" class="btn sideMenuBtn">Restart Game</button>
                  <button id="backgroundURL1_btn" class="btn sideMenuBtn rounded">Background 1</button>
                  <button id="backgroundURL2_btn" class="btn sideMenuBtn rounded">Background 2</button>

                </div>
              </div>
            </div>
          </div>

        </div> <!-- col -->
      </div> <!-- col -->
      
<!-- main body column -->
      
      <div class="col"> 
        <div class="d-flex flex-wrap">
          <div id="gameTableTitle" class="px-4 py-2 mb-2 bg-dark rounded shadow-sm textBlock-bg">
            GAME TABLE TITLE
          </div>
        </div>
        
        <div class="d-flex flex-wrap">
          <div id="gameTableText" class="px-4 py-2 bg-dark rounded shadow-sm textBlock-bg">
            --- GAME TABLE TEXT --- 
          </div>
        </div>

        <div id="gameButtons">
        </div>

      </div> <!-- column 2-->
      <div class="col-3"></div> <!-- column 3-->
    </div>
  </div>


  <!-- The Modal -->
  <div class="modal fade" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-white">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Character Sheet</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
          <div id="characterStatsModal" class="container text-dark">
            <h1>Name: Sir NOBODY</h1>
            <hr>
            <p>Hit Points: 30/30</p>
            <p>Attack: 7+</p>
            <p>Damage Modifier: +2 (longsword)</p>
            <p>Armor: 1 (padding)</p>
            <h3>Equipment</h3>
            <hr>
            <p>Longsword</p>
            <p>Chainmail</p>
            <p>Potion of Healing (x3)</p>

          </div>
        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div> <!-- modal -->
  </div> <!-- col -->
  </div> <!-- row -->
  </div> <!-- container -->


  </div> <!-- body col -->
  </div> <!-- body row -->



  <div class="container-fluid">
    <div class="row">
      <!-- footer row-->

      <div
        class="footer textBlock-bg pl-3 pt-2  border-bottom-0 border-right-0 bg-dark d-flex flex-wrap d-flex justify-content-end ">
        <button type="button" class="btn btn-dark text-left">Inventory</button>
        <button type="button" class="btn btn-dark text-left" data-toggle="modal" href="#myModal">Character</button>
        <button type="button" class="btn btn-dark text-left">Retainers</button>
        <button type="button" class="btn btn-dark text-left">View Log</button>
      </div>


    </div> <!-- footer row-->

  </div>




  <script>
    let backgroundImageURL1 = "https://cdna.artstation.com/p/assets/images/images/001/796/342/large/andreas-rocha-oldforestb02.jpg?1452860763"
    let backgroundImageURL2 = "https://cdnb.artstation.com/p/assets/images/images/020/284/017/large/andreas-rocha-cursedforesthr.jpg?1567153102"
    backgroundImageURL1 = "https://drive.google.com/uc?export=view&id=14muus5B7-Qj1L57aNh2vAeERkGQq9eTU"
    $(document).ready(function () {
      $("#backgroundURL1_btn").click(function () {
        //alert("Background color = " + $("p").css("background-color"));
        //alert("Background url = " + $("body").css("background-image"));
        $('body').css('background-image', 'url(' + backgroundImageURL1 + ')');
      });
      $("#backgroundURL2_btn").click(function () {
        //alert("Background color = " + $("p").css("background-color"));
        //alert("Background url = " + $("body").css("background-image"));
        $('body').css('background-image', 'url(' + backgroundImageURL2 + ')');
      });
    });
    
    // import the character.js file for the character object
    // check local storage for file.
    // Microsoft Edge does not like this: 
    /*
    let playerCharacterStats = localStorage.getItem("theGrailQuest_ryu2012_character")
    if (playerCharacterStats !== null && localStorage.playerCharacterStats !== '') {
    
    }
    let playerCharacterEquipment = localStorage.getItem("theGrailQuest_ryu2012_equipment")
    if (playerCharacterEquipment !== null && localStorage.playerCharacterEquipment !== '') {
    
    }
    let playerCharacterLog = localStorage.getItem("theGrailQuest_ryu2012_log")
    if (playerCharacterLog !== null && localStorage.playerCharacterLog !== '') {
    
    }
    */
    // Go here for more examples: https://www.w3schools.com/jsref/obj_storage.asp
    
    
  // this will close the menu on click outside the menu
  
  $(document).mouseup(function(e) 
  {
      var container = $("#collapseExample");
      // if the target of the click isn't the container nor a descendant of the container
      if (!container.is(e.target) && container.has(e.target).length === 0) 
      {
          container.collapse('hide');
      }
  });  
    
    // -----------------------------------------------------
    // On Load set the top div
    // -----------------------------------------------------
    
    let playerCharacter = {
      name: "Sir Percival",
      max_hp: 40,
      cur_hp: 25,
      armor: 1,
      attack: 7,
      att_mod: 0,
      dmg_mod: 2,
      exp: 0,
      money: 20,
      species: "human",
      sex: "male",
      healingPotions: 2,
      alive: true,
      rumors: 5,
      rebellionLevel: 2,
      turn: 5,
      piety: 2,
      sideQuests: 0,
      findRetainerModifier: 0,
      wasLost: false,
      captainsSlain: 0,
      onPilgrimage: false,
      pilgrimageModifier: 0
    }
    
    let retainers = []
    let adventureLog = []
    let merchant = 1
    let hunter = 0
    let mercenary = 0
    let rogue = 0
    
    //alert("Num Retainers: " + retainers.length)
    console.log("Num Retainers: " + retainers.length)
    
    updateNavbar()
    
    function updateNavbar() {
      $("#topDivCharName").html(playerCharacter.name)
      $("#topDivCurHP").html(playerCharacter.cur_hp)
      $("#topDivMaxHP").html(playerCharacter.max_hp)
      $("#topDivPiety").html(playerCharacter.piety)
      $("#topDivPotions").html(playerCharacter.healingPotions)
      $("#topDivMoney").html(playerCharacter.money)
      $("#topDivRumors").html(playerCharacter.rumors)
      $("#topDivRebellionLevel").html(playerCharacter.rebellionLevel)
      $("#topDivTurnCounter").html(playerCharacter.turn)
      // set color for HP
      // first unset all colors
      $("#topDivCurHP").removeClass(["bg-success", "bg-warning", "bg-danger", "bg-secondary"]);
      let a = Math.floor(playerCharacter.max_hp / 3);
      let firstThird = (playerCharacter.max_hp - a)
      let secondThird = (playerCharacter.max_hp - (a * 2))
      console.log("a: " + a)
      console.log("firstThird: " + firstThird)
      console.log("secondThird: " + secondThird)
      if (playerCharacter.cur_hp >= firstThird) {
        $("#topDivCurHP").addClass("bg-success")
      } else if (playerCharacter.cur_hp < firstThird && playerCharacter.cur_hp >= secondThird) {
        $("#topDivCurHP").addClass("bg-warning")
      } else if (playerCharacter.cur_hp > 0 && playerCharacter.cur_hp < secondThird) {
        $("#topDivCurHP").addClass("bg-danger")
      } else {
        $("#topDivCurHP").addClass("bg-secondary")
      }
    }
    
    // -----------------------------------------------------
    // Next, set the Character Stats Modal
    // -----------------------------------------------------
    
    let characterStats = `
      <div>
        <h1>${playerCharacter.name}</h1>
        <hr>
        <span>Hit Points: ${playerCharacter.cur_hp} / ${playerCharacter.max_hp}</span><br>
        <span>Attack: ${playerCharacter.attack}+</span><br>
        <span>Damage Modifier: ${playerCharacter.dmg_mod}</span><br>
        <span>Armor Modifier: ${playerCharacter.armor}</span><br>
        <hr>
        <h3>Equipment</h3>
        <span>Longsword</span><br>
        <span>Chainmail</span><br>
        <span>Shield</span><br>
      </div>
    `
    $("#characterStatsModal").html(characterStats)
    
    // -----------------------------------------------------
    // Journey Table
    // -----------------------------------------------------
        // Tables
    let journeyTable = [
      "You have found an inn at a Crossroads. You may choose to stay at the inn or face the danger that awaits. Choose wisely.",
      "an inn.  You may choose to stay at the inn or or bypass it by clicking on the Journey On button.",
      "You are lost! If you have a Merchant retainer, he knows of a shortcut, treat as a result of 1 on this table instead. If you don not have a merchant, roll on this table again with a +1.",
      "Roll on the Encounter Table (3).",
      "If the Rebellion Level is 4, roll on the Challenge Table (7). Otherwise, roll on the Encounter Table (3).",
      "If the Rebellion Level is 4, roll on the Challenge Table (7). Otherwise, roll on the Traitors Attack Table (4)."
    ]
    let innTable = [
      "Your paladin is turned away, roll on the Journey Table (1) again.",
      "Roll 2d6. If the result is 7 or less one of your retainers (if any) is killed in an ambush by ruffians. (randomly choose which one) Deduct -1 from the Rumor Roll. No new retainers are available.",
      "Roll 2d6. If the result is 5 or less, if you have coins, 3d6gp is stolen by a pickpocket. Deduct -1 from the Find Retainer roll.",
      "Greedy traders, all items cost double, and you sell treasures at half their value. Ignore this if you have a merchant retainer.",
      "Talkative innkeeper. Add +1 to the Rumor Roll.",
      "Add +1 to the Find Retainer roll if the roll is 5 or less.",
      "You get free food and lodging. Add +1 to the Find Retainer roll if the roll is 5 or less. New retainers are hired for 5gp.",
      "A wealthy noble donates 3d6 x 5gp to your worthy cause."
    ]
    
    let traitorsTable = [
      "You hear that a questing paladin has been killed by the traitors in a distant location. The Rebellion Level has increased!",
      "You find a questing paladin, mortally wounded by the traitors. Before he dies, he gives you some information. You have gained one rumor but the Rebellion Level has also increased!",
      "There are signs of a brave fight, but no dead questing paladin. This was a lucky escape, the traitors did not get their kill."
    ]
    
    
    // -----------------------------------------------------
    // Journey Table / Start Game
    // -----------------------------------------------------
    
    $(document).ready(function () {
      startGame()
    })
      
    // Start Game: Roll on the Journey Table
    function startGame() {
      $("#gameTableTitle").empty()
      $("#gameTableTitle").html("Journey Table")
      $("#gameButtons").empty()
      $("#gameTableText").html("Click below to roll on the Journey Table.")
      
      let runJourneyButton = `
          <div class="mt-2">
          <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
        `
      $("#gameButtons").html(runJourneyButton)
    }
    
    function rollJourneyTable() {
      $("#gameTableTitle").empty()
      $("#gameTableTitle").html("Journey Table")
      $("#gameTableText").empty()
      $("#gameTableText").html(`${playerCharacter.name} sets off on a journey and ...`)
      console.log("roll on the journey table")
      playerCharacter.turn++
      updateNavbar()
      
      let journeyRoll = rollDie(6)
      
      if (playerCharacter.wasLost) {
        journeyRoll++
        playerCharacter.wasLost = false
      }
      
      journeyRoll = 4
      //alert("The begin adventure button was clicked. You rolled: " + d6Roll);
      // Save turn data in the log (we'll push this to MySql at some point)
      adventureLog.push({ 'turn': playerCharacter.turn, 'roll': journeyRoll, 'result': journeyTable[journeyRoll - 1] });
      //logTurn()
      
      $("#gameButtons").empty()
      
      switch (journeyRoll) {
        // crossroads
        case 1:
          $("#gameTableTitle").append(" - Crossroads")
          crossroads()
          break;
        // Inn table or roll again
        case 2:
          $("#gameTableTitle").append(" - Journey on or Stay at Inn")
          journeyOrInn()
          break;
        // lost
        case 3:
          $("#gameTableTitle").append(" - Lost!")
          youAreLost()
          break;
        // Encounter
        case 4:
          $("#gameTableTitle").append(" - An Encounter!")
          rollEncounterTable()
          break;
        // Encounter or Challenge
        case 5:
          if (playerCharacter.rebellionLevel > 3) {
            $("#gameTableTitle").append(" - A Challenge!")
            rollChallengeTable()
          } else {
            $("#gameTableTitle").append(" - An Encounter!")
            rollEncounterTable()
          }
          break;
        // Traitors or Challenge
        case 6:
          if (playerCharacter.rebellionLevel > 3) {
            $("#gameTableTitle").append(" - A Challenge!")
            rollChallengeTable()
          } else {
            $("#gameTableTitle").append(" - Traitors!")
            rollTraitorsTable()
          }
          break;
      }
    };
    
// --- Crossroads ---
    
    function crossroads() {
      //$("#gameButtons").empty()
      $("#gameTableText").empty()
      $("#gameTableText").append(journeyTable[0])
      //$("#adventureLogTableBody").empty()
      // Inn or Encounter
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Inn
        </button>
        <button onclick="startEncounter()" data-id="startEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go To Encounter!
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)
    }
    
// --- Journey or Inn Choice---
    
    function journeyOrInn() {
      $("#gameTableText").append(journeyTable[1])
      
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey Onward!
        </button>
        <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Inn
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)  
    }
    
// --- Roll on the Inn Table ---    
    
    function rollInnTable() {
      // Successfully completed side quests will modify this roll.
      // 1 quest = +1
      // 2-3 quests = +2
      // 4 or more = +3
      
      let modifier = 0
      switch (playerCharacter.sideQuests) {
        case 0:
          modifier = 0
        break;
        case 1:
          modifier = 1
        break;
        case 2:
        case 3:
          modifier = 2
        break
        default:
          modifier = 3
      }
      
      $("#gameTableTitle").html("Inn Table")
      
      let rowString = ""
      // clear the story div
      $("#gameTableText").empty()
      playerCharacter.findRetainerModifier = 0
      
      console.log("roll on the inn table")
      adventureLog.push({ 'turn': playerCharacter.turn, 'roll': 'Player Choice', 'result': 'Stay at the Inn' });
      let roll_1d6 = rollDie(6) + modifier;
      console.log("roll + modifier: " + roll_1d6)
      //roll_1d6 = 1
      
      //$("#gameTableText").append(innTable[roll_1d6 - 1])
      
      switch (roll_1d6) {
        case 1:
          console.log("[1] Your paladin is turned away!  Journey on...")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': innTable[0] });
          $("#gameTableText").append("Your paladin is turned away.")
        break;
        case 2:
          console.log("[2] Grumpy Patrons")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Grumpy patrons' });
          playerCharacter.rumors--
          updateNavbar()
          rowString = "Grumpy patrons (rumors -1)"
          if (retainers > 0) {
            let first_d6Roll = Math.floor(Math.random() * 6) + 1;
            let second_d6Roll = Math.floor(Math.random() * 6) + 1;
            let twoD6 = first_d6Roll + second_d6Roll
            if (twoD6 < 8) {
              // random retainer has been killed
              rowString += "<br>If that wasn't bad enough, one of your retainers has been killed in an ambush!"
              adventureLog.push({ 'turn': playerCharacter.turn, 'roll': twoD6, 'result': 'One of your retainers has been killed!' });
            }
          }
          $("#gameTableText").append(rowString)
        break;
        case 3:
          console.log("[3] Shady Characters")
          $("#gameTableText").append("Shady characters abound, making it hard to find good help. (-1 to the retainer roll)<br>")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Shady Characters.' });
          let first_d6Roll = Math.floor(Math.random() * 6) + 1;
          let second_d6Roll = Math.floor(Math.random() * 6) + 1;
          let twoD6 = first_d6Roll + second_d6Roll
          if (twoD6 < 6) {
            let first_d6Roll = Math.floor(Math.random() * 6) + 1;
            let second_d6Roll = Math.floor(Math.random() * 6) + 1;
            let third_d6Roll = Math.floor(Math.random() * 6) + 1;
            let threeD6 = first_d6Roll + second_d6Roll + third_d6Roll
            rowString = "Robbed!"
            rowString += "<br>You lose " + threeD6 + " silver pieces."
            adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'You have been robbed!' });
            playerCharacter.money -= threeD6
            updateNavbar()
            $("#gameTableText").append(rowString)
          }
        break;
        case 4:
          console.log("[4] Greedy Traders")
          
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Greedy traders.' });
          if (merchant < 1) {
            // items cost double. items sold for half
            console.log("Greedy traders. Items cost double and are sold for half!")
            $("#gameTableText").append("Greedy Traders, everything costs double and everything you sell is at half the normal value!")
          } else {
            $("#gameTableText").append("Greedy Traders but your merchant is able to counter them!")
          }
        break;
        case 5:
          $("#gameTableText").append("Talkative innkeeper.  Add +1 to the Rumor Roll")
          console.log("[5] Talkative innkeeper")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Talkative innkeeper.' });
          playerCharacter.rumors++
          updateNavbar()
          break;
        case 6:
          let num = rollDie(6)
          if (num < 6) {
            console.log("[6] Abundant Retainers looking for work")
            $("#gameTableText").append("Abundant Retainers looking for work.  +1 to the Find Retainer Roll")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Add +1 to the Find Retainer roll.' });
            playerCharacter.findRetainerModifier++
          } else {
            $("#gameTableText").append("Nothing special happens this time.")
          }
        break;
        case 7:
          num = rollDie(6)
          if (num < 6) {
            console.log("[6] Free Food & Abundant Retainers looking for work!")
            $("#gameTableText").append("Abundant Retainers looking for work.  +1 to the Find Retainer Roll")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Add +1 to the Find Retainer roll.' });
            playerCharacter.findRetainerModifier++
          }
          $("#gameTableText").append("<br>Free food and lodging!")
          console.log("[7] Free food and lodging!")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Free food and lodging!' });
        break;
        case 8:
          console.log("[8] Wealthy patron donates to your cause!")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Wealthy nobel donates money to your cause!' });
          let money = 0
          for (let i=0; i<3; i++) {
            money += rollDie(6)
          }
          money = (5 * money)
          console.log("You gain: " + money + " silver pieces")
          $("#gameTableText").append(`<p>You gain ${money} silver pieces! </p>`)
          playerCharacter.money += money
          updateNavbar()
        break;
      }
      //logTurn()
      rowString = `
        <div class="d-flex mt-2">
        <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
        </button>
        </div>`
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)
    }
    
// --- You are lost ---
    function youAreLost() {
      $("#gameTableText").append("<p>becomes lost!</p>")
      console.log(journeyTable[2])
      let rowString = ""
      if (merchant == 0) {
        // roll again but with +1 to the roll
        // set wasLost to true which tells the journey table to add +1 to the journey roll
        $("#gameTableText").append("<br>You have no choice but to continue on...")
        playerCharacter.wasLost = true
        rowString += `
        <div class="d-flex mt-2">
        <button onclick="rollJourneyTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
        </button>
        </div>`
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      } else {
        // go to the crossroads
        $("#gameTableText").append("But luckily your Merchant friend knew a way to get you to an inn.")
        
        rowString += `
        <div class="d-flex mt-2">
        <button onclick="crossroads()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Crossroads
        </button>
        </div>`
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      }
    }
    
    
    
    // -----------------------------------------------------
    // Encounter Table
    // -----------------------------------------------------
    
    function rollDie (dieType) {
  	  let result = Math.floor(Math.random() * dieType + 1);
      return result
    }
    
    const encounterTable = {
      2: "Morgana",
      3: "Castle Perilous",
      4: "Village of Plague and Death",
      5: "Grail Castle",
      6: "Minions",
      7: "A Knight Issues a Challenge!",
      8: "Minions",
      9: "A Heroic Quest",
      10: "Village of Poverty and Famine",
      11: "Test of Piety",
      12: "Merlin"
    }
    
    
    let castlePerilousTable = [
      "The White Knight. In a room you see a white shield with red cross, the Shield of Evalach. It is guarded by a white† knight, level 7 with 8 life points. No quarter is asked or given. If you defeat the white knight, you may take the shield and get one XP roll. If you already have the shield, roll on this table again.",
      "Penance. You fall asleep. If you committed an act of Dishonor during the game, you wake up outside an abandoned church. Any armor, shield and weapon you had are stolen (except magical ones), and you are left with only a dagger (light slashing weapon). Treasures, coins and retainers remain with you. Otherwise, you heal 1 life point for a good night’s sleep.",
      "The Wanderer. You meet an immortal, over 1,000 years old. If you are currently under Dishonor, it is removed. He takes you to a crossroads, treat as if a 1 was rolled on the Inn Table (2)",
      "The Black Knight or the Red Knight? Opening a door you see two scenes. First: A questing paladin is about to be killed by a black† knight . Second: A maiden is about to be attacked by a red† knight . Choose who to save. If you save the maiden, roll for a piety point, but the Rebellion Level increases by 1 as the questing paladin dies. If you save the questing paladin, do not increase the Rebellion Level. You only fight one of the knights; they are both level 7 with 8 life points. You get an XP roll if you win. No quarter is asked or given. There is no treasure. ",
      "The Hermit. You meet an old hermit who can sell you up to 3 rumors for 50gp each (or at least that value in treasure).",
      "The Dwarf. At the castle gate, a dwarf with a cart offers you a lift. If you pay him 50 gold pieces (or at least that value in treasure), you, along with retainers, can be taken to any quest of your choice from the Side Quest Table (9). You can also ride for free, roll a d6; on a 1-3 go to event 7, and on a 4-6 go to event 9 on the Encounter Table (3)."
    ]  
    
    //let numRumors = 3
    //let pietyPoints = 1
    let altEncounter = false
    let theEncounter = "THE UNDERWORLD"
    
    //startEncounter()
    
    function startEncounter() {
      $("#gameTableTitle").html("Encounter Table")
      $("#gameButtons").empty()
      $("#gameTableText").html("Click below to generate an encounter.")
      
      let createEncounterButton = `
          <div class="mt-2">
          <button onclick="rollEncounterTable()" data-id="createEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Create Encounter
          </button>
        `
      $("#gameButtons").html(createEncounterButton)
    }
    
    
    // get encounter
    function rollEncounterTable() {
      $("#gameButtons").empty()
      $("#gameTableText").empty()
      
      let firstRoll = rollDie(6)
      let secondRoll = rollDie(6)
      let totalRoll = firstRoll + secondRoll
      
      totalRoll = 7
      
      altEncounter = false
      //alert("Roll: (" + firstRoll + " + " + secondRoll + ") = " + totalRoll)
      theEncounter = encounterTable[totalRoll]
      console.log("The encounter rolled: "+ theEncounter)
      //alert("You encounter: " + theEncounter)
      // create an encounter list in anticipation of the player spending rumor points to modify the results
      let encounterChoices = []
      // The table consists of two steps above and two steps below the result.
      // For example, if the player rolled a 7, then this object will consist of:
      // 5, 6, 8, 9
      // Note: cannot go lower than 2 or higher than 12
      if (totalRoll == 2) {
        encounterChoices.push(encounterTable[3])
        encounterChoices.push(encounterTable[4])
      }
      if (totalRoll == 3) {
        encounterChoices.push(encounterTable[2])
        encounterChoices.push(encounterTable[4])
        encounterChoices.push(encounterTable[5])
      }
      if (totalRoll == 4) {
        encounterChoices.push(encounterTable[2])
        encounterChoices.push(encounterTable[3])
        encounterChoices.push(encounterTable[5])
        encounterChoices.push(encounterTable[6])
      }
      if (totalRoll == 5) {
        encounterChoices.push(encounterTable[3])
        encounterChoices.push(encounterTable[4])
        encounterChoices.push(encounterTable[6])
        encounterChoices.push(encounterTable[7])
      }
      if (totalRoll == 6) {
        encounterChoices.push(encounterTable[4])
        encounterChoices.push(encounterTable[5])
        encounterChoices.push(encounterTable[7])
        encounterChoices.push(encounterTable[8])
      }
      if (totalRoll == 7) {
        encounterChoices.push(encounterTable[5])
        encounterChoices.push(encounterTable[6])
        encounterChoices.push(encounterTable[8])
        encounterChoices.push(encounterTable[9])
      }
      if (totalRoll == 8) {
        encounterChoices.push(encounterTable[6])
        encounterChoices.push(encounterTable[7])
        encounterChoices.push(encounterTable[9])
        encounterChoices.push(encounterTable[10])
      }
      if (totalRoll == 9) {
        encounterChoices.push(encounterTable[7])
        encounterChoices.push(encounterTable[8])
        encounterChoices.push(encounterTable[10])
        encounterChoices.push(encounterTable[11])
      }
      if (totalRoll == 10) {
        encounterChoices.push(encounterTable[8])
        encounterChoices.push(encounterTable[9])
        encounterChoices.push(encounterTable[11])
        encounterChoices.push(encounterTable[12])
      }
      if (totalRoll == 11) {
        encounterChoices.push(encounterTable[9])
        encounterChoices.push(encounterTable[10])
        encounterChoices.push(encounterTable[12])
      }
      if (totalRoll == 12) {
        encounterChoices.push(encounterTable[10])
        encounterChoices.push(encounterTable[11])
      }
      $("#gameTableText").empty()
      $("#gameTableTitle").html("An Encounter!")
      if (playerCharacter.rumors < 3) {
        $("#gameTableText").html(theEncounter)
        $("#gameButtons").empty()
        let gotoEncounterButton = `
          <div class="mt-2">
          <button onclick="gotoEncounter()" data-id="gotoEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go To Encounter
          </button>
        `
        $("#gameButtons").append(gotoEncounterButton)
      } else {
        //$("#gameTableInfo").parent().empty()
        //$("#gameTableText").html(theEncounter)
        $("#gameTableText").append("You have rolled a " + totalRoll + " (" + theEncounter + ") on the Encounter table.  Go to that encounter OR you may spend 3 rumors to select an encounter from the list below.")
        // show radio
        let formDiv = `
          <form id="altEncountersForm"></form>
        `
        $("#gameTableText").append(formDiv)
        $.each(encounterChoices, function( index, value ) {
          //alert( index + ": " + value );
          let myRadio = `
            <div class="mt-2 custom-control custom-radio">
              <input id="myRadio${index}" class="custom-control-input" type="radio" name="customRadio" disabled> 
              <label class="custom-control-label" for="myRadio${index}">${value}</label>
            </div>
      `
          $("#altEncountersForm").append(myRadio)
        });
        // Spend rumors Y/N  (button)
        
        let rumorButton = `
          <div class="mt-2">
          <button onclick="enableEncounters()" data-id="spendRumorsBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Click here to Spend 3 Rumors
          </button>
        `
        // Show radio options but make them all inactive
        $("#gameButtons").html(rumorButton)
        let gotoEncounterButton = `
          <div class="mt-2">
          <button onclick="gotoEncounter()" data-id="gotoEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go To Encounter
          </button>
        `
        $("#gameButtons").append(gotoEncounterButton)
      }
    }
    
    
    
    function enableEncounters () {
      playerCharacter.rumors = playerCharacter.rumors -3
      $("#topDivRumors").html(playerCharacter.rumors)
      
      
      $("input[type=radio]").attr('disabled', false);
      // remove the rumor button (empty the div)and then add back the gotoEncounter button
      $("#gameButtons").empty()
      let gotoEncounterButton = `
        <div class="mt-2">
        <button onclick="gotoEncounter()" data-id="gotoEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Go To Encounter
        </button>
      `
      $("#gameButtons").append(gotoEncounterButton)
      $("#gameTableText").append("Select one of the following encounters.")
      altEncounter = true
    }
    
    function gotoEncounter() {
      // check to see if the user went for the alternative encounters
      console.log("Alternative Encounter selected? " + altEncounter)
      if (altEncounter) {
        //theEncounter = $("#altEncountersForm input[type='radio']:checked").val()
        //theEncounter = $("input[name='customRadio']:checked").val()
        
        $("input[type='radio']:checked").each(function() {
          var idVal = $(this).attr("id");
          //alert($("label[for='"+idVal+"']").text());
          theEncounter = ($("label[for='"+idVal+"']").text());
        });
      } 
      // 'theEncounter' is either the alt or the original
      // Now run the encounter
      alert("The encounter is: " + theEncounter)
      
      $("#gameTableText").empty()
      
      switch (theEncounter) {
        case "Morgana": 
          $("#gameTableTitle").html("An Encounter with Morgana!")
          runMorgana()
        break;
        case "Castle Perilous":
          $("#gameTableTitle").html("An Encounter in Castle Perilous!")
          runCastlePerilous()
        break;
        case "Village of Plague and Death":
          $("#gameTableTitle").html("Village of Plague and Death!")
          runPlagueVillage()
        break;
        case "Grail Castle":
          $("#gameTableTitle").html("An Encounter in the Grail Castle!")
          runGrailCastle()
        break;
        case "Minions":
          $("#gameTableTitle").html("An Encounter with Minions!")
          runMinions()
        break;
        case "A Knight Issues a Challenge!":
          $("#gameTableTitle").html("A Knight Issues a Challenge!")
          runKnightChallengeQuest()
        break;
        case "A Heroic Quest":
          $("#gameTableTitle").html("A Heroic Quest!")
          runHeroicQuest()
        break;
        case "Village of Poverty and Famine":
          $("#gameTableTitle").html("Village of Poverty and Famine!")
          runPovertyVillage()
        break;
        case "Test of Piety":
          $("#gameTableTitle").html("A Test of Piety!")
          runTestOfPiety()
        break;
        case "Merlin":
          $("#gameTableTitle").html("An Encounter with Merlin!")
          runMerlin()
        break;
        
      }
    }
    
    function runMorgana() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      $("#gameTableText").html("Morgana uses trickery to make you forget.")
      
      //let pcRumors = playerCharacter.rumors
      let savesFailed = 0
      let outOfRumors = false
      
      // make three saves
      for (i=1; i<4; i++) {
        let savingThrow = rollDie(6)
        if (savingThrow < 4) {
          playerCharacter.rumors--
          savesFailed++
          if (playerCharacter.rumors < 0) outOfRumors = true
        }
      }
      
      if (playerCharacter.rumors < 0) playerCharacter.rumors = 0
      $("#topDivRumors").html(playerCharacter.rumors)
      
      if (savesFailed == 0) {
        $("#gameTableText").append("<p>You have successfully resisted Morgana's spell!</p>")
      } else {
      
        if (savesFailed > 1 && outOfRumors) {
          $("#gameTableText").append(`<p>You failed ${savesFailed} saves and face a challenger!</p>`)
        }
        if (savesFailed == 1 && outOfRumors) {
          $("#gameTableText").append(`<p>You failed ${savesFailed} save and face a challenger!</p>`)
        }
        if (savesFailed == 1  && !outOfRumors) {
          $("#gameTableText").append("<p>She causes you to forget 1 rumor.  Consider yourself lucky!</p>")
        }
        if (savesFailed > 1  && !outOfRumors) {
          $("#gameTableText").append(`<p>She causes you to forget ${savesFailed} rumors.  Consider yourself lucky!</p>`)
        }
      }
      // click to go to the Journey table  -- startEncounter for now!
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(gotoJourneyButton)
    }
    
    function runCastlePerilous() {
    
      //$("#gameTableText").empty()
      //$("#gameTableText").parent().empty()
      //$("#gameTableInfo").parent().empty()
      $("#gameButtons").empty()
      
      let castlePerilousQuest = castlePerilousTable[rollDie(6) -1]
      //let castlePerilousQuest = ""
      //alert("Your event is: " + castlePerilousQuest)
      $("#gameTableText").append(castlePerilousQuest)
      
      
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runPlagueVillage() {
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runGrailCastle() {
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runMinions() {
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runKnightChallengeQuest() {
      
      // NOTE! Fight a Knight OR Visit a Shrine (Pilgrimage Table)
      $("#gameTableText").append("You may fight a knight or undertake a perilous Pilgrimage to a Shrine.")
      
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollChallengeTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Fight Challenger!
        </button>
        <button onclick="rollPilgrimageTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to a Shrine!
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)        
    }
    
    
    
    function runHeroicQuest() {
    
      // NOTE! Heroic Quest OR Visit a Shrine (Pilgrimage Table)
      $("#gameTableText").append("You may embark on a Heroic Quest or undertake a perilous Pilgrimage to a Shrine!")
      
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollHeroicQuestTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Heroic Quest!
        </button>
        <button onclick="rollPilgrimageTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to a Shrine!
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString) 
      
      
      
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runPovertyVillage() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runTestOfPiety() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runMerlin() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="startGame()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    // -----------------------------------------------------
    // Encounter Table
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Traitors Table
    // -----------------------------------------------------
    
    function rollTraitorsTable() { 
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // number of captains slain modifies this roll
      // 1 captain = +1
      // 2-3 captains = +2
      // 4+ captains = +3
      let modifier = 0
      switch (playerCharacter.captainsSlain) {
        case 0:
          modifier = 0
        break;
        case 1:
          modifier = 1
        break;
        case 2:
        case 3:
          modifier = 2
        break;
        default:
          modifier = 3
      }
      let roll = (rollDie(6) + modifier)
      
      if (playerCharacter.onPilgrimage) roll = 1
      
      switch (roll) {
        case 1:
        case 2:
          $("#gameTableText").append(traitorsTable[0])
          playerCharacter.rebellionLevel++
          updateNavbar()
        break
        case 3:
        case 4:
          $("#gameTableText").append(traitorsTable[1])
          playerCharacter.rumors++
          playerCharacter.rebellionLevel++
          updateNavbar()
        break
        default:
          $("#gameTableText").append(traitorsTable[2])
      }
      let rowString = ""
      if (playerCharacter.onPilgrimage) {
        $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
        rowString = `
          <div class="d-flex mt-2">
          <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Continue Pilgrimage
          </button>
        </div>`
      } else {
        rowString = `
          <div class="d-flex mt-2">
          <button onclick="rollJourneyTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
        </div>`
      }
      $("#gameButtons").html(rowString)
    }
    
    // -----------------------------------------------------
    // Traitors Table
    // -----------------------------------------------------
    
    // -----------------------------------------------------
    // Challenge Table
    // -----------------------------------------------------
    
    function rollChallengeTable() {
      // add rebellion level to this roll
      let modifier = 0
      switch (playerCharacter.rebellionLevel) {
        case 0:
          modifier = 0
        break;
        case 1:
          modifier = 1
        break;
        case 2:
        case 3:
          modifier = 2
        break;
        default:
          modifier = 3
      }
      let roll = (rollDie(6) + modifier)
      switch (roll) {
        case 1:
        case 2:
        case 3:
        case 4:
        case 5:
          $("#gameTableText").append("A knight issues a challenge!")
          //gotoCombat()
        break;
        case 6:
          $("#gameTableText").append("Sir Agravain issues a challenge!")
        break;
        case 7:
          $("#gameTableText").append("Sir Garlon issues a challenge!")
        break;
        case 8:
          $("#gameTableText").append("Sir Turquine issues a challenge!")
        break;
        default:
          $("#gameTableText").append("Sir Mordred issues a challenge!")
        break;
      }
      let rowString = `
        <div class="d-flex mt-2">
          <button onclick="rollJourneyTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
        </div>`
      $("#gameButtons").html(rowString)
    }
    
    // -----------------------------------------------------
    // Challenge Table
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Pilgrimage Table
    // -----------------------------------------------------
    
    function rollPilgrimageTable() {
      $("#gameTableTitle").html("Pilgrimage!")
      playerCharacter.turn++
      updateNavbar()
      let rowString = ""
      
      // keep rolling until a 6 is rolled
      let roll = rollDie(6)
      modifier = playerCharacter.pilgrimageModifier
      console.log("Pilgrimage mod: " + modifier)
      playerCharacter.onPilgrimage = true
      roll == roll + modifier
      switch (roll) {
        case 1: 
          playerCharacter.pilgrimageModifier = (merchant > 0) ? 2 : 1;
          /*if (merchant > 0) {
            playerCharacter.pilgrimageModifier = 2
          } else {
            playerCharacter.pilgrimageModifier = 1
          }*/
          console.log("Pilgrimage mod is now: " + playerCharacter.pilgrimageModifier)
          $("#gameTableText").html("<p>This is taking too long!  Time is running out and traitors have attacked!</p>")
          rollTraitorsTable()
        break;
        case 2:
          $("#gameTableText").html("You enter a dense forest, slowing you down.")
          if (hunter > 0) {
            $("#gameTableText").append("<br>Good thing you have a hunter though!")
            playerCharacter.pilgrimageModifier = 0
          } else {
            $("#gameTableText").append("<br>Too bad you didn't have a woodsman.")
            playerCharacter.pilgrimageModifier = -1
          }
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 3:
          $("#gameTableText").html("You enter lawless area with many bandits.")
          if (mercenary > 0) {
            $("#gameTableText").append("<br>Which are dispatched in no time due to the help of your man-at-arms!")
            playerCharacter.pilgrimageModifier = 0
          } else {
            $("#gameTableText").append("<br>Too bad you didn't have any men-at-arms.")
            playerCharacter.pilgrimageModifier = -1
          }
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 4:
          $("#gameTableText").html("You meet other pilgrims who insist on story telling and feasting, slowing you down.")
          if (rogue > 0) {
            $("#gameTableText").append("<br>Thankfully, your rogue friend is very entertaining!")
            playerCharacter.pilgrimageModifier = 0
          } else {
            $("#gameTableText").append("<br>Too bad you didn't have any rogues in your group of retainers.")
            playerCharacter.pilgrimageModifier = -1
          }
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 5:
          $("#gameTableText").html("You meet a physician.  He can heal you for 5 silver pieces")
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 6:
          $("#gameTableText").html("You reach the shrine, the pilgrimage is over!")
          rowString = `
            <div class="d-flex mt-2">
              <button onclick="rollJourneyTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Journey On
              </button>
            </div>`
          $("#gameButtons").html(rowString)
        break
      }
      
      
    }
    
    // -----------------------------------------------------
    // Pilgrimage Table
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Heroic Quest Table
    // -----------------------------------------------------
    
    function rollHeroicQuestTable() {
    
    }
    
    // -----------------------------------------------------
    // Heroic Quest Table
    // -----------------------------------------------------
    
  </script>

</body>

</html>
