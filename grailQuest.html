<!DOCTYPE html>
<html>

<head>
  <title>The Grail Quest</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <!-- Import Custom Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IM Fell English SC">

  <style>
    body {
      font-family: 'IM Fell English SC', serif;
      color: blanchedalmond;
      /* Location of the image */
      background-image: url("https://cdna.artstation.com/p/assets/images/images/001/796/342/large/andreas-rocha-oldforestb02.jpg?1452860763");
      
      /* this is the google drive version: */
      background-image: url("http://drive.google.com/uc?export=view&id=14muus5B7-Qj1L57aNh2vAeERkGQq9eTU");
      
      background-image: url("./images/andreas-rocha-deepintheforest08.jpg");
      /* Background image is centered vertically and horizontally at all times */
      background-position: center center;
      /* Background image doesn't tile */
      background-repeat: no-repeat;
      /* Background image is fixed in the viewport so that it doesn't move when 
       the content's height is greater than the image's height */
      background-attachment: fixed;
      /* This is what makes the background image rescale based
       on the container's size */
      background-size: cover;
      /* Set a background color that will be displayed
       while the background image is loading */
      background-color: #464646;
    }
    .parchment {
      background-image: url("http://drive.google.com/uc?export=view&id=1ekfXcSNZ2xz4JmwGsq1xjx1ywGM5J7Sw");
      background-image: url("./images/Parchment.jpg");
      /* Background image is centered vertically and horizontally at all times */
      background-position: center center;
      /* Background image doesn'=t tile */
      background-repeat: no-repeat;
      /* Background image is fixed in the viewport so that it doesn't move when 
       the content's height is greater than the image's height */
      background-attachment: fixed;
      /* This is what makes the background image rescale based
       on the container's size */
      background-size: cover;
      /* Set a background color that will be displayed
       while the background image is loading */
      background-color: #464646;
      background-size: 100% 100%;
      box-shadow: 7px 7px 8px black, -4px -1px 8px black;
      box-shadow: 7px 7px 8px #1c1d1f, -4px -1px 8px #1c1d1f;
      
    }
    .topBar {
      /*order-radius: 30px;*/
      border-bottom-right-radius: 30px;
      border-top-right-radius: 30px;
      opacity: 0.9;
      border: 2px solid blanchedalmond;
      color: blanchedalmond;
    }
    /* change the background color */
    .navbar-custom {
      background-color: #ff5500;
    }
    /* change the brand and text color */
    .navbar-custom .navbar-brand,
    .navbar-custom .navbar-text {
      color: blanchedalmond;
    }
    /* change the link color */
    .navbar-custom .navbar-nav .nav-link {
      color: blanchedalmond;
    }
    /* change the color of active or hovered links */
    .navbar-custom .nav-item.active .nav-link,
    .navbar-custom .nav-item:focus .nav-link,
    .navbar-custom .nav-item:hover .nav-link {
      color: gold;
    }
    .bottom-right {
      bottom: 0;
      right: 0;
    }
    .textBlock-bg {
      opacity: 0.9;
      color: blanchedalmond;
    }
    .customBtn {
      border: 2px solid blanchedalmond;
    }
    .btn {
      color: blanchedalmond;
    }
    .sideMenuBtn {
      color: black;
    }
    .sideMenuBtn:hover {
      color: blue;
      text-shadow: 1px 1px 2px black, 0 0 25px yellow, 0 0 5px red;
      color: black;
      text-shadow: 1px 1px 2px black, 0 0 25px yellow, 0 0 5px red;
      font-size: x-large;
    }
    .sideMenuText {
      color: black;
    }
    
    .footer {
      border: 2px solid blanchedalmond;
      border-top-left-radius: 30px;
      border-bottom-left-radius: 30px;
      position: fixed;
      right: 0;
      bottom: 0;
      /*width: 50%;*/
      background: rgba(41, 43, 44, 0.8);
      text-align: center;
    }
    .modal-body {
      background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.9) 100%), url("https://cdna.artstation.com/p/assets/images/images/007/566/572/large/dominik-mayer-inktober-02.jpg?1507027593");
      /* Background image is centered vertically and horizontally at all times */
      background-position: top center;
      /* Background image doesn't tile */
      background-repeat: no-repeat;
      /* Background image is fixed in the viewport so that it doesn't move when 
       the content's height is greater than the image's height */
      background-attachment: fixed;
      /* This is what makes the background image rescale based
       on the container's size */
      background-size: cover;
      /* Set a background color that will be displayed
       while the background image is loading */
      background-color: #464646;
      background-color: rgba(41, 43, 44, 0.8);
    }
    .modal-title {
      color: blanchedalmond;
    }
    .defaultText {
      color: blanchedalmond;
    }
    
    .modal-dialog{
      position: relative;
      display: table; /* This is important */ 
      overflow-y: auto;    
      overflow-x: auto;
      width: auto;
      min-width: 300px;   
	}
    
    .table {
      color: black;
    }
    .textBlack {
      color: black;
    }
    
    th, tr {
      border: none;
      text-align: center;
      padding: 0px 5px;
      
    }
    .bodyDiv {
      height: 375px;
      height: 80%;
      
      
      overflow-y: auto;
    }
    .text-left {
      text-align: left !important;
    }
    
    .wideModal {
      width: 85%;
    }
    
    .bgOrange {
      background-color: orange;
    }
    
  </style>
</head>

<body>

  <div class="container-fluid">

    <div class="row">
      <!-- top row -->
      <!-- <div class="col-6 pl-0"> -->
      <div class="pt-0 bg-dark d-flex flex-wrap topBar p-1 border-left-0 border-top-0">
        <button type="button" class="btn btn-dark" data-toggle="collapse" data-target="#collapseExample"
          aria-expanded="false" aria-controls="collapseExample">Menu</button>


        <button type="button" class="btn btn-dark text-left"><strong>The Grail Quest</strong></button>
        
        
        <!-- top div table -->
        <div>
          <table class="table-condensed">
          <thead>
          <tr>
            <th class="m-0 p-0">
              <button onclick="setCharacterModal()" data-toggle="modal" href="#myModal" type="button" class="btn btn-dark">
          <span id="topDivCharName" class="text-left"><strong>Sir Percival</strong></span>
          
        </button>
            </th>
            <th class="align-bottom">Level</th>
            <th class="align-bottom">Piety</th>
            <th class="align-bottom"><button onclick="useHealingPotion()" type="button" class="btn btn-dark text-center align-bottom py-0"><strong>Healing <br> Potions</strong>
        </button></th>
            <th class="align-bottom">Money</th>
            <th class="align-bottom">Rumors</th>
            <th class="align-bottom">Rebellion<br> Level</th>
            <th class="align-bottom">Turn</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <span>HP: </span>
              <span id="topDivCurHP" class="bg-success rounded px-1 pb-1 mr-1">999 </span>
              <span> of </span>
              <span id="topDivMaxHP">999</span>
            </td>
            <td class="text-center"><span id="topDivLevel">999</span></td>
            <td class="text-center"><span id="topDivPiety">999</span></td>
            <td class="text-center"><span id="topDivPotions">999</span></td>
            <td class="text-center"><span id="topDivMoney">999</span></td>
            <td class="text-center"><span id="topDivRumors">999</span></td>
            <td class="text-center"><span id="topDivRebellionLevel" class="bg-success rounded px-1 pb-1 mr-1">999</span></td>
            <td class="text-center"><span id="topDivTurnCounter">999</span></td>
          </tr>

        </tbody>
        </table>
        
        </div>
      </div>
      <!-- </div> -->
      <!-- col -->
    </div> <!-- top row -->



    <div class="pt-5">
      <!-- spacer that we don't really need-->
    </div>

    <div class="row bodyDiv">
      <!-- body row -->

      <div class="col-3 px-0">
        <!-- first col (side menu goes here) -->

        <div class="d-flex flex-wrap">
          <div class="col px-0">

            <div class="collapse" id="collapseExample">

              <div class="bg-dark d-flex flex-wrap textBlock-bg parchment rounded">
                <div class="btn-group-vertical">
                  <button type="button" class="btn sideMenuBtn text-left">Sign In/Sign Up</button>

                  <button type="button" class="btn sideMenuBtn text-left">Save Game</button>

                  <button onclick="startNewGame()" type="button" class="btn sideMenuBtn text-left">Restart Game</button>
                  <button id="backgroundURL1_btn" class="btn sideMenuBtn rounded text-left">Background 1</button>
                  <button id="backgroundURL2_btn" class="btn sideMenuBtn rounded text-left">Background 2</button>

                </div>
              </div>
            </div>
          </div>

        </div> <!-- col -->
      </div> <!-- col -->
      
<!-- main body column -->
      
      <div class="col"> 
        <div class="d-flex flex-wrap">
          <div id="gameTableTitle" class="px-4 py-2 mb-2 bg-dark rounded shadow-sm textBlock-bg">
            GAME TABLE TITLE
          </div>
        </div>
        
        <div class="d-flex flex-wrap">
          <div id="gameTableText" class="px-4 py-2 bg-dark rounded shadow-sm textBlock-bg">
            --- GAME TABLE TEXT --- 
          </div>
        </div>

        <div id="gameButtons">
        </div>

      </div> <!-- column 2-->
      <div class="col-3">


<div class="d-flex flex-wrap">
  <div class="col px-0">
    <div class="collapse" id="npcCollapse">
      <div class="bg-dark d-flex flex-wrap textBlock-bg parchment rounded">
        <div id="npcPortrait" class="sideMenuText p-2">
          <h4 id="npcDivName">Sir Blank</h4>
          <hr>
          <span>HP: </span>
          <span id="npcDivCurHP" class="bg-success rounded px-1 pb-1 mr-1">999 </span>
          <span> of </span>
          <span id="npcDivMaxHP">999</span>
          <br>
          Attack: <span id="npcDivAttack">999</span>+<br>
          Damage Modifier: <span id="npcDivDmgMod">999</span><br>
          Armor: <span id="npcDivArmor">999</span><br><br>
          <h4>Equipment</h4>
          <hr>
          <span id="npcDivWeapon1">Longsword</span><br>
          <span id="npcDivWeapon2"></span><br>
          <span id="npcDivArmorType">Padded Gambeson</span><br>
        </div>
      </div>
    </div>
  </div>
</div>




      </div> <!-- column 3-->
    </div>
  </div>


  <!-- The Modal -->
  <div class="modal fade" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-white">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 id="modalTitle" class="modal-title">Character Sheet</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
          <div id="characterStatsModal" class="container text-dark">
            <h1>Name: Sir NOBODY</h1>
            <hr>
            <p>Hit Points: 30/30</p>
            <p>Attack: 7+</p>
            <p>Damage Modifier: +2 (longsword)</p>
            <p>Armor: 1 (padding)</p>
            <h3>Equipment</h3>
            <hr>
            <p>Longsword</p>
            <p>Chainmail</p>
            <p>Potion of Healing (x3)</p>

          </div>
        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div> <!-- modal -->
   
  </div> <!-- col -->
  </div> <!-- row -->
  </div> <!-- container -->


  </div> <!-- body col -->
  </div> <!-- body row -->



  <div class="container-fluid">
    <div class="row">
      <!-- footer row-->

      <div class="footer textBlock-bg pl-3 pt-2  border-bottom-0 border-right-0 bg-dark d-flex flex-wrap d-flex justify-content-end ">
        <button type="button" class="btn btn-dark" data-toggle="collapse" data-target="#npcCollapse"
          aria-expanded="false" aria-controls="npcCollapse">NPC</button>
        <button onclick="showInventory()" type="button" class="btn btn-dark text-left" data-toggle="modal" href="#myModal">Inventory</button>
        <button onclick="setCharacterModal()" type="button" class="btn btn-dark text-left" data-toggle="modal" href="#myModal">Character</button>
        <button onclick="showRetainersModal()" id="openRetainerModal" type="button" class="btn btn-dark text-left" data-toggle="modal" href="#myModal">Retainers</button>
        <button type="button" class="btn btn-dark text-left">View Log</button>
      </div>


    </div> <!-- footer row-->

  </div>




  <script>
  // -----------------------------------------
  // Global variables
  // -----------------------------------------

    let rebellionLevelIncreased = false



    let sideQuests = 
      [
        "Taulurd the Giant",
        "A Dragon",
        "The Green Knight",
        "The Questing Beast",
        "Three Blind Old Hags",
        "Laamorz the Wizard"
      ]

    let hagMoney = 0


  // -----------------------------------------
  // End Global variables
  // -----------------------------------------
  
  $('#myModal').on('show.bs.modal', function () {
      $('.modal-body',this).css({width:'auto',height:'auto', 'max-height':'100%'});
});
  
  
    let backgroundImageURL1 = "https://cdna.artstation.com/p/assets/images/images/001/796/342/large/andreas-rocha-oldforestb02.jpg?1452860763"
    let backgroundImageURL2 = "https://cdnb.artstation.com/p/assets/images/images/020/284/017/large/andreas-rocha-cursedforesthr.jpg?1567153102"
    backgroundImageURL1 = "https://drive.google.com/uc?export=view&id=14muus5B7-Qj1L57aNh2vAeERkGQq9eTU"
    $(document).ready(function () {
      $("#backgroundURL1_btn").click(function () {
        //alert("Background color = " + $("p").css("background-color"));
        //alert("Background url = " + $("body").css("background-image"));
        $('body').css('background-image', 'url(' + backgroundImageURL1 + ')');
      });
      $("#backgroundURL2_btn").click(function () {
        //alert("Background color = " + $("p").css("background-color"));
        //alert("Background url = " + $("body").css("background-image"));
        $('body').css('background-image', 'url(' + backgroundImageURL2 + ')');
      });
    });
    
    
    // This is the default if local storage does not exist
    let defaultPlayerCharacter = {
      name: "Sir Percival",
      level: 3,
      max_hp: 40,
      cur_hp: 40,
      armor: 3,
      attack: 6,
      att_mod: 0,
      dmg_mod: 2,
      exp: 0,
      money: 20,
      species: "human",
      sex: "male",
      healingPotions: 3,
      status: "alive",
      rumors: 0,
      rumorModifier: 0,
      rebellionLevel: 0,
      rebellionLevelMod: 0,
      turn: 0,
      piety: 0,
      sideQuests: 0,
      findRetainerModifier: 0,
      wasLost: false,
      captainsSlain: 0,
      onPilgrimage: false,
      pilgrimageModifier: 0,
      dishonor: false
    }
    
    // This is the PC object we update throughout the game
    let playerCharacter = {
      name: "Sir Percival",
      level: 3,
      max_hp: 40,
      cur_hp: 40,
      armor: 3,
      attack: 6,
      att_mod: 0,
      dmg_mod: 2,
      exp: 0,
      money: 20,
      species: "human",
      sex: "male",
      healingPotions: 3,
      status: "alive",
      rumors: 5,
      rumorModifier: 0,
      rebellionLevel: 0,
      rebellionLevelMod: 0,
      turn: 0,
      piety: 2,
      sideQuests: 0,
      findRetainerModifier: 0,
      wasLost: false,
      captainsSlain: 0,
      onPilgrimage: false,
      pilgrimageModifier: 0,
      dishonor: false
    }
    
    let retainers = []


    // Speed up calls to hasOwnProperty
    var hasOwnProperty = Object.prototype.hasOwnProperty;
    function isEmpty(obj) {
        // null and undefined are "empty"
        if (obj == null) return true;
        // Assume if it has a length property with a non-zero value
        // that that property is correct.
        if (obj.length > 0)    return false;
        if (obj.length === 0)  return true;
        // If it isn't an object at this point
        // it is empty, but it can't be anything *but* empty
        // Is it empty?  Depends on your application.
        if (typeof obj !== "object") return true;
        // Otherwise, does it have any properties of its own?
        // Note that this doesn't handle
        // toString and valueOf enumeration bugs in IE < 9
        for (var key in obj) {
            if (hasOwnProperty.call(obj, key)) return false;
        }
        return true;
    }
    
    // import the character.js file for the character object
    // check local storage for file. 
    // To do: Need to be able to handle browsers that do not have Local Storage enabled
    
    // define variable for local storage data
    let pcLocalStorage = ""
    let canUseLocalStorage = false
    
    // Check browser support
    if (typeof(Storage) !== "undefined") {
      canUseLocalStorage = true


      setupLocalStorage("theGrailQuest_ryu2012_character", "character")
      setupLocalStorage("theGrailQuest_ryu2012_retainer", "retainer")
      setupLocalStorage("theGrailQuest_ryu2012_sideQuests", "sideQuests")

      //setupLocalStorage("theGrailQuest_ryu2012_equipment", "equipment")
      //setupLocalStorage("", "log")


    } else {
      //alert("This browser does not support Local Storage")
      console.log("This browser does not support Local Storage")
      
    }

    function setupLocalStorage(varName, objType) {
      // check to see if the variable exists
      if (localStorage.getItem(varName)) {
        //alert("local storage item exists")
        // next check to see if the variable is null
        pcLocalStorage = JSON.parse(localStorage.getItem(varName))
        if (isEmpty(pcLocalStorage)) {
          //alert("local storage variable is empty.  Creating a new obj")
          console.log(`local storage for ${varName} variable is empty.  Creating a new obj`)
          // create a new local storage object using the default character
          if (objType == "character") {
            localStorage.setItem(varName, JSON.stringify(defaultPlayerCharacter))
          }
          if (objType == "retainer") {
            localStorage.setItem(varName, JSON.stringify(retainers))
          }
          if (objType == "sideQuests") {
            localStorage.setItem(varName, JSON.stringify(sideQuests))
          }
          if (objType == "equipment") {
            localStorage.setItem(varName, equipment)
          }
        } else {
          // The local storage variable exists and is not null
          // Next, set it to the playerCharacter object
          // To do: we need to test the format of the object before setting it.
          
          //alert("local storage variable exists and is not null.  Set the obj")
          console.log(`Local storage variable for ${varName} exists and is not null.  Set the object.`)

          if (objType == "character") {
            let objString = JSON.stringify(pcLocalStorage)
            //console.log("obj: " + objString)
            playerCharacter = pcLocalStorage
            //console.log("playerCharacter object is: " + objString)
          }

          if (objType == "retainer") {
            let objString = JSON.stringify(pcLocalStorage)
            //console.log("obj: " + objString)
            retainers = pcLocalStorage
            //console.log("playerCharacter object is: " + objString)
          }

          if (objType == "sideQuests") {
            let objString = JSON.stringify(pcLocalStorage)
            //console.log("obj: " + objString)
            sideQuests = pcLocalStorage
            //console.log("sideQuests array is: " + objString)
          }

        }
      } else {
        // playerCharacterStats local variable is null - does not exist
        // alert("local storage variable does not exist so set the default")
        console.log(`The local storage variable for ${varName} does not exist so set the default`)
        if (objType == "character") {
          // Create a new local storage variable using the default PC
          localStorage.setItem(varName, JSON.stringify(defaultPlayerCharacter))
        }

        if (objType == "retainer") {
          // Create a new local storage variable

          localStorage.setItem(varName, JSON.stringify(retainers))
        }

        if (objType == "sideQuests") {
          // Create a new local storage variable

          localStorage.setItem(varName, JSON.stringify(sideQuests))
        }

      }
    }

    
    // Go here for more examples: https://www.w3schools.com/jsref/obj_storage.asp
    
    
  // this will close the menu on click outside the menu
  
  $(document).mouseup(function(e) 
  {
      var container = $("#collapseExample");
      // if the target of the click isn't the container nor a descendant of the container
      if (!container.is(e.target) && container.has(e.target).length === 0) 
      {
          container.collapse('hide');
      }
  });  
    
    
    
    
let retainers2 = [
    {
      id: 0,
      name: "Fred",
      level: 1,
      profession: "Soldier",
      employed: true,
      cur_hp: 20,
      max_hp: 20,
      weapon: "Longsword",
      armor: "Padded",
      armorType: "light",
      attack: 6,
      damage_bonus: 2,
      armor_bonus: 1,
      morale: 1,
      cost: 5,
      alive: true,
      outOfAction: false
    },
    {
      id: 1,
      name: "Oliver",
      level: 1,
      profession: "Rogue",
      employed: true,
      cur_hp: 15,
      max_hp: 15,
      weapon: "Shortsword",
      armor: "Leather Jerkin",
      armorType: "light",
      attack: 6,
      damage_bonus: 2,
      armor_bonus: 1,
      morale: -1,
      cost: 5,
      alive: true,
      outOfAction: false
    },
    {
      id: 2,
      name: "Trogdor",
      level: 1,
      profession: "Woodsman",
      employed: true,
      cur_hp: 20,
      max_hp: 20,
      weapon: "Longbow and Shortsword",
      armor: "Leather Jerkin",
      armorType: "light",
      attack: 6,
      damage_bonus: 2,
      armor_bonus: 1,
      morale: 0,
      cost: 5,
      alive: true,
      outOfAction: false
    }
  ]
    
    
    let availableRetainers = []
    
    
  // -------------------------------------
  // Retainer Names
  
let retainerNameFirst_A = [
      "Bard",
      "Cadm",
      "Guel",
      "Har",
      "Mael",
      "Rayg"
    ]
    
    let retainerNameSecond_A = [
      "an",
      "ar",
      "oc"
    ]
    
    let retainerNameFirst_B = [
      "Adal",
      "Childe",
      "Ed",
      "Leof",
      "Theud",
      "Wulf"
    ]
    let retainerNameSecond_B = [
      "berg",
      "mund",
      "ric"
    ]
    
    let retainerNameFirst_C = [
      "Berw",
      "Cadw",
      "Gwrh",
      "Llyw",
      "Ow",
      "Tyw"
    ]
    let retainerNameSecond_C = [
      "en",
      "yr",
      "yn"
    ]
    
    let retainerNameFirst_D = [
      "Aligr",
      "Bedin",
      "Dion",
      "Gaheri",
      "Guivr",
      "Mordr"
    ]
    let retainerNameSecond_D = [
      "auz",
      "es",
      "et"
    ]
  
  // -------------------------------------
    
    let adventureLog = []
    
    
    let merchant = 0
    let woodsman = 0
    let soldier = 0
    let rogue = 0
    
    // get some totals for retainers
    
    $.each(retainers, function(key, value) {
      let retainer_name = value.name
      let retainer_profession = value.profession
      if (retainer_profession == "Soldier") soldier++
      if (retainer_profession == "Rogue") rogue++
      if (retainer_profession == "Woodsman") woodsman++
      if (retainer_profession == "Merchant") merchant++
      
    })
    
    let manageRetainersComplete = false
    
    
    
    //alert("Num Retainers: " + retainers.length)
    console.log("Num Retainers: " + retainers.length)
    
    
    // -----------------------------------------------------
    // On Load set the top div
    // -----------------------------------------------------
    
    updateNavbar()
    
    function updateNavbar() {
      // attack bonus 
      // rebellion level 1 = +1
      // rebellion level 2-3 = +2
      // rebellion level 4 = +3
    
      let rebellionLevel = playerCharacter.rebellionLevel
      let rebellionLevelMod = 0
      let hpMod = 0
      switch(rebellionLevel) {
        case 0: 
          playerCharacter.rebellionLevelMod = 0
        break;
        case 1: 
          playerCharacter.rebellionLevelMod = 1
        break;
        case 2:
        case 3:
          playerCharacter.rebellionLevelMod = 2
        break;
        default: 
          playerCharacter.rebellionLevelMod = 3
        break;
      }
    
      $("#topDivCharName").html(`<strong>${playerCharacter.name}</strong>`)
      $("#topDivCurHP").html(playerCharacter.cur_hp)
      $("#topDivMaxHP").html(playerCharacter.max_hp)
      $("#topDivLevel").html(playerCharacter.level)
      $("#topDivPiety").html(playerCharacter.piety)
      $("#topDivPotions").html(playerCharacter.healingPotions)
      $("#topDivMoney").html(playerCharacter.money)
      $("#topDivRumors").html(playerCharacter.rumors)
      $("#topDivRebellionLevel").html(playerCharacter.rebellionLevel)
      $("#topDivTurnCounter").html(playerCharacter.turn)
      // set color for HP
      // first unset all colors
      $("#topDivCurHP").removeClass(["bg-success", "bg-warning", "bg-danger", "bg-secondary"]);
      let a = Math.floor(playerCharacter.max_hp / 3);
      let firstThird = (playerCharacter.max_hp - a)
      let secondThird = (playerCharacter.max_hp - (a * 2))
      //console.log("a: " + a)
      //console.log("firstThird: " + firstThird)
      //console.log("secondThird: " + secondThird)
      if (playerCharacter.cur_hp >= firstThird) {
        $("#topDivCurHP").addClass("bg-success")
      } else if (playerCharacter.cur_hp < firstThird && playerCharacter.cur_hp >= secondThird) {
        $("#topDivCurHP").addClass("bg-warning")
      } else if (playerCharacter.cur_hp > 0 && playerCharacter.cur_hp < secondThird) {
        $("#topDivCurHP").addClass("bg-danger")
      } else {
        $("#topDivCurHP").addClass("bg-secondary")
      }
      
      if (canUseLocalStorage) {
        localStorage.setItem('theGrailQuest_ryu2012_character', JSON.stringify(playerCharacter))
        localStorage.setItem('theGrailQuest_ryu2012_retainer', JSON.stringify(retainers))
        localStorage.setItem('theGrailQuest_ryu2012_sideQuests', JSON.stringify(sideQuests))
      }
      

      // update totals of retainers
      merchant = 0
      woodsman = 0
      soldier = 0
      rogue = 0
    
      // get some totals for retainers
    
      $.each(retainers, function(key, value) {
        let retainer_name = value.name
        let retainer_profession = value.profession
        if (retainer_profession == "Soldier") soldier++
        if (retainer_profession == "Rogue") rogue++
        if (retainer_profession == "Woodsman") woodsman++
        if (retainer_profession == "Merchant") merchant++
      
      })



      // color code the rebellion level
      $("#topDivRebellionLevel").removeClass(["bg-success", "bg-info", "bgOrange", "bg-warning", "bg-danger", "bg-secondary", "bg-dark"]);
      switch(playerCharacter.rebellionLevel) {
        case 0: 
          $("#topDivRebellionLevel").addClass("bg-success")
        break;
        case 1:
          $("#topDivRebellionLevel").addClass("bg-info")
        break;
        case 2:
          $("#topDivRebellionLevel").addClass("bg-warning")
        break;
        case 3:
          $("#topDivRebellionLevel").addClass("bgOrange")
        break;
        case 4:
          $("#topDivRebellionLevel").addClass("bg-danger")
        break;
        case 5:
          $("#topDivRebellionLevel").addClass("bg-dark")
        break;
        default:
          $("#topDivRebellionLevel").addClass("bg-dark")
        break;
      }
      if (playerCharacter.rebellionLevel > 4) {
        $("#gameTableText").html("The realm descends into complete chaos as the rebels continue to wreck havoc on all that is good and holy. Rumors abound saying that the king is dead.  All is lost.  But wait.... is there another?<br>")
        $("#gameTableText").append("<br>If you feel up to the task, you may try again by starting over.")
        let rowString = `
          <div class="d-flex mt-2 justify-content-around">
            <button onclick="startNewGame()" data-id="startGameBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Start Over
          </button>`
        $("#gameButtons").html(rowString)
      }
    }
    
      
    // -----------------------------------------------------
    // Set the Character Stats Modal
    // -----------------------------------------------------
    
    function setCharacterModal() {
      $("#modalTitle").html("Character Stats")
      let characterStats = `
        <div>
          <h1>${playerCharacter.name}</h1>
          <hr>
          <span>Hit Points: ${playerCharacter.cur_hp} / ${playerCharacter.max_hp}</span><br>
          <span>Attack: ${playerCharacter.attack}+</span><br>
          <span>Damage Modifier: ${playerCharacter.dmg_mod}</span><br>
          <span>Armor Modifier: ${playerCharacter.armor}</span><br>
          <hr>
          <span>Captains Slain: ${playerCharacter.captainsSlain}</span><br>
          <span>Side Quests Completed: ${playerCharacter.sideQuests}</span><br>
          <hr>
          <h3>Equipment</h3>
          <span>Longsword</span><br>
          <span>Chainmail</span><br>
          <span>Shield</span><br>
        </div>
      `
      $("#characterStatsModal").html(characterStats)
    }
    // -----------------------------------------------------
    // Journey Table
    // -----------------------------------------------------
        // Tables
    let journeyTable = [
      "You have found an inn at a Crossroads. You may choose to stay at the inn (for 10 silver or the church if you don't have enough money) or face the danger that awaits. Choose wisely.",
      "finds an inn.  You may choose to stay at the inn (for 10 silver or church if you don't have enough money) or or bypass it by clicking on the Journey On button.",
      "You are lost! If you have a Merchant retainer, he knows of a shortcut, treat as a result of 1 on this table instead. If you don not have a merchant, roll on this table again with a +1.",
      "Roll on the Encounter Table (3).",
      "If the Rebellion Level is 4, roll on the Challenge Table (7). Otherwise, roll on the Encounter Table (3).",
      "If the Rebellion Level is 4, roll on the Challenge Table (7). Otherwise, roll on the Traitors Attack Table (4)."
    ]
    let innTable = [
      "Your paladin is turned away, roll on the Journey Table (1) again.",
      "Roll 2d6. If the result is 7 or less one of your retainers (if any) is killed in an ambush by ruffians. (randomly choose which one) Deduct -1 from the Rumor Roll. No new retainers are available.",
      "Roll 2d6. If the result is 5 or less, if you have coins, 3d6gp is stolen by a pickpocket. Deduct -1 from the Find Retainer roll.",
      "Greedy traders, all items cost double, and you sell treasures at half their value. Ignore this if you have a merchant retainer.",
      "Talkative innkeeper. Add +1 to the Rumor Roll.",
      "Add +1 to the Find Retainer roll if the roll is 5 or less.",
      "You get free food and lodging. Add +1 to the Find Retainer roll if the roll is 5 or less. New retainers are hired for 5gp.",
      "A wealthy noble donates 3d6 x 5gp to your worthy cause."
    ]
    
    let traitorsTable = [
      "hears that a questing paladin has been killed by the traitors in a distant location. <br><span class='rounded' style='padding: 2px; background-color: red'>The Rebellion Level has increased!</span>",
      "finds a questing paladin, mortally wounded by the traitors. Before he dies, he gives you some information. <br><br>You have gained one rumor! However... <br><span class='rounded' style='padding: 2px; background-color: red'>The Rebellion Level has increased!</span>",
      "finds signs of a brave fight, but no dead questing paladin. This was a lucky escape, the traitors did not get their kill."
    ]
    
    
    // -----------------------------------------------------
    // Journey Table / Start Game
    // -----------------------------------------------------
    
    $(document).ready(function () {
      if (playerCharacter.turn > 0) {
        continueJourney()
      } else {
        startNewGame()
      }
    })
      
    let lastJourneyRoll = 0
    let journeyRoll = 0
    let sameAsLastRoll = false
    
    // Start New Game: Create character then roll on the Journey Table
    function startNewGame() {
      rebellionLevelIncreased = false
      retainers = []

      sideQuests = 
      [
        "Taulurd the Giant",
        "A Dragon",
        "The Green Knight",
        "The Questing Beast",
        "Three Blind Old Hags",
        "Laamorz the Wizard"
      ]

      $('#npcCollapse').toggle(false)
      $("#gameTableTitle").empty()
      $("#gameTableTitle").html("Start New Game")
      $("#gameButtons").empty()
      $("#gameTableText").html("Click below to start a new journey!")
      
      playerCharacter.name = "Sir Percival"
      playerCharacter.level = 3
      playerCharacter.max_hp = 40
      playerCharacter.cur_hp = 40
      playerCharacter.armor = 3
      playerCharacter.attack = 6
      playerCharacter.att_mod = 0
      playerCharacter.dmg_mod = 2
      playerCharacter.exp = 0
      playerCharacter.money = 40
      playerCharacter.species = "human"
      playerCharacter.sex = "male"
      playerCharacter.healingPotions = 3
      playerCharacter.status = "alive"
      playerCharacter.rumors = 0
      playerCharacter.rumorModifier = 0
      playerCharacter.rebellionLevel = 0
      playerCharacter.rebellionLevelMod = 0
      playerCharacter.turn = 0
      playerCharacter.piety = 0
      playerCharacter.sideQuests = 0
      playerCharacter.findRetainerModifier = 0
      playerCharacter.wasLost = false
      playerCharacter.captainsSlain = 0
      playerCharacter.onPilgrimage = false
      playerCharacter.pilgrimageModifier = 0
      playerCharacter.dishonor = false
      updateNavbar()
      
      let runJourneyButton = `
          <div class="mt-2">
          <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
        `
      $("#gameButtons").html(runJourneyButton)
    }
    
    function continueJourney() {
      $("#gameTableTitle").html("Journey on... ")
      $("#gameTableText").html("Click below to continue your journey!")
      let runJourneyButton = `
          <div class="mt-2">
          <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
        `
      $("#gameButtons").html(runJourneyButton)
    }
    
    function rollJourneyTable() {
      $('#npcCollapse').toggle(false)
      $("#gameTableTitle").empty()
      $("#gameTableTitle").html("Journey on... ")
      $("#gameTableText").empty()
      //$("#gameTableText").html(`${playerCharacter.name} sets off on a journey and ...`)
      console.log("roll on the journey table")
      playerCharacter.turn++
      updateNavbar()
      
      journeyRoll = rollDie(6)
      
      console.log("Journey roll: " + journeyRoll)
      console.log("previous journey roll: "+ lastJourneyRoll)
      
      if (journeyRoll == lastJourneyRoll) {
        //$("#gameTableText").append("...again")
        sameAsLastRoll = true
      } else {
        sameAsLastRoll = false
      }
      
      lastJourneyRoll = journeyRoll
      
      if (playerCharacter.wasLost) {
        journeyRoll++
        playerCharacter.wasLost = false
        updateNavbar()
      }
      
      console.log("Journey Roll (after mods): " + journeyRoll)
      //journeyRoll = 4
      //alert("The begin adventure button was clicked. You rolled: " + d6Roll);
      // Save turn data in the log (we'll push this to MySql at some point)
      adventureLog.push({ 'turn': playerCharacter.turn, 'roll': journeyRoll, 'result': journeyTable[journeyRoll - 1] });
      //logTurn()
      
      $("#gameButtons").empty()
      
      switch (journeyRoll) {
        // crossroads
        case 1:
          $("#gameTableTitle").append(" - Crossroads")
          crossroads()
          break;
        // Inn table or roll again
        case 2:
          $("#gameTableTitle").append(" - Journey on or Stay at Inn")
          journeyOrInn()
          break;
        // lost
        case 3:
          $("#gameTableTitle").append(" - Lost!")
          youAreLost()
          break;
        // Encounter
        case 4:
          $("#gameTableTitle").append(" - An Encounter!")
          rollEncounterTable()
          break;
        // Encounter or Challenge
        case 5:
          if (playerCharacter.rebellionLevel > 3) {
            $("#gameTableTitle").append(" - A Challenge!")
            rollChallengeTable()
          } else {
            $("#gameTableTitle").append(" - An Encounter!")
            rollEncounterTable()
          }
          break;
        // Traitors or Challenge
        case 6:
        case 7:
          if (playerCharacter.rebellionLevel > 3) {
            $("#gameTableTitle").append(" - A Challenge!")
            rollChallengeTable()
          } else {
            $("#gameTableTitle").append(" - Traitors!")
            rollTraitorsTable()
          }
          break;
      }
    };
    
// --- Crossroads ---
    
    function crossroads() {
      //$("#gameButtons").empty()
      $("#gameTableText").empty()
      $("#gameTableText").append(journeyTable[0])
      
      if (sameAsLastRoll) $("#gameTableText").append("...again")
      
      //$("#adventureLogTableBody").empty()
      // Inn or Encounter
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Inn
        </button>
        <button onclick="rollEncounterTable()" data-id="encounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go To Encounter!
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)
    }
    
// --- Journey or Inn Choice---
    
    function journeyOrInn() {
      $("#gameTableText").append(`${playerCharacter.name} ` + journeyTable[1])
      
      if (sameAsLastRoll) $("#gameTableText").append("...again")
      
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey Onward!
        </button>
        <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Inn
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)  
    }
    
// --- Roll on the Inn Table ---    
    
    function rollInnTable() {
      // Successfully completed side quests will modify this roll.
      // 1 quest = +1
      // 2-3 quests = +2
      // 4 or more = +3
      
      let modifier = 0
      switch (playerCharacter.sideQuests) {
        case 0:
          modifier = 0
        break;
        case 1:
          modifier = 1
        break;
        case 2:
        case 3:
          modifier = 2
        break
        default:
          modifier = 3
      }
      
      $("#gameTableTitle").html("Inn Table")
      
      let rowString = ""
      let num = 0
      // clear the story div
      $("#gameTableText").empty()
      playerCharacter.findRetainerModifier = 0
      updateNavbar()
      
      console.log("roll on the inn table")
      adventureLog.push({ 'turn': playerCharacter.turn, 'roll': 'Player Choice', 'result': 'Stay at the Inn' });
      let roll_1d6 = rollDie(6) + modifier;
      console.log("roll + modifier: " + roll_1d6)
      //roll_1d6 = 1
      
      //$("#gameTableText").append(innTable[roll_1d6 - 1])
      
      switch (roll_1d6) {
        case 1:
          console.log("[1] Your paladin is turned away!  Journey on...")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': innTable[0] });
          $("#gameTableText").append("<p>Your paladin is turned away.</p>")
        break;
        case 2:
          console.log("[2] Grumpy Patrons")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Grumpy patrons' });
          playerCharacter.rumorModifier = -1
          updateNavbar()
          rowString = "<p>Grumpy patrons (rumor modifier -1)</p>"
          
          if (retainers > 0) {
            let first_d6Roll = Math.floor(Math.random() * 6) + 1;
            let second_d6Roll = Math.floor(Math.random() * 6) + 1;
            let twoD6 = first_d6Roll + second_d6Roll
            if (twoD6 < 8) {
              // random retainer has been killed
              rowString += "<br>If that wasn't bad enough, one of your retainers has been killed in an ambush!"
              adventureLog.push({ 'turn': playerCharacter.turn, 'roll': twoD6, 'result': 'One of your retainers has been killed!' });
            }
          }
          $("#gameTableText").append(rowString)
        break;
        case 3:
          console.log("[3] Shady Characters")
          $("#gameTableText").append("<p>Shady characters abound, making it hard to find good help. (-1 to the retainer roll)</p>")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Shady Characters.' });
          let first_d6Roll = Math.floor(Math.random() * 6) + 1;
          let second_d6Roll = Math.floor(Math.random() * 6) + 1;
          let twoD6 = first_d6Roll + second_d6Roll
          if (twoD6 < 6) {
            let first_d6Roll = Math.floor(Math.random() * 6) + 1;
            let second_d6Roll = Math.floor(Math.random() * 6) + 1;
            let third_d6Roll = Math.floor(Math.random() * 6) + 1;
            let threeD6 = first_d6Roll + second_d6Roll + third_d6Roll
            rowString = "Robbed!"
            rowString += "<br>You lose " + threeD6 + " silver pieces.<br>"
            adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'You have been robbed!' });
            playerCharacter.money -= threeD6
            if (playerCharacter.money < 0) {
              playerCharacter.money = 0
            }
            updateNavbar()
            $("#gameTableText").append(rowString)
          }
        break;
        case 4:
          console.log("[4] Greedy Traders")
          
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Greedy traders.' });
          if (merchant < 1) {
            // items cost double. items sold for half
            console.log("Greedy traders. Items cost double and are sold for half!")
            $("#gameTableText").append("<p>Greedy Traders, everything costs double and everything you sell is at half the normal value!</p>")
          } else {
            $("#gameTableText").append("<p>Greedy Traders but your merchant is able to counter them!</p>")
          }
        break;
        case 5:
          $("#gameTableText").append("<p>Talkative innkeeper.  (+1 to the Rumor Roll)</p>")
          console.log("[5] Talkative innkeeper")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Talkative innkeeper.' });
          playerCharacter.rumorModifier = 1
          updateNavbar()
          break;
        case 6:
          num = rollDie(6)
          if (num < 6) {
            console.log("[6] Abundant Retainers looking for work")
            $("#gameTableText").append("<p>Abundant Retainers looking for work.  (+1 to the Find Retainer Roll)</p>")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Add +1 to the Find Retainer roll.' });
            playerCharacter.findRetainerModifier++
            updateNavbar()
          } else {
            $("#gameTableText").append("<p>Nothing special happens this time.</p>")
          }
        break;
        case 7:
          num = rollDie(6)
          if (num < 6) {
            console.log("[6] Free Food & Abundant Retainers looking for work!")
            $("#gameTableText").append("<p>Abundant Retainers looking for work.  (+1 to the Find Retainer Roll)</p>")
            adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Add +1 to the Find Retainer roll.' });
            playerCharacter.findRetainerModifier++
            updateNavbar()
          }
          $("#gameTableText").append("<br>Free food and lodging!<br>")
          console.log("[7] Free food and lodging!")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Free food and lodging!' });
        break;
        case 8:
          console.log("[8] Wealthy patron donates to your cause!")
          adventureLog.push({ 'turn': playerCharacter.turn, 'roll': roll_1d6, 'result': 'Wealthy nobel donates money to your cause!' });
          let money = 0
          for (let i=0; i<3; i++) {
            money += rollDie(6)
          }
          money = (5 * money)
          console.log("You gain: " + money + " silver pieces")
          $("#gameTableText").append(`<p>A wealthy patron donates to your cause! You gain ${money} silver pieces! </p>`)
          playerCharacter.money += money
          updateNavbar()
        break;
      }
      //logTurn()
      if (roll_1d6 > 1) {
        stayAtInn()
      } else {
        rowString = `
          <div class="d-flex mt-2">
            <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Journey On
            </button>
          </div>`
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      }
      
      
    }
    
// --------------------    
// Stay at Inn    
  function stayAtInn() {
    let rowString = ""
    availableRetainers = []
    if (playerCharacter.money < 10) {
      // charity
      $("#gameTableText").append(`<p>Since you don't have enough money, the local church, having heard of your daring exploits, puts you up for the night for free. </p>`)
      healUp()
      // Re-employ all retainers.
      // Since they default to hired, then there is nothing to do here.
      rowString = `
      <div class="d-flex mt-2">
        <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Journey On
    	</button>
      </div>`
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)
    } else {
      playerCharacter.money -= 10
      updateNavbar()
      $("#gameTableText").append(`<p>You pay the innkeeper 10 silver pieces for food and lodging for the night. </p>`)
      healUp()
      rollForRumors()
      // retain/fire retainers
      //let numRetainers = retainers.length
      let newRetainers = numAvailableRetainers()
      
      if (newRetainers > 0 ) {
        $("#gameTableText").append(`<p>New possible retainers are available.</p>`)
        // roll em up now, not on click.
        // then add them to the new retainers object
        
        for (let i=0; i<newRetainers; i++) {
          createRetainer(i)
        }
      }
        rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
          Journey Onward!
        </button>
        <button onclick="manageRetainersModal()" data-id="manageRetainersBtn" type="button" data-toggle="modal" href="#myModal" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
          Manage Retainers
        </button>
        <button onclick="generalStore()" data-id="generalStoreBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
          General Store
        </button>
        </div>
        `
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      }    
    updateNavbar()
  }
    
  function healUp() {
    // heal if cur_hp < max_hp
    if (playerCharacter.cur_hp < playerCharacter.max_hp) {
      let num1 = rollDie(6)
      let num2 = rollDie(6)
      let num3 = num1 + num2
      //$("#gameTableText").append(`<p>Healing Roll: ${num1} + ${num2} = ${num3}</p>`)
      if ((num3 + playerCharacter.cur_hp) >= playerCharacter.max_hp) {
        playerCharacter.cur_hp = playerCharacter.max_hp
        $("#gameTableText").append("<p>After a good night's sleep, ALL of your wounds have healed!</p>")
      } else {
        playerCharacter.cur_hp = num3 + playerCharacter.cur_hp
        $("#gameTableText").append("<p>After a good night's sleep, some of your wounds (" + num3 +") have healed.</p>")
      }
      //$("#gameTableText").append(`<p>Current Health: ${playerCharacter.cur_hp}</p>`)
      updateNavbar()
    }
  }
  function useHealingPotion() {
    if (playerCharacter.healingPotions < 1) {
      alert("Sorry, you don't have any healing potions.")
      return
    }
    if (playerCharacter.cur_hp < playerCharacter.max_hp) {
      let num1 = rollDie(6)
      let num2 = rollDie(6)
      let num3 = num1 + num2
      let drinkPotion = false
      let txt = ""
      drinkPotion = confirm("Drink healing potion?")
      if (drinkPotion) {
        playerCharacter.healingPotions--
        if ((num3 + playerCharacter.cur_hp) >= playerCharacter.max_hp) {
          playerCharacter.cur_hp = playerCharacter.max_hp
          alert("You are fully healed!")
        } else {
          playerCharacter.cur_hp = num3 + playerCharacter.cur_hp
          alert("You heal " + num3 + " wounds.")
        }
        updateNavbar()
      }
    }
  }
    
  function rollForRumors() {
    let randomNum = rollDie(6) 
    let rumorMod = playerCharacter.rumorModifier
    let rogueMod = 0
    
    let haveRogue = false
    $.each(retainers, function(key, value) {
        let retainer_profession = value.profession
        if (retainer_profession == "Rogue") haveRogue = true
    })
    if (haveRogue) {
      rogueMod = 2
    }
    let total = randomNum + rumorMod + rogueMod
    if (haveRogue) {
      $("#gameTableText").append(`<p>Rumor Roll: ${randomNum} + modifier: ${rumorMod} + rogue: ${rogueMod} = ${total}</p>`)
    } else {
      $("#gameTableText").append(`<p>Rumor Roll: ${randomNum} + modifier: ${rumorMod} = ${total}</p>`)
    }
    if (total > 3) {
      playerCharacter.rumors++
      updateNavbar()
      $("#gameTableText").append("You gain 1 rumor!")
    } else {
      $("#gameTableText").append("Sorry pal, no new rumors for you.")
    }
  }
    
    
    function generalStore() {
      $("#gameTableText").append("<p>The store is currently closed.</p>")
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
    }
    function numAvailableRetainers () {
      let num1 = rollDie(6)
      //alert("You rolled a: " + num1)
      let numRetainers = retainers.length
      let total = num1 - numRetainers
      //alert("Total: " + total)
      return total
    }
    
    function createRetainer (i) {
      let newId = retainers.length +1
      availableRetainers = []
      // get name
      retainerName = createName(i)
      // get profession
      retainerProfession = getRetainerProfession(i)
      let newObj = {
        id: newId,
        name: retainerName,
        level: 1,
        profession: retainerProfession,
        employed: false,
        cur_hp: 20,
        max_hp: 20,
        weapon: "Sword",
        armor: "Padded",
        attack: 6,
        damage_bonus: 2,
        armor_bonus: 1,
        morale: 1,
        cost: 10,
        alive: true
      }
      // push to availableRetainers[]
      availableRetainers.push(newObj)
    }
    
  function createName(i) {
    let firstPart = ""
    let secondPart = ""
    let retainerName = ""
    let firstRoll = 0
    let secondRoll = 0
    
    firstRoll = rollDie(6)
    switch(firstRoll) {
      case 1:
      case 2:
        secondRoll = rollDie(retainerNameFirst_A.length)
        firstPart = retainerNameFirst_A[secondRoll -1]
        console.log("First Part is: " + firstPart)
        thirdRoll = rollDie(retainerNameSecond_A.length)
        secondPart = retainerNameSecond_A[thirdRoll -1]
        console.log("Second Part is: " + secondPart)
        retainerName = firstPart + secondPart
        console.log("Retainer Name is: " + retainerName)
      break;
      case 3:
      case 4:
        secondRoll = rollDie(retainerNameFirst_B.length)
        firstPart = retainerNameFirst_B[secondRoll -1]
        console.log("First Part is: " + firstPart)
        thirdRoll = rollDie(retainerNameSecond_B.length)
        secondPart = retainerNameSecond_B[thirdRoll -1]
        console.log("Second Part is: " + secondPart)
        retainerName = firstPart + secondPart
        console.log("Retainer Name is: " + retainerName)
      break;
      case 5:
        secondRoll = rollDie(retainerNameFirst_C.length)
        firstPart = retainerNameFirst_C[secondRoll -1]
        console.log("First Part is: " + firstPart)
        thirdRoll = rollDie(retainerNameSecond_C.length)
        secondPart = retainerNameSecond_C[thirdRoll -1]
        console.log("Second Part is: " + secondPart)
        retainerName = firstPart + secondPart
        console.log("Retainer Name is: " + retainerName)
      break;
      case 6:
        secondRoll = rollDie(retainerNameFirst_D.length)
        firstPart = retainerNameFirst_D[secondRoll -1]
        console.log("First Part is: " + firstPart)
        thirdRoll = rollDie(retainerNameSecond_D.length)
        secondPart = retainerNameSecond_D[thirdRoll -1]
        console.log("Second Part is: " + secondPart)
        retainerName = firstPart + secondPart
        console.log("Retainer Name is: " + retainerName)
      break;
    }
    //alert("Retainer ["+ i + "] is " + retainerName)
    return retainerName
  }
  
  
  function getRetainerProfession() {
    let num1 = rollDie(6)
    switch(num1) {
      case 1:
      case 2:
      case 3:
        return "Soldier"
      break;
      case 4:
        return "Woodsman"
      break;
      case 5:
        return "Merchant"
      break;
      case 6:
        return "Rogue"
      break;
    }
  }
    
   
   
 
   
   
   
    
    
// Stay At Inn
// --------------------
    
// --- You are lost ---
    function youAreLost() {
      $("#gameTableText").append(`<p>${playerCharacter.name} becomes lost!</p>`)
      if (playerCharacter.wasLost) $("#gameTableText").append("...again")
      console.log(journeyTable[2])
      let rowString = ""
      if (merchant == 0) {
        // roll again but with +1 to the roll
        // set wasLost to true which tells the journey table to add +1 to the journey roll
        $("#gameTableText").append("<br>Click 'Journey On' to continue to seek the Grail.")
        playerCharacter.wasLost = true
        updateNavbar()
        rowString += `
        <div class="d-flex mt-2">
        <button onclick="rollJourneyTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
        </button>
        </div>`
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      } else {
        // go to the crossroads
        $("#gameTableText").append("But luckily your Merchant retainer knew a way to get you to an inn.")
        
        rowString += `
        <div class="d-flex mt-2">
        <button onclick="crossroads()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Crossroads
        </button>
        </div>`
        $("#gameButtons").empty()
        $("#gameButtons").html(rowString)
      }
    }
    
    
    
    // -----------------------------------------------------
    // Encounter Table
    // -----------------------------------------------------
    
    function rollDie (dieType) {
  	  let result = Math.floor(Math.random() * dieType + 1);
      return result
    }
    
    const encounterTable = {
      2: "Morgana",
      3: "Castle Perilous",
      4: "Village of Plague and Death",
      5: "Grail Castle",
      6: "Minions",
      7: "Undertake a Challenge!",
      8: "Minions",
      9: "A Heroic Quest",
      10: "Village of Poverty and Famine",
      11: "Test of Piety",
      12: "Merlin"
    }
    
    
    let castlePerilousTable = [
      "The White Knight. In a room you see a white shield with red cross, the Shield of Evalach. It is guarded by a white knight, level 7 with 8 life points. No quarter is asked or given. If you defeat the white knight, you may take the shield and get one XP roll. If you already have the shield, roll on this table again.",
      "Penance. You fall asleep. If you committed an act of Dishonor during the game, you wake up outside an abandoned church. Any armor, shield and weapon you had are stolen (except magical ones), and you are left with only a dagger (light slashing weapon). Treasures, coins and retainers remain with you. Otherwise, you heal 1 life point for a good night's sleep.",
      "The Wanderer. You meet an immortal, over 1,000 years old. If you are currently under Dishonor, it is removed. He takes you to a crossroads, treat as if a 1 was rolled on the Inn Table (2)",
      "The Black Knight or the Red Knight? Opening a door you see two scenes. First: A questing paladin is about to be killed by a black knight . Second: A maiden is about to be attacked by a red knight . Choose who to save. If you save the maiden, roll for a piety point, but the Rebellion Level increases by 1 as the questing paladin dies. If you save the questing paladin, do not increase the Rebellion Level. You only fight one of the knights; they are both level 7 with 8 life points. You get an XP roll if you win. No quarter is asked or given. There is no treasure. ",
      "The Hermit. You meet an old hermit who can sell you up to 3 rumors for 50gp each (or at least that value in treasure).",
      "The Dwarf. At the castle gate, a dwarf with a cart offers you a lift. If you pay him 50 gold pieces (or at least that value in treasure), you, along with retainers, can be taken to any quest of your choice from the Side Quest Table (9). You can also ride for free, roll a d6; on a 1-3 go to event 7, and on a 4-6 go to event 9 on the Encounter Table (3)."
    ]  
    
    //let numRumors = 3
    //let pietyPoints = 1
    let altEncounter = false
    let theEncounter = "THE UNDERWORLD"
    
    //startEncounter()
    
    function startEncounter() {
      $("#gameTableTitle").html("Encounter Table")
      $("#gameButtons").empty()
      $("#gameTableText").html("Click below to generate an encounter.")
      
      let createEncounterButton = `
          <div class="mt-2">
          <button onclick="rollEncounterTable()" data-id="createEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Create Encounter
          </button>
        `
      $("#gameButtons").html(createEncounterButton)
    }
    
    
    // get encounter
    function rollEncounterTable() {
      $("#gameButtons").empty()
      $("#gameTableText").empty()
      
      let firstRoll = rollDie(6)
      let secondRoll = rollDie(6)
      let totalRoll = firstRoll + secondRoll
      
      totalRoll = 9
      
      altEncounter = false
      //alert("Roll: (" + firstRoll + " + " + secondRoll + ") = " + totalRoll)
      theEncounter = encounterTable[totalRoll]
      console.log("The encounter rolled: "+ theEncounter)
      //alert("You encounter: " + theEncounter)
      // create an encounter list in anticipation of the player spending rumor points to modify the results
      let encounterChoices = []
      // The table consists of two steps above and two steps below the result.
      // For example, if the player rolled a 7, then this object will consist of:
      // 5, 6, 8, 9
      // Note: cannot go lower than 2 or higher than 12
      if (totalRoll == 2) {
        encounterChoices.push(encounterTable[3])
        encounterChoices.push(encounterTable[4])
      }
      if (totalRoll == 3) {
        encounterChoices.push(encounterTable[2])
        encounterChoices.push(encounterTable[4])
        encounterChoices.push(encounterTable[5])
      }
      if (totalRoll == 4) {
        encounterChoices.push(encounterTable[2])
        encounterChoices.push(encounterTable[3])
        encounterChoices.push(encounterTable[5])
        encounterChoices.push(encounterTable[6])
      }
      if (totalRoll == 5) {
        encounterChoices.push(encounterTable[3])
        encounterChoices.push(encounterTable[4])
        encounterChoices.push(encounterTable[6])
        encounterChoices.push(encounterTable[7])
      }
      if (totalRoll == 6) {
        encounterChoices.push(encounterTable[4])
        encounterChoices.push(encounterTable[5])
        encounterChoices.push(encounterTable[7])
        encounterChoices.push(encounterTable[8])
      }
      if (totalRoll == 7) {
        encounterChoices.push(encounterTable[5])
        encounterChoices.push(encounterTable[6])
        encounterChoices.push(encounterTable[8])
        encounterChoices.push(encounterTable[9])
      }
      if (totalRoll == 8) {
        encounterChoices.push(encounterTable[6])
        encounterChoices.push(encounterTable[7])
        encounterChoices.push(encounterTable[9])
        encounterChoices.push(encounterTable[10])
      }
      if (totalRoll == 9) {
        encounterChoices.push(encounterTable[7])
        encounterChoices.push(encounterTable[8])
        encounterChoices.push(encounterTable[10])
        encounterChoices.push(encounterTable[11])
      }
      if (totalRoll == 10) {
        encounterChoices.push(encounterTable[8])
        encounterChoices.push(encounterTable[9])
        encounterChoices.push(encounterTable[11])
        encounterChoices.push(encounterTable[12])
      }
      if (totalRoll == 11) {
        encounterChoices.push(encounterTable[9])
        encounterChoices.push(encounterTable[10])
        encounterChoices.push(encounterTable[12])
      }
      if (totalRoll == 12) {
        encounterChoices.push(encounterTable[10])
        encounterChoices.push(encounterTable[11])
      }
      $("#gameTableText").empty()
      $("#gameTableTitle").html("An Encounter!")
      if (playerCharacter.rumors < 3) {
        $("#gameTableText").html(theEncounter)
        $("#gameButtons").empty()
        let gotoEncounterButton = `
          <div class="mt-2">
          <button onclick="gotoEncounter()" data-id="gotoEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go To Encounter
          </button>
        `
        $("#gameButtons").append(gotoEncounterButton)
      } else {
        //$("#gameTableInfo").parent().empty()
        //$("#gameTableText").html(theEncounter)
        $("#gameTableText").append("You have rolled a " + totalRoll + " (" + theEncounter + ") on the Encounter table.  Go to that encounter OR you may spend 3 rumors to select an encounter from the list below.")
        // show radio
        let formDiv = `
          <form id="altEncountersForm"></form>
        `
        $("#gameTableText").append(formDiv)
        $.each(encounterChoices, function( index, value ) {
          //alert( index + ": " + value );
          let myRadio = `
            <div class="mt-2 custom-control custom-radio">
              <input id="myRadio${index}" class="custom-control-input" type="radio" name="customRadio" disabled> 
              <label class="custom-control-label" for="myRadio${index}">${value}</label>
            </div>
      `
          $("#altEncountersForm").append(myRadio)
        });
        // Spend rumors Y/N  (button)
        
        let rumorButton = `
          <div class="mt-2">
          <button onclick="enableEncounters()" data-id="spendRumorsBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Click here to Spend 3 Rumors
          </button>
        `
        // Show radio options but make them all inactive
        $("#gameButtons").html(rumorButton)
        let gotoEncounterButton = `
          <div class="mt-2">
          <button onclick="gotoEncounter()" data-id="gotoEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go To Encounter
          </button>
        `
        $("#gameButtons").append(gotoEncounterButton)
      }
    }
    
    
    
    function enableEncounters () {
      playerCharacter.rumors = playerCharacter.rumors -3
      updateNavbar()
      $("#topDivRumors").html(playerCharacter.rumors)
      
      
      $("input[type=radio]").attr('disabled', false);
      // remove the rumor button (empty the div)and then add back the gotoEncounter button
      $("#gameButtons").empty()
      let gotoEncounterButton = `
        <div class="mt-2">
        <button onclick="gotoEncounter()" data-id="gotoEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Go To Encounter
        </button>
      `
      $("#gameButtons").append(gotoEncounterButton)
      $("#gameTableText").append("Select one of the following encounters.")
      altEncounter = true
    }
    
    function gotoEncounter() {
      // check to see if the user went for the alternative encounters
      console.log("Alternative Encounter selected? " + altEncounter)
      if (altEncounter) {
        //theEncounter = $("#altEncountersForm input[type='radio']:checked").val()
        //theEncounter = $("input[name='customRadio']:checked").val()
        
        $("input[type='radio']:checked").each(function() {
          var idVal = $(this).attr("id");
          //alert($("label[for='"+idVal+"']").text());
          theEncounter = ($("label[for='"+idVal+"']").text());
        });
      } 
      // 'theEncounter' is either the alt or the original
      // Now run the encounter
      //alert("The encounter is: " + theEncounter)
      
      $("#gameTableText").empty()
      
      switch (theEncounter) {
        case "Morgana": 
          $("#gameTableTitle").html("An Encounter with Morgana!")
          runMorgana()
        break;
        case "Castle Perilous":
          $("#gameTableTitle").html("An Encounter in Castle Perilous!")
          runCastlePerilous()
        break;
        case "Village of Plague and Death":
          $("#gameTableTitle").html("Village of Plague and Death!")
          runPlagueVillage()
        break;
        case "Grail Castle":
          $("#gameTableTitle").html("An Encounter in the Grail Castle!")
          runGrailCastle()
        break;
        case "Minions":
          $("#gameTableTitle").html("An Encounter with Minions!")
          runMinions()
        break;
        case "Undertake a Challenge!":
          $("#gameTableTitle").html("Undertake a Challenge!")
          runKnightChallengeQuest()
        break;
        case "A Heroic Quest":
          $("#gameTableTitle").html("A Heroic Quest!")
          runHeroicQuest()
        break;
        case "Village of Poverty and Famine":
          $("#gameTableTitle").html("Village of Poverty and Famine!")
          runPovertyVillage()
        break;
        case "Test of Piety":
          $("#gameTableTitle").html("A Test of Piety!")
          runTestOfPiety()
        break;
        case "Merlin":
          $("#gameTableTitle").html("An Encounter with Merlin!")
          runMerlin()
        break;
        
      }
    }
    
    function runMorgana() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      $("#gameTableText").html("Morgana uses trickery to make you forget.")
      
      //let pcRumors = playerCharacter.rumors
      let savesFailed = 0
      let outOfRumors = false
      let btnString = ""
      
      // make three saves
      for (i=1; i<4; i++) {
        let savingThrow = rollDie(6)
        if (savingThrow < 4) {
          playerCharacter.rumors--
          savesFailed++
          if (playerCharacter.rumors < 0) outOfRumors = true
        }
      }
      
      if (playerCharacter.rumors < 0) playerCharacter.rumors = 0
      updateNavbar()
      
      if (savesFailed == 0) {
        $("#gameTableText").append("<p>You have successfully resisted Morgana's spell!</p>")
        btnString = `
            <div class="mt-2">
            <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Continue your Journey
                </button>
            `
          $("#gameButtons").html(btnString)
      } else {
      
        if (savesFailed > 1 && outOfRumors) {
          $("#gameTableText").append(`<p>You failed ${savesFailed} saves and face a challenger!</p>`)
          btnString = `
            <div class="mt-2">
            <button onclick="rollChallengeTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Fight a Knight
                </button>
            `
          $("#gameButtons").html(btnString)
        }
        if (savesFailed == 1 && outOfRumors) {
          $("#gameTableText").append(`<p>You failed ${savesFailed} save and face a challenger!</p>`)
          btnString = `
            <div class="mt-2">
            <button onclick="rollChallengeTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Fight a Knight
                </button>
            `
          $("#gameButtons").html(btnString)
        }
        if (savesFailed == 1  && !outOfRumors) {
          $("#gameTableText").append("<p>She causes you to forget 1 rumor.  Consider yourself lucky!</p>")
          btnString = `
            <div class="mt-2">
            <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Continue your Journey
                </button>
            `
          $("#gameButtons").html(btnString)
        }
        if (savesFailed > 1  && !outOfRumors) {
          $("#gameTableText").append(`<p>She causes you to forget ${savesFailed} rumors.  Consider yourself lucky!</p>`)
          // click to go to the Journey table 
          btnString = `
            <div class="mt-2">
            <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Continue your Journey
                </button>
            `
          $("#gameButtons").html(btnString)
        }
      }
    }
    
    function runCastlePerilous() {
      let btnString = ""
      $("#gameButtons").empty()
      let roll = rollDie(6)
      let castlePerilousQuest = castlePerilousTable[roll -1]
      $("#gameTableText").append(castlePerilousQuest)
      
      switch(roll) {
        case 1: 
          btnString = `
            <div class="mt-2">
              <button onclick="theWhiteKnight()" data-id="gotoCombatBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Fight the Knight
            </button>
          
          `
          $("#gameButtons").html(btnString)
        break;
        case 2:
          if (playerCharacter.dishonor) {
            // robbed
            $("#gameTableText").html("You fall asleep.  When you awake, it's cold, rainy and you find yourself outside an old abandoned church.  Worse still, you've been robbed!")
            let daggerObj = {
              id: 4,
              name: "Dagger",
              type: "Weapon",
              ranged: false,
              readied: true,
              cost: 2,
              damage_bonus: 1
            }
            let myString = ""
            let newInventory = []
            for (let i=0; i<inventory.length; i++) {
              myString = inventory[i].type
              if (myString != "Armor" && myString != "Weapon") {
                newInventory.push(inventory[i])
              }
            }
            newInventory.push(daggerObj)
            inventory = newInventory
          } else {
            $("#gameTableText").html("You fall asleep.  When you awake, the sun is shining and you find yourself outside of a small but beautiful church.")
            healUp()
          }
        
          btnString = `
            <div class="mt-2">
            <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Continue your Journey
                </button>
          `
          $("#gameButtons").html(btnString)
        break;
        // Meet a priest
        case 3:
          if (playerCharacter.dishonor) {
            $("#gameTableText").html("You meet a traveling priest who offers to hear your confession.  If you confess your sins faithfully, not ony will honor be restored, but your soul shall be healed.")
          }
          btnString = `
            <div class="d-flex mt-2 justify-content-around">
            <button onclick="confessSins()" data-id="gotoConfessionBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Go to Confession
            </button>
            <button onclick="skipConfession()" data-id="skipConfessionBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Skip Confession
            </button>
            </div>
          `
          $("#gameButtons").html(btnString)
        break
        // Black Knight or Red Knight
        case 4:
        $("#gameTableText").html("Opening a door you see two mystical portals, each displaying a different scene. First: A questing paladin is about to be killed by a black knight. Second: A maiden is about to be attacked by a red knight. <br> You must choose who to save.")
          btnString = `
            <div class="d-flex mt-2 justify-content-around">
            <button onclick="saveThePaladin()" data-id="saveThePaladinBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Save the Paladin
            </button>
            <button onclick="saveTheMaiden()" data-id="saveTheMaidenBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Save the Maiden
            </button>
            </div>
          `
          $("#gameButtons").html(btnString)
        break;
        // The Hermit
        case 5:
          hermitRumorCount = 3
          btnString = `
          <div class="d-flex mt-2 justify-content-around">
            <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue your Journey
            </button>
            <button onclick="buyRumors()" data-id="buyRumorsBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Buy Rumor
            </button>
            </div>
          `
          $("#gameButtons").html(btnString)
        break;
        // The Dwarf
        case 6:
          // choose side quest
          // or:  event 7 (challenge or pilgrimage) or event event 9 (heroic quest or pilgrimage)
          btnString = `
            <div class="mt-2">
            <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Continue your Journey
                </button>
          `
          $("#gameButtons").html(btnString)
        break;
      }
      // click to go to the Journey table
      
        
    }
    // this is a global and should go with the other global variables
    let hermitRumorCount = 3
    function buyRumors() {
      if (playerCharacter.money < 50) {
        alert("You have insuffient funds to purchase any rumors.")
      } else {
        if (hermitRumorCount > 0) {
          playerCharacter.money -= 50
          playerCharacter.rumors ++
          updateNavbar()
        }
      }
    }
    function saveThePaladin() {
      $("#gameTableText").html("With the maiden's screams still echoing in your head, you leap through the portal to save the knight. ")
      challengerName = "The Black Knight"
      aKnight = new NPC(challengerName, 25, 25, 2, 6, 0, 2, "Longsword", "", "Chainmail", "male", "true");
      round = 1
      console.log("knight name: " + aKnight.name)
      
      btnString = `
        <div class="mt-2">
        <button onclick="combat()" data-id="gotoCombatBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Fight the Black Knight
        </button>
        </div>
      `
      $("#gameButtons").html(btnString)
    }
    function saveTheMaiden() {
      $("#gameTableText").html("The Black Knight slays the paladin as you leap through the other portal.")
      challengerName = "The Red Knight"
      aKnight = new NPC(challengerName, 25, 25, 2, 6, 0, 2, "Longsword", "", "Chainmail", "male", "true");
      round = 1
      console.log("knight name: " + aKnight.name)
      round=1
      btnString = `
        <div class="mt-2">
        <button onclick="combat()" data-id="gotoCombatBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Fight the Red Knight
        </button>
        </div>
      `
      $("#gameButtons").html(btnString)
    }
    function confessSins() {
      $("#gameTableText").append("After making a good confession, the priest then says:<p>Deinde, ego te absolvo a peccatis tuis in nomine Patris, et Filii, et Spiritus Sancti. Amen.</p>")
      $("#gameTableText").append("<p>If your sins were truly grave, he suggests that you go on a pilgrimage.</p>")
      playerCharacter.dishonor = false
      updateNavbar()
      btnString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Go to Inn
        </button>
        <button onclick="startEncounter()" data-id="startEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Go to an Encounter
        </button>
        <button onclick="rollPilgrimageTable()" data-id="pilgrimageBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Undertake Pilgrimage
        </button>
        </div>
      `
      $("#gameButtons").html(btnString)
    }
    function skipConfession() {
      $("#gameTableText").append("<p>The priest shrugs and says: 'Suite yourself'</p>  He then directs you to a crossroads.")
      
      btnString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Go to Inn
        </button>
        <button onclick="startEncounter()" data-id="startEncounterBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Go to an Encounter
        </button>
        </div>
      `
      $("#gameButtons").html(btnString)
    }
    
    function runPlagueVillage() {
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      
      $("#gameTableText").html("You can either bypass this village or help.  If you help, there is a chance you can earn a piety point. You also may die from the plague... just sayin.")
      
      
      
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="d-flex mt-2 justify-content-around">
          <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Continue your Journey
        </button>
        <button onclick="rollPlague()" data-id="rollPlagueBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Go to Plague Village
        </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    
    function rollPlague() {
      $("#gameTableText").html(playerCharacter.name + " selflessly risks life and limb in an effort to alleviate the pain and suffering of the villagers...<br>")
      $("#gameTableText").append("")
      let roll1 = rollDie(6)
      let roll2 = rollDie(6)
      
      let failedOne = false
      let failedTwo = false
      
      if (roll1 < 3) {
        failedOne = true
      }
      if (roll2 < 3) {
        failedTwo = true
      }
      
      if (failedOne && failedTwo) {
        // player has died from the plague!
        $("#gameTableText").append("<br><strong>Unfortunately, " + playerCharacter.name + " has died from the plague.</strong>  This selfless act will surely be remembered for all time.  <br>May God speed you on your way.")
        let rowString = `
        <div class="d-flex mt-2 justify-content-around">
          <button onclick="startNewGame()" data-id="startGameBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Start Over
        </button>
        </div>`
        $("#gameButtons").html(rowString)
      }
      
      if (!failedOne || !failedTwo) {
        //test for piety
        let num = rollDie(6)
        if (num > playerCharacter.piety) {
          
          if (playerCharacter.piety < 6) {
            playerCharacter.piety ++
            $("#gameTableText").append("<br>Not only did you bring comfort and solace to many, but you also survived the plague! Faith without works is dead and your work here has gained you a blessing from God. (You gained a piety point!)")
          } else {
            $("#gameTableText").append("<br>Not only did you bring comfort and solace to many, but you also survived the plague! Faith without works is dead and your work here has gained you continued blessings from God.")
          }
          updateNavbar()
        } else {
          $("#gameTableText").append("<br>Not only did you bring comfort and solace to many, but you also survived the plague! Faith without works is dead and your work here has gained you continued blessings from God.")
        }
        //$("#gameTableText").html()
        
        let btnString = `
        <div class="mt-2">
        <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Continue your Journey
        </button>
        </div>
        `
        $("#gameButtons").html(btnString)
      }
        
      
    }
    
    
    function runGrailCastle() {

      // click to go to the Journey table

      if (playerCharacter.piety < 1) {
        $("#gameTableText").html("For one so lacking in faith (piety points), the Grail Castle proves to be elusive.<br>")
        $("#gameTableText").append("<br>However, a knight has found you and issued a challenge!")
        let btnString = `
          <div class="mt-2">
          <button onclick="rollChallengeTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Fight a Knight!
          </button>
        </div>
        `
        $("#gameButtons").html(btnString)
      } else {

        $("#gameTableText").html("You see the castle shrouded in heavenly lights and hear angelic music! The old and maimed Fisher King asks you two questions, each requiring a piety test to answer.<br>")

        let roll1 = rollDie(6)
        let roll2 = rollDie(6)

        if (roll1 <= playerCharacter.piety) {
          $("#gameTableText").append(`<br>First roll: ${roll1} Needed to roll ${playerCharacter.piety} or less ---> passed!<br>`)
        } else {
          $("#gameTableText").append(`<br>First roll: ${roll1} Needed to roll ${playerCharacter.piety} or less ---> failed!<br>`)
        }

        if (roll2 <= playerCharacter.piety) {
          $("#gameTableText").append(`<br>Second roll: ${roll2} needed to roll ${playerCharacter.piety} or less ---> passed!<br><br>`)
        } else {
          $("#gameTableText").append(`<br>Second roll: ${roll2} needed to roll ${playerCharacter.piety} or less ---> failed!<br><br>`)
        }

        if (roll1 <= playerCharacter.piety && roll2 <= playerCharacter.piety) {
          // passed!
          $("#gameTableText").append(`<p>${playerCharacter.name} has answered both questions successfully! The Holy Grail appears in your hands!</p>`)
          $("#gameTableText").append("<br>Click to return to Camelot!")

          let btnString = `
            <div class="mt-2">
            <button onclick="returnToCamelot()" data-id="gotoCamelotBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Return to Camelot
            </button>
          </div>
          `
          $("#gameButtons").html(btnString)



        } else {
          // failed!
          $("#gameTableText").append(`<p>${playerCharacter.name} has failed! </p> The quest continues...`)

          let btnString = `
            <div class="mt-2">
            <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue your Journey
            </button>
          </div>
          `
          $("#gameButtons").html(btnString)


        }

        
      }       
    }
    

    function returnToCamelot() {
      // if Lancelot has returned, add 2 to the roll
      // global variable: lancelotHasReturned  (defaults to false)
      // global variable: returnToCamelot  (defaults to false)
      // -> need to check 'returnToCamelot' when the game starts.  IF true, THEN go to returnToCamelot ELSE continue as normal.

      let roll1 = rollDie(6)

      if (roll1 < 4) {
        $("gameTableText").html(`Word spreads that you have found the Holy Grail!  However, on the road to Camelot ${playerCharacter.name} is intercepted by a knight!`)

        let btnString = `
          <div class="mt-2">
          <button onclick="rollChallengeTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Fight a Knight!
          </button>
        </div>
        `
        $("#gameButtons").html(btnString)



      } else {
        $("gameTableText").html(`As ${playerCharacter.name} returns to Camelot, he finds King Arthur drained of all energy and near death. But when he drinks from the Holy Grail, life flows back! <br>He stands, unsheathes Excalibur and declares ${playerCharacter.name} to be the greatest of his paladins!<br><br>King Arthur now raises his war standard, summons the rest of his remaining nobels and engages Morgana and her brood on the field of battle... and he wins! <br><br> Peace reigns... for a time.`)
        $("gameTableText").append("<br><br>Would you like to play again?")

        btnString = `
          <div class="d-flex mt-2">
          <button onclick="startNewGame()" data-id="startNewGameBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Start New Game
          </button>
          </div>`
        $("#gameButtons").html(btnString)


      }
    }


    function runMinions() {
      // get minion type (day or night)
      let roll = rollDie(6)
      let dayMinions = true
      numMinions = 0
      minionType = ""
      
      if (roll < 4) {
        dayMinions = true
      } else {
        dayMinions = false
      }
      // generate minions
      if (dayMinions) {
        console.log("Day Minions")
        roll = rollDie(6)
        switch(roll) {
          case 1:
            // angry peasants
            minionType = "peasants"
            numMinions = 0
            for (let i=0; i<4; i++) {
              numMinions += rollDie(6)
            }
            minions = new Minion(minionType, numMinions, numMinions, 2, 0, 7, 0, 0, 1, -2, "Angry peasants. Maybe they're just hungry?")
          break;
          case 2:
            // forest outlaws
            minionType = "outlaws"
            numMinions = 0
            for (let i=0; i<2; i++) {
              numMinions += rollDie(6)
            }
            numMinions += 3
            minions = new Minion(minionType, numMinions, numMinions, 3, 0, 7, 0, 0, 1, -2, "Perhaps their tights are, well, too tight?")
          break;
          case 3:
            // da Picts!
            minionType = "picts"
            numMinions = rollDie(6) + 4 
            minions = new Minion(minionType, numMinions, numMinions, 4, 0, 7, 0, 0, 1, 1, "Screaming blue painted savages. Laranga did warn you about them after all.")
          break;
          case 4:
            // redcaps
            numMinions = rollDie(6)
            if (numMinions > 1) {
              minionType = "redcaps"
            } else {
              minionType = "redcap"
            }
            minions = new Minion(minionType, numMinions, numMinions, 3, 0, 7, 0, 0, 1, 0, "Very angry, potty-mouthed dwarves who continually swear throughout the fight. They wear enchanted, blood soaked caps, and are surprisingly agile. They greatly fear Christ and His holy relics.")
            console.log("minion: " + minions.name)
          break;
          case 5:
            // bugbears
            numMinions = rollDie(3)
            numMinions += 2
            minionType = "bugbears"
            minions = new Minion(minionType, numMinions, numMinions, 5, 0, 7, 0, 0, 2, 1, "They're big, hairy smelly goblins. Not sure what they have to do with bugs or bears, but there you have it.")
          break;
          case 6:
            // Men-at-arms
            numMinions = rollDie(6)
            numMinions += 4
            minionType = "men-at-arms"
            minions = new Minion(minionType, numMinions, numMinions, 5, 0, 7, 0, 0, 1, 0, "Not quite as dirty or smelly as your average ork but close. Maybe they just don't like the way you dress?")
          break;
        }
        console.log("minion type: " + minionType)
      } else {
        console.log("Night Minions")
        roll = rollDie(6)
        switch(roll) {
          case 1:
            // wolves
            numMinions = rollDie(6)
            numMinions += 4
            minionType = "wolves"
            minions = new Minion(minionType, numMinions, numMinions, 3, 0, 7, 0, 0, 0, 0, "Great big nasty dogs (canis lupus). Real dogs, not some modern day yappy thing.")
          break;
          case 2:
            // Pagan cultists
            numMinions = rollDie(6)
            numMinions += 3
            minionType = "cultists"
            minions = new Minion(minionType, numMinions, numMinions, 3, 0, 7, 0, 0, 1, 0, "Black robed followers of Morgana and possibly Satan himself.")
          break;
          case 3:
            // wild boars
            numMinions = rollDie(6)
            if (numMinions > 1) {
              minionType = "boars"
            } else {
              minionType = "boar"
            }
            minions = new Minion(minionType, numMinions, numMinions, 4, 0, 7, 0, 0, 0, 0, "Extremely dangerous and surly.  Not your average pig. Bacon anyone?")
          break;
          case 4:
            // hellhounds
            numMinions = rollDie(6)
            minionType = (numMinions > 1) ? "hellhounds" : "hellhound"
            minions = new Minion(minionType, numMinions, numMinions, 4, 0, 7, 0, 0, 0, 0, "Demon dogs with flaming eyes and foul breath. You should probably send them back to Hell.")
          break;
          case 5:
            // ogres
            numMinions = rollDie(3)
            minionType = (numMinions > 1) ? "ogres" : "ogre"
            minions = new Minion(minionType, numMinions, numMinions, 5, 0, 7, 0, 0, 1, 0, "Big, strong but slow and stupid.")
          break;
          case 6:
            // fairy fire
            numMinions = 1
            minionType = "fairyFire"
          break;
        }
        console.log("minion type: " + minionType)
      }
      //console.log("minion: " + minions.name)
      if (minionType == "fairyFire") {
        $("#gameTableText").html("You've encountered a Will-o'-the-Wisp.  It attempts to drain your life as it draws you into it.  You can't kill it. Your only hope is to resist it.<br>")
        let rowString = `
          <div class="d-flex mt-2">
          <button onclick="fairyFire()" data-id="fightMinionBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Fairy Fire
          </button>
          </div>
          `
        //$("#gameButtons").empty()
        $("#gameButtons").html(rowString) 
      } else {
        $("#gameTableText").html(`You have encountered <span class="rounded" style="color:black; background-color:blanchedalmond; padding: 2px;">${numMinions} ${minionType}</span><br>`)
        $("#gameTableText").append("<br>" + minions.description + "<br><br>")
        $("#gameTableText").append("<p>You can attack immediately which will give you the initiative or you can wait and see what they do. <br><br>Note: if you wait and see and the opponents attack, they will attack first.</p>")
        // show options
        let rowString = `
          <div class="d-flex mt-2 justify-content-around">
          <button onclick="fightMinions()" data-id="fightMinionBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Fight Minions!
          </button>
          <button onclick="waitAndSee()" data-id="waitAndSeeBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Wait and see.
          </button>
          </div>
          `
        //$("#gameButtons").empty()
        $("#gameButtons").html(rowString) 
      }
    }
    
    function runKnightChallengeQuest() {
      
      // NOTE! Fight a Knight OR Visit a Shrine (Pilgrimage Table)
      $("#gameTableText").append("You may fight a knight or undertake a perilous Pilgrimage to a Shrine.")
      
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollChallengeTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Fight Challenger!
        </button>
        <button onclick="rollPilgrimageTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to a Shrine!
        </button>
        </div>
        `
      $("#gameButtons").empty()
      $("#gameButtons").html(rowString)        
    }
    
    
    
    function runHeroicQuest() {
    
      // NOTE! Heroic Quest OR Visit a Shrine (Pilgrimage Table)

      if (sideQuests.length < 1) {

        $("#gameTableText").append("No side quests are available.  You may however choose to embark on a perilous Pilgrimage to a Shrine!")
      
        let rowString = `
          <div class="d-flex mt-2 justify-content-around">
          <button onclick="rollPilgrimageTable()" data-id="rollPilgrimageBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to a Shrine!
          </button>
          </div>`
        $("#gameButtons").html(rowString) 

      } else {

        $("#gameTableText").append("You may embark on a Heroic Quest or undertake a perilous Pilgrimage to a Shrine!")
      
        let rowString = `
          <div class="d-flex mt-2 justify-content-around">
          <button onclick="rollHeroicQuestTable()" data-id="rollHeroicBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Heroic Quest!
          </button>
          <button onclick="rollPilgrimageTable()" data-id="rollPilgrimageBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to a Shrine!
          </button>
          </div>`
        $("#gameButtons").html(rowString) 
      }  
    }
    
    function runPovertyVillage() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      
      $("#gameTableText").html("You can either bypass this village or help.  If you donate at least 50 silver in items or coin, you can roll for a piety point.<br><br>")
      
      $("#gameTableText").append("Remember, giving alms is a corporal work of mercy.<br>")

      let inputBox = `<input type="text" id="donationInputBox" value="0">`
      $("#gameTableText").append(inputBox)
      
      let rowString = `
        <div class="d-flex mt-2 justify-content-around">
        <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Continue your Journey
        </button>
        <button onclick="donateToThePoor()" data-id="donateToThePoorBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Make a Donation
        </button>
      `
      $("#gameButtons").html(rowString)
        
    }
    
    
    function donateToThePoor() {
      let donation = $("#donationInputBox").val()
      if (donation < 1) {
        alert("Please enter an amount greater than 0")
        return
      }
      if (donation > playerCharacter.money) {
        alert("Invalid amount!")
      } else {
        if (donation > 49) {
          // roll for piety
          let roll1 = rollDie(6)
          if (roll1 > playerCharacter.piety) {
            
            if (donation == 50) {
              $("#gameTableText").html(`50 silver huh? Really? Just remember, it's not really charity if you expect to gain something in return.`)
            } else {
              $("#gameTableText").html(`Thank you for donating ${donation} silver pieces!<br>`)
            }
 

            $("#gameTableText").append("<br><br>You gained a piety point!")
            playerCharacter.piety++
            updateNavbar()
            $("#topDivPiety").html(playerCharacter.piety)
          } else {
            $("#gameTableText").html(`Thank you for donating ${donation} silver pieces!<br>`)
            if (donation == 50) $("#gameTableText").append(`<br>50 silver huh? Really? Just remember, it's not really charity if you expect to gain something in return.`)

            $("#gameTableText").append("<br>Thank you for your donation!")
            $("#gameTableText").append("<br>Pius yes, but apparently not enough to gain a piety point. The Fates can be fickle.  Anway, giving is it's own reward so stop complaining.")
          }

          // after making a donation display the journey button
          let rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue your Journey
            </button>
          `
          $("#gameButtons").html(rowString)


        } else {
          playerCharacter.money -= donation
          updateNavbar()
          $("#gameTableText").html("Your donation: " + donation)
          $("#gameTableText").append("<br>Thank you for your donation!")

          // after making a donation display the journey button
          let rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue your Journey
            </button>
          `
          $("#gameButtons").html(rowString)
        }
      }

    }
 
    
    function runTestOfPiety() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      
      // Test of piety: 
      let roll = rollDie(6)
      if (roll <= playerCharacter.piety) {
        // test passed
      }
      
      // to gain a piety point:
      roll = rollDie(6)
      if (roll > playerCharacter.piety) {
        // playerCharacter.piety ++
      }
      
      
      roll = rollDie(6)
      switch (roll) {
        case 1: 
          // hermit (Lancelot!)
        break;
        case 2:
          // Sword of the Red Hilt
        break;
        case 3: 
          // Attacked by a Succubus
        break;
        
        case 4:
          // griffins
          // if pass, then roll on the Encounter Table 4 times and choose one
        break;
        
        case 5:
          // Ship made from the wood from the Tree of Life (treasure: Sword of the Strange Belt)
        break;
        
        case 6:
          // Nimue (Lady of the Lake) appears!
          // select any option from this list.
        break;
      }
      
      
      
      
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    function runMerlin() {
      $("#gameTableText").empty()
      $("#gameButtons").empty()
      
      $("#gameTableText").html("<p>Merlin heals you (and your retainers) back to full strength!</p>")
      let num = rollDie(6) + 1
      $("#gameTableText").append(`<p>He also gives you wise counsel.  (you gain ${num} rumors)</p>`)
      
      playerCharacter.rumors += num
      playerCharacter.cur_hp = playerCharacter.max_hp
      
      // heal up retainers
      
      updateNavbar()
      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
        <i class="mt-2"></i>
        Continue your Journey
            </button>
      `
      $("#gameButtons").html(gotoJourneyButton)
        
    }
    
    // -----------------------------------------------------
    // End Encounter Table
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Traitors Table
    // -----------------------------------------------------
    
    function rollTraitorsTable() { 
      //$("#gameTableText").empty()
      $("#gameButtons").empty()
      // number of captains slain modifies this roll
      // 1 captain = +1
      // 2-3 captains = +2
      // 4+ captains = +3
      let modifier = 0
      switch (playerCharacter.captainsSlain) {
        case 0:
          modifier = 0
        break;
        case 1:
          modifier = 1
        break;
        case 2:
        case 3:
          modifier = 2
        break;
        default:
          modifier = 3
      }
      let roll = (rollDie(6) + modifier)
      
      if (playerCharacter.onPilgrimage) roll = 1
      
      switch (roll) {
        case 1:
        case 2:
          $("#gameTableText").append(`${playerCharacter.name} ` + traitorsTable[0])
          playerCharacter.rebellionLevel++
          updateNavbar()
          if (playerCharacter.onPilgrimage) rebellionLevelIncreased=true
        break
        case 3:
        case 4:
          $("#gameTableText").append(`${playerCharacter.name} ` + traitorsTable[1])
          playerCharacter.rumors++
          playerCharacter.rebellionLevel++
          updateNavbar()
          if (playerCharacter.onPilgrimage) rebellionLevelIncreased=true
        break
        default:
          $("#gameTableText").append(`${playerCharacter.name} ` + traitorsTable[2])
      }
      let rowString = ""
      if (playerCharacter.onPilgrimage) {
        if (playerCharacter.rebellionLevel < 5) {
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        }
      } else {
        rowString = `
          <div class="d-flex mt-2">
          <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
        </div>`
        $("#gameButtons").html(rowString)
      }
      
    }
    
    // -----------------------------------------------------
    // END Traitors Table
    // -----------------------------------------------------
    
    // -----------------------------------------------------
    // Challenge Table
    // -----------------------------------------------------
    
    let challengerName = ""
    
    function rollChallengeTable() {
      $("#gameTableText").empty()
      console.log("rollChallengeTable")
      // add rebellion level to this roll
      let modifier = 0
      switch (playerCharacter.rebellionLevel) {
        case 0:
          modifier = 0
        break;
        case 1:
          modifier = 1
        break;
        case 2:
        case 3:
          modifier = 2
        break;
        default:
          modifier = 3
      }
      let roll = (rollDie(6) + modifier)
      console.log("challenger roll: " + roll)
      
      switch (roll) {
        case 1:
        case 2:
        case 3:
        case 4:
        case 5:
          $("#gameTableText").append("A knight issues a challenge!")
          //gotoCombat()
          $("#gameTableTitle").append(" - a Knight")
          challengerName = "Sir Blank"
        break;
        case 6:
          $("#gameTableText").append("Sir Agravain issues a challenge!")
          $("#gameTableTitle").append(" - Sir Agravain")
          challengerName = "Sir Agravain"
        break;
        case 7:
          $("#gameTableText").append("Sir Garlon issues a challenge!")
          $("#gameTableTitle").append(" - Sir Garlon")
          challengerName = "Sir Garlon"
        break;
        case 8:
          $("#gameTableText").append("Sir Turquine issues a challenge!")
          $("#gameTableTitle").append(" - Sir Turquine")
          challengerName = "Sir Turquine"
        break;
        default:
          $("#gameTableText").append("Sir Mordred issues a challenge!")
          $("#gameTableTitle").append(" - Sir Mordred")
          challengerName = "Sir Mordred"
        break;
      }
      round=1
      let rowString = `
        <div class="d-flex mt-2">
          <button onclick="knightChallenge()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Go to Challenge
          </button>
        </div>`
      $("#gameButtons").html(rowString)
    }
    
    // -----------------------------------------------------
    // Challenge Table
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Pilgrimage Table
    // -----------------------------------------------------
    let pilgrimageTurns = 0
    
    function rollPilgrimageTable() {
      playerCharacter.turn++
      pilgrimageTurns++
      
      $("#gameTableTitle").html(`Pilgrimage! - Turn: ${pilgrimageTurns}`)
      
      updateNavbar()
      let rowString = ""
      
      // keep rolling until a 6 is rolled
      let roll = rollDie(6)
      modifier = playerCharacter.pilgrimageModifier
      console.log("Pilgrimage mod: " + modifier)
      playerCharacter.onPilgrimage = true
      updateNavbar()
      roll == roll + modifier
      switch (roll) {
        case 1: 
          playerCharacter.pilgrimageModifier = (merchant > 0) ? 2 : 1;
          updateNavbar()

          console.log("Pilgrimage mod is now: " + playerCharacter.pilgrimageModifier)
          $("#gameTableText").html("<p>This is taking too long!  Time is running out and traitors have attacked!</p>")
          rollTraitorsTable()
        break;
        case 2:
          $("#gameTableText").html("You enter a dense forest, slowing you down.")
          if (woodsman > 0) {
            $("#gameTableText").append("<br>Good thing you have a woodsman to help you get through it!")
            playerCharacter.pilgrimageModifier = 0
            updateNavbar()
          } else {
            $("#gameTableText").append("<br>Too bad you didn't have a woodsman.")
            playerCharacter.pilgrimageModifier = -1
            updateNavbar()
          }
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 3:
          $("#gameTableText").html("You enter lawless area with many bandits.")
          if (soldier > 0) {
            $("#gameTableText").append("<br>Which are dispatched in no time due to the help of your hired soldier(s)!")
            playerCharacter.pilgrimageModifier = 0
            updateNavbar()
          } else {
            $("#gameTableText").append("<br>Too bad you didn't have any men-at-arms.")
            playerCharacter.pilgrimageModifier = -1
            updateNavbar()
          }
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 4:
          $("#gameTableText").html("You meet other pilgrims who insist on story telling and feasting, slowing you down.")
          if (rogue > 0) {
            $("#gameTableText").append("<br>Thankfully, your rogue friend is very entertaining!")
            playerCharacter.pilgrimageModifier = 0
            updateNavbar()
          } else {
            $("#gameTableText").append("<br>Too bad you didn't have any rogues in your group of retainers.")
            playerCharacter.pilgrimageModifier = -1
            updateNavbar()
          }
          $("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
          rowString = `
            <div class="d-flex mt-2">
            <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue Pilgrimage
            </button>
          </div>`
          $("#gameButtons").html(rowString)
        break
        case 5:
          $("#gameTableText").html("On your journey, you meet a physician.")
          //$("#gameTableText").append("<p><br>Your pilgrimage continues...</p>")
            if (playerCharacter.money < 5 && playerCharacter.cur_hp < playerCharacter.max_hp) {
              $("#gameTableText").append("<p>The doctor, having noticed that your purse is empty, proclaims that he can do no more for you and recomends that you get plenty of rest, drink lots of water... and pray.</p>")
      
            rowString = `
              <div class="d-flex mt-2">
              <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Continue Pilgrimage
              </button>
            </div>`
            $("#gameButtons").html(rowString)
          } else if (playerCharacter.money > 4 && playerCharacter.cur_hp < playerCharacter.max_hp) {
            $("#gameTableText").append("<br>Having noticed that you have coins in your purse, he offers to heal you for 5 silver pieces.")
            rowString = `
              <div class="d-flex mt-2 justify-content-around">
              <button onclick="rollPilgrimageTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Continue Pilgrimage
              </button>
              <button onclick="physicianHeal()" data-id="physicianHealBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Pay Doctor for Healing
              </button>
            </div>`
            $("#gameButtons").html(rowString)
          } else {
            rowString = `
              <div class="d-flex mt-2">
              <button onclick="rollPilgrimageTable()" data-id="rollPilgrimageBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Continue Pilgrimage
              </button>
            </div>`
            $("#gameButtons").html(rowString)
          }
        break
        case 6:
          $("#gameTableText").html("You reach the shrine, the pilgrimage is over!")
          if (pilgrimageTurns < 3) {
            $("#gameTableText").append("<p>Well that was quick...<\p>")
          }
          if (pilgrimageTurns > 6) {
            $("#gameTableText").append("<p>took you long enough</p>")
          }
          pilgrimageTurns = 0
          
          playerCharacter.onPilgrimage = false
          updateNavbar()


          if (rebellionLevelIncreased) {
            let rollPiety = rollDie(6)
            if (rollPiety > playerCharacter.piety) {
              $("#gameTableText").append("<p>You gained a piety point!<\p>")
              playerCharacter.piety++
              updateNavbar()
              //$("#topDivPiety").html(playerCharacter.piety)
            }
          }
          // set this switch back to false
          rebellionLevelIncreased = false

          rowString = `
            <div class="d-flex mt-2">
              <button onclick="rollJourneyTable()" data-id="rollLostBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Journey On
              </button>
            </div>`
          $("#gameButtons").html(rowString)
        break
      }
      
      
    }
    
    
    
    function physicianHeal() {
    let rowString = ""
      if (playerCharacter.money > 4) {
        let roll1 = rollDie(6)
        let roll2 = rollDie(6)
        let total = roll1 + roll2
        $("#gameTableText").html("<p>The doctor heals you for " + total + " points.</p>")
        playerCharacter.money -= 5
        
        $("#gameTableText").append(`<p>(Healing Roll: ${roll1} + ${roll2} = ${total})</p>`)
        
        
        if ((total + playerCharacter.cur_hp) >= playerCharacter.max_hp) {
          playerCharacter.cur_hp = playerCharacter.max_hp
          $("#gameTableText").append("<p>Under his expert care, ALL of your wounds have been healed!</p>")
          
          rowString = `
              <div class="d-flex mt-2">
              <button onclick="rollPilgrimageTable()" data-id="rollPilgrimageBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Continue Pilgrimage
              </button>
            </div>`
            $("#gameButtons").html(rowString)
          
          
        } else {
          playerCharacter.cur_hp = total + playerCharacter.cur_hp
          $("#gameTableText").append("<p>He manages to heal some of your wounds.</p>")
        }
        $("#gameTableText").append(`<p>Current Health: ${playerCharacter.cur_hp}</p>`)
        
        updateNavbar()
      } else {
        $("#gameTableText").append("<p>The doctor, noticing that your purse is empty, proclaims that he can do no more for you and recomends that you get plenty of rest, drink lots of water... and pray.</p>")
        rowString = `
              <div class="d-flex mt-2">
              <button onclick="rollPilgrimageTable()" data-id="rollPilgrimageBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Continue Pilgrimage
              </button>
            </div>`
            $("#gameButtons").html(rowString)
      }
    }
    
    
    // -----------------------------------------------------
    // End Pilgrimage Table
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Heroic Quest Table
    // -----------------------------------------------------
    
    // sideQuests is an array and is defined above

    let taulurdObj = {
      name: "Taulurd the Giant",
      level: 6,
      cur_hp: 45,
      max_hp: 45,
      armor: 1,
      attack: 7,
      att_mod: 0,
      dmg_mod: 5,
      wpn1: "Large Iron Club",
      wpn2: "",
      aromr: "Animal Skins",
      isAlive: true,
      treasureRolls: 4,
      morale: -1
    }

    let dragonObj = {
      name: "Dragon",
      level: 6,
      cur_hp: 40,
      max_hp: 40,
      armor: 3,
      attack: 7,
      att_mod: 0,
      dmg_mod: 3,
      wpn1: "Teeth and Claws",
      wpn2: "",
      aromr: "Dragon Scale",
      isAlive: true,
      treasureRolls: 4,
      morale: 0
    }

    let greenKnightObj = {
      name: "The Green Knight",
      level: 7,
      cur_hp: 40,
      max_hp: 40,
      armor: 4,
      attack: 7,
      att_mod: 0,
      dmg_mod: 3,
      wpn1: "Teeth and Claws",
      wpn2: "",
      aromr: "Double Chainmail",
      isAlive: true,
      treasureRolls: 1,
      morale: -2
    }

    let questingBeastObj = {
      name: "The Questing Beast",
      level: 6,
      cur_hp: 30,
      max_hp: 30,
      armor: 1,
      attack: 7,
      att_mod: 0,
      dmg_mod: 1,
      wpn1: "Teeth and Claws",
      wpn2: "",
      aromr: "Tough Hide",
      isAlive: true,
      treasureRolls: 2,
      morale: -2
    }

    let laamorzObj = {
      name: "Laamorz the Wizard",
      level: 5,
      cur_hp: 30,
      max_hp: 30,
      armor: 0,
      attack: 7,
      att_mod: 0,
      dmg_mod: 1,
      wpn1: "Staff or The Dark Arts",
      wpn2: "",
      aromr: "None",
      isAlive: true,
      treasureRolls: 3,
      morale: -2
    }

    function rollHeroicQuestTable() {

      // As sidequest monsters are defeated, they are removed from the table 
      // therefore, use the length of the array to generate a random number.

      let dieRoll = rollDie(sideQuests.length)
      console.log("side quest rolled: [" + dieRoll + "] - " + sideQuests[dieRoll -1])

// Giant
      if (sideQuests[dieRoll -1] == "Taulurd the Giant") {
        $("#gameTableTitle").append(" - Taulurd the Giant")
        $("#gameTableText").html(sideQuests[dieRoll -1] + " is ravaging the lands. In other words, he's killing things and taking their stuff.  We can't have that, now can we?<br><br>Do you dare to put a stop to this menace... and take his stuff?")
        round=1

        challengerName = "Taulurd the Giant"
        aKnight = new NPC(challengerName, 0, 45, 45, 0, 7, 0, 5, "Large Iron Club", "", "Animal Skins", "male", true, 0, 4, true)
        aKnight.level = 6
        aKnight.cur_hp = 45
        aKnight.max_hp = 45
        aKnight.armor = 1
        aKnight.att_mod = 0
        aKnight.dmg_mod = 5
        

        let btnString = `
          <div class="d-flex mt-2">
          <button onclick="combat()" data-id="fightSideQuestBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Fight The Giant!
          </button>
          </div>`
        $("#gameButtons").html(btnString)

      }

// dragon
      if (sideQuests[dieRoll -1] == "A Dragon") {
        $("#gameTableTitle").append(" - A Dragon")
        $("#gameTableText").html("Frantic villagers come to you begging you to save them from a nasty dragon who has been buring homes and eating fair maidens.  <br><br>Will you follow in St George's footsteps and put a stop to this or will you become food for worms?")
        round=1

        challengerName = "A Dragon"
        aKnight = new NPC(challengerName, 0, 30, 30, 0, 7, 0, 3, "Teeth and Claws", "", "Dragon Scale", "male", true, 0, 4, true)
        aKnight.level = 6
        aKnight.cur_hp = 30
        aKnight.max_hp = 30
        aKnight.armor = 3
        aKnight.att_mod = 0
        aKnight.dmg_mod = 3


        let btnString = `
          <div class="d-flex mt-2">
          <button onclick="combat()" data-id="fightSideQuestBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Fight The Dragon!
          </button>
          </div>`
        $("#gameButtons").html(btnString)

      }

// The Green Knight
      if (sideQuests[dieRoll -1] == "The Green Knight") {
        $("#gameTableTitle").append(" - The Green Knight")
        $("#gameTableText").html(`${playerCharacter.name} has encountered The Green Knight!  He offers you a magic Belt of Protection but only if you can pass a test of piety AND beat him in combat.<br>`)

        // piety test
        let pietyRoll = rollDie(6)
        if (pietyRoll <= playerCharacter.piety) {
          $("#gameTableText").append("<br>Piety Roll: " + pietyRoll + " Needed: " + playerCharacter.piety + " or less --> Passed!<br>")
          $("#gameTableText").append("<br><br>You have passed the test, now it is time to see if you can defeat the Green Knight in combat!")
          round=1


        challengerName = "The Green Knight"
        aKnight = new NPC(challengerName, 0, 30, 30, 0, 6, 0, 3, "Battle Ax", "", "Chainmail Hauberk", "male", true, -2, 1, true)
        aKnight.level = 7
        aKnight.cur_hp = 30
        aKnight.max_hp = 30
        aKnight.armor = 3
        aKnight.att_mod = 1
        aKnight.dmg_mod = 3


          let btnString = `
            <div class="d-flex mt-2">
            <button onclick="combat()" data-id="fightsideQuestBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Fight The Green Knight!
            </button>
            </div>`
          $("#gameButtons").html(btnString) 
        } else {
          $("#gameTableText").append("<br>Piety Roll: " + pietyRoll + " Needed: " + playerCharacter.piety + " or less --> Failed!<br>")
          $("#gameTableText").append("<br>The Green Knight finds your lack of faith disturbing.  Before he leaves you, he hands you a bible, a Rosary and tells you to go to church you filthy heathen.")

          // click to go to the Journey table
          let gotoJourneyButton = `
            <div class="mt-2">
            <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Continue your Journey
            </button>
            </div>`
          $("#gameButtons").html(gotoJourneyButton)
        }
      }

// The Questing Beast
      if (sideQuests[dieRoll -1] == "The Questing Beast") {
        $("#gameTableTitle").append(" - The Questing Beast")
        $("#gameTableText").html("The Questing Beast is heard crashing through the trees nearby.")

        // roll to see if it eludes the player
        let beastRoll = rollDie(6)
        if (beastRoll < 5) {
          // beast is not found
          // roll again if the player has a hunter/woodsman in the group
          if (woodsman > 0) {
            beastRoll = rollDie(6)
            if (beastRoll < 5) {
              // not found so journey on

              $("#gameTableText").append("<br>Unfortunately, the Questing Beast got away.")

              let gotoJourneyButton = `
                <div class="mt-2">
                <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                  <i class="mt-2"></i>
                  Continue your Journey
                </button>
                </div>`
              $("#gameButtons").html(gotoJourneyButton)
            } else {
              $("#gameTableText").append("<br>With the help of your woodsman, you have cornered the Questing Beast!")

              round=1


        challengerName = "The Questing Beast"
        aKnight = new NPC(challengerName, 0, 30, 30, 0, 7, 0, 3, "Teeth and Claws", "", "Tough Hide", "male", true, -2, 2, true)
        aKnight.level = 6
        aKnight.cur_hp = 30
        aKnight.max_hp = 30
        aKnight.armor = 3
        aKnight.att_mod = 1
        aKnight.dmg_mod = 1

              let btnString = `
                <div class="d-flex mt-2">
                <button onclick="combat()" data-id="fightsideQuestBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                  <i class="mt-2"></i>
                  Fight The Questing Beast!
              </button>
              </div>`
              $("#gameButtons").html(btnString) 
            }
          } else {
            // not found so journey on
            $("#gameTableText").append("<br>You give chase, but unfortunately it got away.")
            let gotoJourneyButton = `
              <div class="mt-2">
              <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Continue your Journey
              </button>
              </div>`
            $("#gameButtons").html(gotoJourneyButton)
          }
        } else {
          // found it!
          $("#gameTableText").append("<br>You have cornered the Questing Beast!")
          round=1


        challengerName = "The Questing Beast"
        aKnight = new NPC(challengerName, 0, 30, 30, 0, 7, 0, 3, "Teeth and Claws", "", "Tough Hide", "male", true, -2, 2, true)
        aKnight.level = 6
        aKnight.cur_hp = 30
        aKnight.max_hp = 30
        aKnight.armor = 3
        aKnight.att_mod = 1
        aKnight.dmg_mod = 1


          let btnString = `
            <div class="d-flex mt-2">
            <button onclick="combat()" data-id="fightsideQuestBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Fight The Questing Beast!
            </button>
            </div>`
          $("#gameButtons").html(btnString) 
        }
      }

// Three blind old hags

      if (sideQuests[dieRoll -1] == "Three Blind Old Hags") {
        $("#gameTableTitle").append(" - Three Blind Old Hags")

        hagMoney = 0

        for (let i=6; i>0; i--) {
          hagMoney += rollDie(6)
        }
        hagMoney = hagMoney * 2

        $("#gameTableText").html(`You encounter three blind old hags who demand that you pay them ${hagMoney} silver!`)

        let textString = `
          <div class="mt-2 justify-content-around">
            <button onclick="payHags()" data-id="payHagsBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Pay Hags
            </button>
            <button onclick="dontPayHags()" data-id="dontPayHagsBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Don't Pay Hags
            </button>
            </div>`

         $("#gameButtons").html(textString)
      }


      if (sideQuests[dieRoll -1] == "Laamorz the Wizard") {
        $("#gameTableTitle").append(" - Laamorz the Wizard")

        $("#gameTableText").html("Click below to fight the evil wizard Laamorz!")

        round=1


        challengerName = "Laamorz the Wizard"
        aKnight = new NPC(challengerName, 0, 30, 30, 0, 7, 0, 3, "Staff of the Dark Arts", "", "Clothing", "male", true, -2, 3, true)
        aKnight.level = 5
        aKnight.cur_hp = 30
        aKnight.max_hp = 30
        aKnight.armor = 0
        aKnight.att_mod = 0
        aKnight.dmg_mod = 1


              let btnString = `
                <div class="d-flex mt-2">
                <button onclick="combat()" data-id="fightsideQuestBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                  <i class="mt-2"></i>
                  Fight Laamorz!
              </button>
              </div>`
              $("#gameButtons").html(btnString) 
      }
    }
    

    function payHags() {

      if (playerCharacter.money < hagMoney) {
        dontPayHags()
      } else {
        playerCharacter.money -= hagMoney
        updateNavbar()

        $("#gameTableText").append(`<br><br>The hags laugh at you as they take your money and disapear into the night!`)

        // click to go to the Journey table
        let gotoJourneyButton = `
          <div class="mt-2">
          <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Continue your Journey
          </button>
          </div>`
        $("#gameButtons").html(gotoJourneyButton)
      }
    }


    function dontPayHags() {
      $("#gameTableText").append(`<br>At your refusal to pay their extortion fee, a strange battle ensues with the hags mocking, belittling and throwing things!  They are so annoying that you need to make three saves!`)
      $("#gameTableText").append("<br>(You only need to save one of the three rolls in order to succeed.)")
      let saves = 0
      let saved = ""
      for (let i=0; i<3; i++) {
        let roll = rollDie(6)
        saved = (roll >= 5) ? "Passed" : "Failed"
        $("#gameTableText").append(`<br>Roll ${i+1} --> ${roll} Need: 5 --> ${saved}!`)
        if (saved == "Passed") saves++
      }
      if (saves == 0) {
        $("#gameTableText").append("<br><br><strong>You fly into a mad rage killing and destroying everything in sight... including the Eye of True Seeing!</strong>  To say the least, this is a very dishonorable act.")

        playerCharacter.dishonor = true
        updateNavbar()

        // click to go to the Journey table
        let gotoJourneyButton = `
          <div class="mt-2">
          <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Continue your Journey
          </button>
          </div>`
        $("#gameButtons").html(gotoJourneyButton)


      } else {
        $("#gameTableText").append(`<br>In the chaos ${playerCharacter.name} manages to refrain from hacking the hags to bits, but also snatched the hag's Eye of True Seeing!`)

        $("#gameTableText").append("<br><br>Do you want to trade the Eye of True Seeing back to the hags in exchange for rumors?")


        let textString = `
          <div class="mt-2 justify-content-around">
            <button onclick="tradeEyeForRumors()" data-id="tradeEyeForRumorsBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Trade the Eye
            </button>
            <button onclick="dontTradeEye()" data-id="dontTradeEyeBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Don't Trade the Eye
            </button>
            </div>`

         $("#gameButtons").html(textString)

      }

        // remove them from the sideQuest array
        sideQuests = $.grep(sideQuests, function(value){ 
          return value != "Three Blind Old Hags"; 
        });
        playerCharacter.sideQuests++
        updateNavbar()

        // gain exp
        let levelUp = false
        levelUp = xpRoll()

        if (levelUp) {
          $("gameTableText").append(`<br>${playerCharacter.name} has gained a level!`)
        }
    }


    function tradeEyeForRumors() {
      let rumors = rollDie(6)
      rumors ++
      $("#gameTableText").append("<br><br>You trade the Eye of True Seeing for " + rumors + " rumors")
      playerCharacter.rumors = playerCharacter.rumors + rumors
      updateNavbar()

      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Continue your Journey
        </button>
        </div>`
      $("#gameButtons").html(gotoJourneyButton)

    }

    function dontTradeEye() {
      // add the eye to the player's inventory
      $("#gameTableText").append("<br><br>The hags hurl insults at you as you leave.")
      let eyeOfTrueSeeing = {
        id: 5,
        name: "The Eye of True Seeing",
        type: "Magic Item",
        ranged: false,
        readied: false,
        cost: 0,
        damage_bonus: 0
      }
      inventory.push(eyeOfTrueSeeing)

      // click to go to the Journey table
      let gotoJourneyButton = `
        <div class="mt-2">
        <button onclick="rollJourneyTable()" data-id="gotoJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Continue your Journey
        </button>
        </div>`
      $("#gameButtons").html(gotoJourneyButton)

    }


    // -----------------------------------------------------
    // End Heroic Quest Table
    // -----------------------------------------------------
    
    
    
    // -----------------------------------------------------
    // Retainers
    // -----------------------------------------------------
    
    function showRetainersModal() {
      $("#modalTitle").html("Retainers")
      let retainersTable = `
        <div class='row'>
        <div class="col-lg-12 bg-white rounded shadow-sm mb-5">
            <div class="table-responsive">
              <table class="table table-condensed" id="showRetainersTable">
                <thead>
                  <tr>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Name</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Lv</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Profession</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark"> Hit Points </div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Att</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Dmg</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Armor</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Morale</div>
                    </th>
                  </tr>
                </thead>
                <tbody id="showRetainerTableBody">
                  <!-- Javascript fills in the table here -->
                </tbody>
              </table>
            </div> <!-- End Table container -->
          </div> <!-- END column 1-->
      </div>  <!-- END row -->
      `
  
      $("#characterStatsModal").html(retainersTable)
      
      $.each(retainers, function(key, value) {
        let retainer_name = value.name
        let retainer_profession = value.profession
        let retainer_curHP = value.cur_hp
        let retainer_maxHP = value.max_hp
        let retainer_id = 0
        let retainerRow = `
          <tr>
            <td class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_name}</td>
            <td class="border-0 align-center text-left text-dark p-2 px-3"> ${value.level}</td>
            <td class="border-0 align-center text-left text-dark p-2 px-3"> ${retainer_profession}</td>
            <td class="border-0 align-center text-left text-dark p-2 px-3">
              <span>${retainer_curHP} / ${retainer_maxHP}</span>
            </td>
            <td class="border-0 align-center text-left text-dark p-2 px-3"> ${value.attack}</td>
            <td class="border-0 align-center text-left text-dark p-2 px-3"> ${value.damage_bonus}</td>
            <td class="border-0 align-center text-left text-dark p-2 px-3"> ${value.armor_bonus}</td>
            <td class="border-0 align-center text-left text-dark p-2 px-3"> ${value.morale}</td>
          </tr>
        `
        //console.log("Name: " + retainer_name + " Profession: " + retainer_profession);
        $("#showRetainersTable").append(retainerRow)
      });
    }
    
    function manageRetainersModal() {
      $("#modalTitle").html("Manage Retainers")
      let retainerHireFireTable = `
        <div class='row'>
          Money: <span id="pcMoney"> ${playerCharacter.money}</span>
        </div>
        <div class='row'>
        <div class="col-lg-12 bg-white rounded shadow-sm mb-5">
            <div class="table-responsive">
              <table class="table" id="manageRetainersTable">
                <thead>
                  <tr>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Name</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Profession</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Status</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-left text-dark">Cost</div>
                    </th>
                    <th scope="col" class="border-0 bg-light">
                      <div class="py-2 text-uppercase text-center text-dark">Re-Employ / Fire</div>
                    </th>
                  </tr>
                </thead>
                <tbody id="retainerTableBody">
                  <!-- Javascript fills in the table here -->
                </tbody>
              </table>
            </div> <!-- End Table container -->
          </div> <!-- END column 1-->
      </div>  <!-- END row -->
      `
  
      $("#characterStatsModal").html(retainerHireFireTable)
  
      // this is the same as the jQuery loop below
      /*Object.keys(retainers).forEach(function (item) {
        retainter_name = retainers[item].name
        retainer_profession = retainers[item].profession
      })*/
  
      $.each(retainers, function(key, value) {
        let retainer_name = value.name
        let retainer_profession = value.profession
        let retainer_cost = value.cost
        value.employed = false
        let retainer_status = value.employed
        let retainer_id = 0
        var status = retainer_status ? retainer_status = "Retained" : retainer_status = "Not Retained"
        let retainerRow = `
          <tr>
          <td class="border-0 align-center text-left text-dark p-2 px-3">${retainer_name}</td>
          <td class="border-0 align-center text-left text-dark p-2 px-3">${retainer_profession}</td>
          <td id="${retainer_name}_status"class="border-0 align-center text-left text-dark p-2 px-3">${retainer_status}</td>
          <td id="${retainer_name}_cost"class="border-0 align-center text-left text-dark p-2 px-3">${retainer_cost}</td>
          <td class="border-0 align-center text-left text-dark p-2 px-3 justify"> 
            <div class="d-flex justify-content-center px-2">
            <button onclick="reEmploy(this)" data-id="${retainer_name}" type="button" class="re-employBtn btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Re-Employ
            </button>
            <button data-id="${retainer_name}" type="button" class="fireBtn btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Fire
            </button>
            </div>
          </td>
          </tr>
        `
        //console.log("Name: " + retainer_name + " Profession: " + retainer_profession);
        $("#manageRetainersTable").append(retainerRow)
      
      });
    
    
      // add possible new retainers
      
      if (availableRetainers.length > 0) {
        $.each(availableRetainers, function(key, value) {
          let retainer_name = value.name
          let retainer_profession = value.profession
          let retainer_cost = value.cost
          value.employed = false
          let retainer_status = value.employed
          let retainer_id = 0
          var status = retainer_status ? retainer_status = "Retained" : retainer_status = "Not Retained"
        let retainerRow = `
          <tr>
          <td class="border-0 align-center text-left text-dark p-2 px-3">${retainer_name}</td>
          <td class="border-0 align-center text-left text-dark p-2 px-3">${retainer_profession}</td>
          <td id="${retainer_name}_status" class="border-0 align-center text-left text-dark p-2 px-3">${retainer_status}</td>
          <td id="${retainer_name}_cost" class="border-0 align-center text-left text-dark p-2 px-3">${retainer_cost}</td>
          <td class="border-0 align-center text-left text-dark p-2 px-3 justify"> 
            <div class="d-flex justify-content-center px-2">
            <button onclick="hireNew(this)" data-id="${retainer_name}" type="button" class="re-employBtn btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Hire
            </button>
            </div>
          </td>
          </tr>
        `
        //console.log("Name: " + retainer_name + " Profession: " + retainer_profession);
        $("#manageRetainersTable").append(retainerRow)
      });
    }
  }
  
  function hireNew(button) {

    var id = $(button).attr('data-id');
    console.log("new retainer id: " + id)
    //alert("You clicked: " + id)
    let statusId = "#"+ id + "_status"
    console.log("new hire status id: '" + statusId + "'")

    let statusText = $(statusId).text()

    console.log("new hire status text: '" + statusText + "'")

    // if "not retained" then complete transaction, else do nothing
    //  To do: remove the hire button entirely if already hired

    if ( statusText == "Not Retained"   ) {
      console.log("not retained, so retain the guy")
      $(statusId).text("Retained")
      // get a handle on the correct object
      var obj = $.grep(availableRetainers, function(obj){return obj.name === id;})[0];


    if (playerCharacter.money < obj.cost) {
      alert("You don't have enough money.")
      console.log("player does not have enough money")
      return
    }

      console.log("obj name: " + obj.name)
      //console.log("obj is: " + obj)
      console.log("obj stringify is: " + JSON.stringify(obj))

      // set the object value to: true
      obj.employed = true

      //alert("the value of employed: " + obj.employed)
      // remove 10 silver from the character's money total
      let cost = obj.cost

      console.log("new retainer costs: " + obj.cost)

      playerCharacter.money -= obj.cost
      console.log("pc money is now: " + playerCharacter.money)

      $("#pcMoney").html(playerCharacter.money)
      // after hire, the retainer now costs 5 to keep
      obj.cost = 5

      // push new retainer to retainers obj
      retainers.push(obj)

      // update the nav bar which also updates the local storage objects
      updateNavbar()
    }
  }
  
  function reEmploy(button) { 
  //$(document).on('click', '.re-employBtn', function () {

    //var id = $(this).attr('data-id');
    var id = $(button).attr('data-id');
    console.log("id: " + id)
    //alert("You clicked: " + id)
    let statusId = "#"+ id + "_status"
    console.log("status id: " + statusId)

    let statusText = $(statusId).text()
    console.log("status text: '" + statusText + "'")

    if ( statusText == "Not Retained" ) {
      console.log("not retained, so retain the guy")
      $(statusId).text("Retained")
      // get a handle on the correct object
      var obj = $.grep(retainers, function(obj){return obj.name === id;})[0];
      console.log("obj name: " + obj.name)
      //console.log("obj is: " + obj)
      console.log("obj stringify is: " + JSON.stringify(obj))
      // set the object value to: true
      obj.employed = true
      //alert("the value of employed: " + obj.employed)
      // remove 5 silver from the character's money total
      let cost = obj.cost
      console.log("npc cost: " + cost)
      playerCharacter.money -= obj.cost
      $("#pcMoney").html(playerCharacter.money)
      updateNavbar()
    }
  }
  
  $(document).on('click', '.fireBtn', function () {
    var id = $(this).attr('data-id');
    // make this a choice.  "Are you sure..."
    if (confirm("Are you sure you want to fire " + id + " ?")) {
      txt = "You pressed OK!";
      let statusId = "#"+ id + "_status"
      $(statusId).text("Fired")
      // get a handle on the correct object
      var obj = $.grep(retainers, function(obj){return obj.name === id;})[0];
      // set the object value to: false
      obj.employed = false
      
      // remove the object from the array
      retainers = $.grep(retainers, function(e){ 
           return e.name != id; 
      });
      // next we have to refresh the screen
      createTable()
      
      //=alert("the value of employed: " + obj.employed)
    } else {
      txt = "You pressed Cancel!";
    }
    
  })
    
    
    // -----------------------------------------------------
    // Retainers
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // Inventory
    // -----------------------------------------------------
    
    let inventory = [
      {
        id: 0,
        name: "Longsword",
        type: "Weapon",
        ranged: false,
        readied: true,
        cost: 6,
        damage_bonus: 2
      },
      {
        id: 1,
        name: "Short sword",
        type: "Weapon",
        ranged: false,
        readied: false,
        cost: 5,
        damage_bonus: 1
      },
      {
        id: 2,
        name: "Leather Jerkin",
        type: "Armor",
        ranged: false,
        readied: true,
        cost: 5,
        damage_bonus: 0
      },
      {
        id: 3,
        name: "Padded Armor",
        type: "Armor",
        ranged: false,
        readied: true,
        cost: 4,
        damage_bonus: 0
      }
    ]
    
    function showInventory() {
      $("#modalTitle").html("Inventory")
      let inventoryTable = `
        <div class='row'>
      	<div class="col-lg-12 bg-white rounded shadow-sm mb-5">
          <div class="table-responsive">
          <table class="table" id="equipmentTable">
            <thead>
            <tr>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-left">Name</div>
                </th>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-left">Type</div>
                </th>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-left">Cost</div>
                </th>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-left">Sale Price</div>
                </th>
            <th scope="col" class="border-0 bg-light">
            <div class="py-2 text-uppercase text-center">Sell Item</div>
            </th>
            </tr>
            </thead>
          	<tbody id="inventoryTableBody">
          <!-- Javascript fills in the table here -->
              </tbody>
              </table>
              </div> <!-- End Table container -->
        </div> <!-- END column 1-->
      </div>  <!-- END row -->
      `
      $("#characterStatsModal").html(inventoryTable)
 
      // this is the same as the jQuery loop below
      /*Object.keys(retainers).forEach(function (item) {
        retainter_name = retainers[item].name
        retainer_profession = retainers[item].profession
      })*/
  
      $.each(inventory, function(key, value) {
        let item_id = value.id
        let item_name = value.name
        let item_type = value.type
        let item_cost = value.cost
        let divisor = 2
        let res = (item_cost % divisor)
        let item_salePrice = (item_cost - res) / divisor
    
    
        let inventoryRow = `
          <tr>
          <td id="name_${item_id}" class="border-0 align-center text-left p-2 px-3"> ${item_name}</td>
          <td class="border-0 align-center text-left p-2 px-3"> ${item_type}</td>
          <td class="border-0 align-center text-left p-2 px-3"> ${item_cost}</td>
          <td id="salePrice_${item_id}" class="border-0 align-center text-left p-2 px-3"> ${item_salePrice}</td>
          <td class="border-0 align-center text-left p-2 px-3 justify"> 
            <div class="d-flex justify-content-center px-2">
            <button data-id="${item_id}" type="button" class="sellBtn btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Sell
            </button>
            </div>
          </td>
          </tr>
        `
    
      //console.log("Name: " + retainer_name + " Profession: " + retainer_profession);
      $("#inventoryTableBody").append(inventoryRow)
    });
    
    }
    
    
    // -----------------------------------------------------
    // Inventory
    // -----------------------------------------------------
    
    // -----------------------------------------------------
    // Combat
    // -----------------------------------------------------
    
    
    // Constructor function for NPC objects
    function NPC(name, level, cur_hp, max_hp, armor, attack, att_mod, dmg_mod, wpn1, wpn2, armorType, sex, isAlive, morale, treasureRolls, sideQuest) {
      this.name = name;
      this.level = 4 + playerCharacter.rebellionLevel;
      this.cur_hp = cur_hp + (playerCharacter.rebellionLevel * 2);
      this.max_hp = max_hp + (playerCharacter.rebellionLevel * 2);
      this.armor = armor + (playerCharacter.rebellionLevelMod);
      this.attack = attack;
      this.att_mod = att_mod
      this.dmg_mod = dmg_mod
      this.wpn1 = wpn1;
      this.wpn2 = wpn2;
      this.armorType = armorType;
      this.sex = sex;
      this.isAlive = isAlive;
      this.morale = morale;
      this.treasureRolls = treasureRolls;
      this.sideQuest = sideQuest;
    }

    // more global variables:
    var round = 1
    var initiative = "pc"
    let aKnight
  

    function knightChallenge() {
      
      round = 1
      // Create a knight object
      //alert("a challenge from: " + name)
      aKnight = new NPC(challengerName, 0, 25, 25, 0, 6, 0, 2, "Longsword", "", "Chainmail", "male", "true", 0, 0, false);
      
      console.log("knight name: " + aKnight.name)
      combat()
      
    }
    
    function theWhiteKnight() {
      aKnight = new NPC("The White Knight", 0, 25, 25, 1, 6, 0, 2, "Longsword", "", "Chainmail", "male", "true", 0, 0, false);
      round = 1
      console.log("knight name: " + aKnight.name)
      combat()
    }
    
function createNPCSidebar() {
  let minionPortraitText = `
        <h4 id="npcDivName">${aKnight.name}</h4>
          <hr>
          Level: <span id="npcLevel">${aKnight.level}</span><br>
          <span>HP: </span>
          <span id="npcDivCurHP" class="bg-success rounded px-1 pb-1 mr-1">999 </span>
          <span> of </span>
          <span id="npcDivMaxHP">999</span>
          <br>
          Attack: <span id="npcDivAttack">999</span>+<br>
          Damage Modifier: <span id="npcDivDmgMod">999</span><br>
          Armor: <span id="npcDivArmor">999</span><br>
          Morale: <span id="npcDivMorale">999</span><br><br>
          <h4>Equipment</h4>
          <hr>
          <span id="npcDivWeapon1">Longsword</span><br>
          <span id="npcDivWeapon2"></span><br>
          <span id="npcDivArmorType">Padded Gambeson</span><br>
      
      `
      $("#npcPortrait").html(minionPortraitText)
}
    
    function updateNPC() {
      $("#npcDivName").html(aKnight.name)
      $("#npcLevel").html(aKnight.level)
      $("#npcDivCurHP").html(aKnight.cur_hp)
      $("#npcDivMaxHP").html(aKnight.max_hp)
      $("#npcDivAttack").html(aKnight.attack)
      $("#npcDivDmgMod").html(aKnight.dmg_mod)
      $("#npcDivArmor").html(aKnight.armor)
      $("#npcDivMorale").html(aKnight.morale)
      $("#npcDivWeapon1").html(aKnight.wpn1)
      $("#npcDivWeapon2").html(aKnight.wpn2)
      $("#npcDivArmorType").html(aKnight.armorType)

      // set color for HP
      // first unset all colors
      $("#npcDivCurHP").removeClass(["bg-success", "bg-warning", "bg-danger", "bg-secondary"]);
      let a = Math.floor(aKnight.max_hp / 3);
      let firstThird = (aKnight.max_hp - a)
      let secondThird = (aKnight.max_hp - (a * 2))

      if (aKnight.cur_hp >= firstThird) {
        $("#npcDivCurHP").addClass("bg-success")
      } else if (aKnight.cur_hp < firstThird && aKnight.cur_hp >= secondThird) {
        $("#npcDivCurHP").addClass("bg-warning")
      } else if (aKnight.cur_hp > 0 && aKnight.cur_hp < secondThird) {
        $("#npcDivCurHP").addClass("bg-danger")
      } else {
        $("#npcDivCurHP").addClass("bg-secondary")
      }
    }
    
    function combat() {
      $('#npcCollapse').toggle(true)
      // update the NPC side menu
      createNPCSidebar()
      updateNPC()
      
      console.log("combat function round: " + round)
      console.log("Knight: " + aKnight.name)
      $("#gameTableText").empty()
      $("#gameTableText").append("<p id='npcParagraph'>Your Opponent is: <strong>" + aKnight.name + "!!!</strong></p>")

      let initiativeTarget = 4
      if (aKnight.name == "The White Knight" || aKnight.name == "The Black Knight" || aKnight.name == "The Red Knight") {
        initiativeTarget = 3
      } else {
        initiativeTarget = 4
      }
      if (round == 1) {
        
        let roll_1d6 = rollDie(6);
        // if die roll > initiativeTarget (3 by default) the PC has the initiative
        if (roll_1d6 >= initiativeTarget) {
          initiative = "pc"
          $("#gameTableText").append("<p id='storyDivHead'>You have won initiative.  Attack, flee... or talk.</p>")
        } else {
          initiative = "npc"
          $("#gameTableText").append("<p id='storyDivHead'>" + aKnight.name + " won initiative and has attacked first!</p>")
        }
      }
      //console.log("made it here")


      let rowString = 
        `<div id="combatCommandButtons" class="d-flex my-3 justify-content-around">
          <button onclick="fightKnight()" id="attackBtn2" class="attackBtn btn btn-dark px-4 rounded-pill">Attack!</button>
          <button onclick="flee(aKnight)" id="fleeBtn2"class="innBtn btn btn-dark px-4 rounded-pill">Flee!</button>
          <button onclick="parlay(aKnight)" id="parlayBtn2"class="innBtn btn btn-dark px-4 rounded-pill">Parlay!</button>
        </div>`
      $("#gameButtons").html(rowString)

      // Add a table to log combat
      rowString =
          `<div class="table-responsive">
            <table class="table-condensed" id="combatTable">
              <thead>
                <tr>
                  <th scope="col" class="border-0 bg-light">
                    <div class="p-1 px-3 text-uppercase textBlack">Round</div>
                  </th>
                  <th scope="col" class="border-0 bg-light">
                    <div class="p-1 px-3 text-uppercase textBlack">Result</div>
                  </th>
                </tr>
              </thead>
              <tbody id="combatTableBody">
                <!-- Javascript fills in the table here -->
              </tbody>
            </table>
          </div> <!-- End Table container -->`
        $("#gameTableText").append(rowString)
      if (round == 1 && initiative == "npc") {
        // npc attacks first
        console.log("npc has the initiative")
        npcAttack(round)
      }
    }


    function fightKnight() {
      if (round > 1) {
      	if (initiative == "npc") {
          $("#storyDivHead").html('<p>Initiative: ' + aKnight.name + '</p>')
        } else {
          $("#storyDivHead").html('<p>Initiative: ' + playerCharacter.name + '</p>')
        }
      }
        
      console.log("attack button2 clicked")
      console.log("round: " + round)
      console.log("initiative: " + initiative)
      if (initiative == "pc") {
        $("#combatTableBody").empty()
        playerAttack(round, aKnight)
        npcAttack(round, aKnight)
      }
      if (initiative == "npc" && round == 1) {
        playerAttack(round, aKnight)
      }
      if (initiative == "npc" && round > 1) {
        $("#combatTableBody").empty()
        npcAttack(round, aKnight)
        playerAttack(round, aKnight)
      } 
      round++
      
    }

    
    function playerAttack(round) {
      let knightName = aKnight.name
      // roll to hit
      let first_d6Roll = Math.floor(Math.random() * 6) + 1;
      let second_d6Roll = Math.floor(Math.random() * 6) + 1;
      let twoD6 = first_d6Roll + second_d6Roll
      if (twoD6 >= playerCharacter.attack - playerCharacter.att_mod) {
        // a hit!  now calc dmg
        console.log("PC rolled a hit!")
        let dmg = twoD6 - playerCharacter.attack
        dmg += playerCharacter.dmg_mod
        if (dmg <= aKnight.armor) {
          // saved by armor!
          console.log("hit but made armor save")
          rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
          rowString += `<td class="border-0 defaultText"> You hit ${knightName} for 0 damage!</td></tr>`
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-left"> You hit ' + npc_name + " 0 damage!</td></tr>")
          $("#combatTableBody").append(rowString)
        } else {
          // npc takes damage
          dmg = dmg - aKnight.armor
          aKnight.cur_hp = aKnight.cur_hp - dmg
          console.log("you hit for " + dmg + " points of damage")
          rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
          rowString += `<td class="border-0 defaultText">You hit ${knightName} for <span class="rounded" style="padding: 2px; background-color: red">${dmg}</span> points of damage!`
          //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
          //$("#combatTableBody").append('<td class="border-0 text-left">You hit ' + npc_name + " for " + dmg + " points of damage!</td></tr>")
          $("#combatTableBody").append(rowString)
          updateNPC()
          
          // Todo: check to see if the knight surrenders if below 50% health
          
          if (aKnight.cur_hp < 1) {
            round = 0
            // To do: npc is dead - remove him from the list of available evil captains

            aKnight.isAlive = false
            playerCharacter.captainsSlain++
            updateNavbar()

            $("#gameTableText").append("<p>You have slain " + knightName + "!</p>")
            // get treasure and remove unique opponents from their respective tables.

            console.log("sideQuest: " + aKnight.sideQuest)

            if (aKnight.sideQuest) {
              console.log("get sideQuest treasure")
              $("#gameTableText").append("<br>You find: <br>")
              for (let i = 0; i < aKnight.treasureRolls; i++) {
                let treasureText = rollTreasure(0)
                $("#gameTableText").append(treasureText + "<br>")
              }

              // remove them from the sideQuest array
              sideQuests = $.grep(sideQuests, function(value){ 
                return value != aKnight.name; 
              });
              playerCharacter.sideQuests++
              updateNavbar()


            } else {
              console.log("get knight treasure")
              knightTreasure()
            }
            
            // gain exp
            let levelUp = false
            levelUp = xpRoll()

            if (levelUp) {
              console.log("player leveled up")
              $("gameTableText").append(`<br>${playerCharacter.name} has gained a level!`)
            } else {
              console.log("pc did not level up")
            }

            rowString = `
              <div class="d-flex mt-2">
              <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Journey On
              </button>
              </div>`
            
            $("#gameButtons").html(rowString)
          }
        }
      } else {
        console.log("You attacked but missed!")
        rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
        rowString += `<td class="border-0 defaultText">You attacked ${knightName} but missed!</td></tr>`
        //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
        //$("#combatTableBody").append('<td class="border-0 text-left">You attacked ' + npc_name + " but missed!</td></tr>")
        $("#combatTableBody").append(rowString)
      }
    }
    
    function npcAttack(round) {
      let knightName = aKnight.name
      let rowString = ""
      // npc attacks first
      // if the PC is not dead the the PC can act
      let first_d6Roll = rollDie(6)
      let second_d6Roll = rollDie(6)
      let twoD6 = first_d6Roll + second_d6Roll

      if (twoD6 => aKnight.attack) {
        // a hit!  now calc dmg
        console.log("npc rolled a hit")
        let dmg = twoD6 - aKnight.attack
        dmg += aKnight.dmg_mod
        if (dmg <= playerCharacter.armor) {
          // saved by armor!
          console.log("hit but made armor save")
          rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
          rowString += `<td class="border-0 text-left defaultText">${knightName} hits you for 0 damage!</td></tr>`
          $("#combatTableBody").append(rowString)

        } else {
          // pc takes damage
          dmg = dmg - playerCharacter.armor
          playerCharacter.cur_hp = playerCharacter.cur_hp - dmg
          console.log("you were hit for " + dmg + " point(s) of damage")
          rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
          rowString += `<td class="border-0 text-left defaultText">${knightName} hits you for <span class="rounded" style="padding: 2px; background-color: red">${dmg}</span> points of damage!</td></tr>`
          $("#combatTableBody").append(rowString)
          
          // check to see if the pc is alive, knocked out or dead
          if (playerCharacter.cur_hp < 6 && playerCharacter.cur_hp > 0) {
            // PC is knocked out
            round = 0
            console.log("PC is alive but knocked out")
            $("#storyDivHead").empty()
            $("#npcParagraph").empty()
            $("#gameTableText").append('<p>' + playerCharacter.name + ' has been knocked out by ' + aKnight.name + '!  You had best start praying for mercy!</p>')
            

            let roll = rollDie(6)
            if (roll > 3) {
              $("#gameTableText").append(`${aKnight.name} leaves you for dead... but you survive!`)
              $('#npcCollapse').toggle(false)

              // PC lives to fight another day and wakes up at an inn
              btnString = `
                <div class="d-flex mt-2 justify-content-around">
                <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                  <i class="mt-2"></i>
                  Go to Inn
                </button>
                </div>`
                $("#gameButtons").html(btnString)


            } else {
              $("#gameTableText").append(`${aKnight.name} wickedly delivers you a coup de grace.  May God have mercy on your soul.  <br><br>REQVIESCAT IN PACE`)
              // empty the combatCommandButtons and then replace them with a single button to go to the start
              $("#gameButtons").empty()
            
              let rowString = `
                <div class="d-flex mt-2">
                <button onclick="startNewGame()" data-id="startNewGameBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                  <i class="mt-2"></i>
                  Start New Game
                </button>
                </div>`
              $("#gameButtons").html(rowString)


            }


            
          }
          if (playerCharacter.cur_hp < 1) {
            round = 0
            // pc is dead!
            console.log("PC has died")
            $("#storyDivHead").empty()
            $("#npcParagraph").empty()
            $("#storyDivHead").html('<p>' + playerCharacter.name + ' has been slain by ' + aKnight.name + '!<br>  May God have mercy on your soul!  <br><br>REQVIESCAT IN PACE</p>')
            
            rowString = `
              <div class="d-flex mt-2">
              <button onclick="startNewGame()" data-id="startNewGameBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                <i class="mt-2"></i>
                Start New Game
              </button>
              </div>`
            $("#gameButtons").html(rowString)
            
          }
          updateNavbar()
        }
      } else {
        console.log("your opponent missed!")
        let rowString = `<tr><td class="border-0 text-center defaultText">${round}</td>`
        rowString += `<td class="border-0 text-left defaultText">${knightName} attacked but missed!</td></tr>`
        $("#combatTableBody").append(rowString)
        //$("#combatTableBody").append('<tr><td class="border-0 text-center">' + round + '</td>')
        //$("#combatTableBody").append('<td class="border-0 text-left">' + npc_name + " attacked but missed!</td></tr>")
      }
    }
    
    function flee() {
      console.log("flee function")
      round = 0
      $("#gameTableText").empty()
      $("#gameTableText").append("<p>" + aKnight.name + " laughs at you as you flee like a coward!</p>")
      $("#gameTableText").append("<p>If you're not too chicken, click the button below to continue your journey.  Maybe you'll find something you can handle... like a rabbit.</p>")
      let rowString = `
          <div class="d-flex mt-2">
            <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
          </div>`
        $("#gameButtons").html(rowString)
        $("#beginAdventure").off('click')
    }
    
    function parlay() {
      console.log("parlay function")
      let roll_1d6 = Math.floor(Math.random() * 6) + 1;
      
      if (roll_1d6 < 4) {
        let pronoun = (aKnight.sex == "male") ? "He" : "She"
        
        console.log(aKnight.name + " is: " + aKnight.sex)
        
        $("#gameTableText").empty()
        $("#gameTableText").append("<p>" + aKnight.name + " is not interested in conversation. "+ pronoun + " attacks!</p>")
        
        rowString = `
          <div class="d-flex mt-2">
          <button onclick="combat()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Back to Combat
          </button>
          </div>`
           
          $("#gameButtons").html(rowString)
            
      } else {
        peace = true
        round = 0
        $("#gameTableText").empty()
        $("#gameTableText").append("<p>" + aKnight.name + " agrees to live and let live... for now.</p>")
        let rowString = `
          <div class="d-flex mt-2">
            <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
          </div>`
        $("#gameButtons").html(rowString)
        
        $("#beginAdventure").off('click')
        /*
        $("#beginAdventure").click(function () {
          $("#gameTableText").empty()
          //$("#storyDiv").append("<p>Your Opponent is: </p>")
          startGame()
        })*/
      }
    }
    
    
    
    function knightTreasure() {
      let knightName = aKnight.name
      let roll1 = 0
      let roll2 = 0
      let money = 0
      
      if (knightName == "Sir Agravain") {
        roll1 = rollDie(6)
        roll2 = rollDie(6)
        money = (roll1 + roll2) * 7
        $("#gameTableText").append("You gain: " + money + " silver")
        //playerCharacter.money += money
      } else if (knightName == "Sir Garlon") {
        roll1 = rollDie(6)
        roll2 = rollDie(6)
        money = (roll1 + roll2) * 7
        $("#gameTableText").append("You gain: " + money + " silver")
      } else if (knightName == "Sir Turquine") {
        roll1 = rollDie(6)
        roll2 = rollDie(6)
        money = (roll1 + roll2) * 8
        $("#gameTableText").append("You gain: " + money + " silver")
      } else if (knightName == "Sir Mordred") {
        roll1 = rollDie(6)
        roll2 = rollDie(6)
        money = (roll1 + roll2) * 8
        $("#gameTableText").append("You gain: " + money + " silver")
      } else {
        roll1 = rollDie(6)
        roll2 = rollDie(6)
        money = (roll1 + roll2) * aKnight.level
        $("#gameTableText").append("You gain: " + money + " silver")
      }
      
      playerCharacter.money += money
      updateNavbar()  
        
    }
    
    
    
    
    // -----------------------------------------------------
    // End Combat
    // -----------------------------------------------------
    
    
    
    // -----------------------------------------------------
    // minion combat - multiple combatants per side
    // -----------------------------------------------------
    
    // Constructor for minions
    function Minion(name, numStart, numCur, level, armor, attack, att_mod, dmg_mod, treasureRolls, moraleMod, description) {
      this.name = name;
      this.numStart = numStart;
      this.numCur = numCur;
      this.level = level;
      this.armor = armor;
      this.attack = attack;
      this.att_mod = att_mod;
      this.dmg_mod = dmg_mod;
      this.treasureRolls = treasureRolls;
      this.moraleMod = moraleMod;
      this.description = description
    }
    
    let minions = {}
    let numMinions = 0
    let minionType = ""
    
    function waitAndSee() {
      if (minionType == "fairyFire") {
        fairyFire()
      } else {
      
      }
      // check minion reaction
    }
    
    function fairyFire() {
      $("#gameTableText").html("You've encountered a Will-o'-the-Wisp.  It attempts to drain your life as it draws you into it.  You can't kill it. Your only hope is to resist it.<br>")
      // save vs 5
      // add piety to the paladin's roll
      // failed roll does d6+1 damage
      // continue until a save is passed
      let paladinSave = false
      let retainerSave = false
      let allSaved = false
      let saveMod = 0
      let numPlayerFailedSaves = 0
      
      let pcGroup = []
      
      let character = {
        id: -1,
        name: playerCharacter.name,
        cur_hp: playerCharacter.cur_hp,
        isAlive: playerCharacter.alive,
        saved: false
      }
      pcGroup.push(character)
      for (let i = 0; i < retainers.length; i++) {
        character = {
          id: retainers[i].id,
          name: retainers[i].name,
          cur_hp: retainers[i].cur_hp,
          isAlive: retainers[i].alive,
          saved: false
        }
        pcGroup.push(character)
      }
    
      let continueAttack = true
      let numSaved = 0
      let numDead = 0
      let totalNum = pcGroup.length
      //let saveMod = 0
      let counter = 0
      while(continueAttack) {
        counter++
        // loop through the pc group array
        for (let i = 0; i < pcGroup.length; i++) {
          console.log("Name: " + pcGroup[i].name + " is alive: " + pcGroup[i].isAlive + " saved: " + pcGroup[i].saved)
          if (!pcGroup[i].saved && pcGroup[i].isAlive) {
            // if not saved, and is alive roll a save
            let roll = rollDie(6)
            console.log("Name: " + pcGroup[i].name + " rolled a: " + roll)


            // pc adds his piety level to the roll
            if (pcGroup[i].id == -1) {
              console.log("PC piety: " + playerCharacter.piety)
              roll += playerCharacter.piety
              console.log("Player adds piety to the roll for total roll of: " + roll)
            }

            if (roll + saveMod >= 5) {
              // saved!
              pcGroup[i].saved = true;
              console.log("saved!")
              saveMod++
              numSaved++
            } else {
              let damage = rollDie(6)+1
              pcGroup[i].cur_hp -= damage
              console.log("damage: " + damage)
              console.log("PC: " + pcGroup[i].name + " currently has: " + pcGroup[i].cur_hp + " HP")
              if (pcGroup[i].cur_hp < 1) {
                console.log(pcGroup[i].name + " has died")
                pcGroup[i].isAlive = false
                numDead++
              }
            }  
          }
        }
        
        console.log("[" + counter + "] ------------------------------")
        if (numSaved == pcGroup.length) continueAttack = false
        if (numDead == pcGroup.length) continueAttack = false
        if (numSaved + numDead == pcGroup.length) continueAttack = false
        // this is here to keep us out of an infinite loop
        if (counter > 500) {
          continueAttack = false
          alert("Counter exceeded 500.  Either really bad luck or we got into an infinite loop.")
        }
      }
      let myString = ""
      for (let i = 0; i < pcGroup.length; i++) {
        let deadOrAlive = (pcGroup[i].isAlive) ? "alive" : "dead"
        
        myString += pcGroup[i].name + " hit points: " + pcGroup[i].cur_hp + " is: " + deadOrAlive + "<br>"
        if (i == 0) {
          playerCharacter.cur_hp = pcGroup[i].cur_hp
          playerCharacter.isAlive = pcGroup[i].isAlive
          updateNavbar()
        }
      }
      $("#gameTableText").append(myString + "<br>")
      console.log(myString)
      if (!pcGroup[0].isAlive) {
        console.log("Player Character is dead.  Have to start over now.")
        $("#gameTableText").append("Unfortunately, the Will-o'-Wisp has killed your character.  Click below to start a new game.<br>")
        let rowString = `
        <div class="d-flex mt-2 justify-content-around">
          <button onclick="startNewGame()" data-id="startGameBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
          <i class="mt-2"></i>
          Start Over
        </button>`
        $("#gameButtons").html(rowString)
      } else {
        // the PC is alive so roll treasure:
        let treasureText = rollTreasure(0)
        treasureText = rollTreasure(0)
        $("#gameTableText").append("<br>You have defeated the Will-o'-the-Wisp and find: " + treasureText)


        let rowString = `
          <div class="d-flex mt-2">
            <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
          </div>`
        $("#gameButtons").html(rowString)


      }
      
    }
    function createMinionSidebar() {
      
      let minionPortraitText = `
        <h5 id="minionName">${minions.name}</h5>
          <hr>
          Level: <span id="minionLevel">${minions.level}</span><br>
          <span>Number: </span>
          <span id="minionCurNum" class="bg-success rounded px-1 pb-1 mr-1">${minions.numCur} </span>
          <span> of </span>
          <span id="minionMaxNum">${minions.numStart}</span>
          <br>
          Attack: <span id="minionAttack">${minions.attack}</span>+<br>
          Damage Modifier: <span id="minionDmgMod">${minions.dmg_mod}</span><br>
          Armor: <span id="minionArmor">${minions.armor}</span><br>
          Morale: <span id="minionMorale">${minions.moraleMod}</span><br>
          Treasure: <span id="minionTreasure">${minions.treasureRolls}</span><br><br>
          <h5>Equipment</h5>
          <hr>
          <span id="minionWeapon1">Hand Weapon</span><br>
          <span id="minionArmorType">Various</span><br>
          <hr>
          <h5>Notes</h5>
          <span id="minionNotes">${minions.description}</span>
      
      `
      if (minions.name == "hellhounds" || minions.name == "hellhound") {
        $("#minionTreasure").html("none")
        $("#minionWeapon1").html("Sharp teeth")
        $("#minionArmorType").html("tough hide")
        $("#minionNotes").append("Retainers must save vs level 4 or flee in terror. Reactions: fight to the death")
      }
      $("#npcPortrait").html(minionPortraitText)
    }
    
    function updateMinion() {
      $("#minionCurNum").html(minions.numCur)
      // set colors for numbers
      // first unset all colors
      $("#minionCurNum").removeClass(["bg-success", "bg-warning", "bg-danger", "bg-secondary"]);
      let a = Math.floor(minions.numStart / 3);
      let firstThird = (minions.numStart - a)
      let secondThird = (minions.numStart - (a * 2))
      //console.log("a: " + a)
      //console.log("firstThird: " + firstThird)
      //console.log("secondThird: " + secondThird)
      if (minions.numCur >= firstThird) {
        $("#minionCurNum").addClass("bg-success")
      } else if (minions.numCur < firstThird && minions.numCur >= secondThird) {
        $("#minionCurNum").addClass("bg-warning")
      } else if (minions.numCur > 0 && minions.numCur < secondThird) {
        $("#minionCurNum").addClass("bg-danger")
      } else {
        $("#minionCurNum").addClass("bg-secondary")
      }
    }
    
    function fightMinions() {
      round = 1
      let rowString = ""
      createMinionSidebar()
      $('#npcCollapse').toggle(true)
      //updateMinion(minions)
      console.log("minion combat round: " + round)
      console.log("minion: " + minions.name)
      
      let initiativeTarget = 4
      
      if (initiative == "pc") {
        // some minions attempt to steal the initiative
        if (minions.name == "outlaws" || minions.name == "bugbear") {
          let roll = rollDie(6)
          if (woodsman > 0) {
            if (roll < 3) {
              initiative = "npc"
              $("#gameTableText").append(minions.name + " have stolen the initiative and attacked by surprise!")
              console.log("npc stole the initiative")
            } else {
              initiative = "pc"
            }
          } else {
            if (roll < 5) {
              initiative = "npc"
              $("#gameTableText").append(minions.name + " have stolen the initiative and attacked by surprise!")
              console.log("npc stole the initiative")
            } else {
              initiative = "pc"
            }
          }
        }
        if (minions.name == "wolves" || minions.name == "cultists") {
          let roll = rollDie(6)
          if (woodsman > 0) {
            if (roll < 2) {
              initiative = "npc"
              $("#gameTableText").append(minions.name + " have stolen the initiative and attacked by surprise!")
              console.log("npc stole the initiative")
            } else {
              initiative = "pc"
            }
          } else {
            if (roll < 4) {
              initiative = "npc"
              $("#gameTableText").append(minions.name + " have stolen the initiative and attacked by surprise!")
              console.log("npc stole the initiative")
            } else {
              initiative = "pc"
            }
          }
        }
      }
      
      if (round == 1) {
        //$("#gameTableText").()
        $("#gameTableText").html("<p id='npcParagraph'>Your Opponent: <strong>" + minions.numCur + " " + minions.name + "!!!</strong></p>")
      } else {
        //$("#gameTableText").html("<p id='npcParagraph'>Your Opponent: <strong>" + minions.name + "!!!</strong></p>")
      }
      // Add a table to log combat
      rowString = `
        <div class="table-responsive">
          <table class="table-condensed" id="combatTable">
            <thead>
            <tr>
            <th scope="col" class="border-0 bg-light">
              <div class="p-1 px-3 text-uppercase textBlack">Round: <span id="combatRound">${round}</span></div>
            </th>
            </tr>
           </thead>
           <tbody id="combatTableBody">
           <!-- Javascript fills in the table here -->
           </tbody>
          </table>
        </div> <!-- End Table container -->`
      $("#gameTableText").append(rowString)
      
      if (initiative == "npc" && round == 1) {
        minionsAttack(round)
      }

      // place the buttons

      rowString = `
        <div id="combatCommandButtons" class="d-flex my-3 justify-content-around">
          <button onclick="attackMinions()" id="attackBtn3" class="attackBtn btn btn-dark px-4 rounded-pill">Attack!</button>
          <button onclick="flee()" id="fleeBtn3"class="innBtn btn btn-dark px-4 rounded-pill">Flee!</button>
        </div>`
      $("#gameButtons").html(rowString)
        
    }
    function attackMinions() {
      // determine the order of combat
      console.log("initiative: " + initiative)
      if (initiative == "pc") {
        $("#combatTableBody").empty()
          playerAttackMinions(round)
          minionsAttack(round)
      } 
      
      if (initiative == "npc" && round == 1) {
        playerAttackMinions(round)
      }
      
      if (initiative == "npc" && round > 1) {
        $("#combatTableBody").empty()
        minionsAttack(round)
        playerAttackMinions(round)
      } 
      $("#combatRound").html(`${round}`)
      round++
      
    }
    function playerAttackMinions(round) {
      // If pc is alive, attack the minions.
      // After the PC is done, loop through the retainers array
      //   If retainer is alive, attack the remaining minions
      
      // get attack values and attack the minions
      // each hit (>=0) causes a kill.  It is possible to kill multiple low level minions in a single shot.
      // for example:
      // Fred the Paladin is fighting 6 angry peasants (level 2)
      // He needs a 4 to hit.  (6 is normal but Fred has an attack bonus of +2) to hit and rolls an 8 on 2d6
      // add damage modifiers (+2) for a total of 10
      // 10 - target number of 4 = 6
      // divide 6 by the minion level = 3
      // Fred has dispatched 3 minions in one attack!
      
      let rowString = ""
      console.log("------------------------------")
      console.log("Round: " + round)
      
      console.log("Player Attacks")
      console.log("player is alive: " + playerCharacter.alive)
      
      if (playerCharacter.status == "alive") {
        let roll1 = rollDie(6)
        let roll2 = rollDie(6)
        let twoD6 = roll1 + roll2
        let damage = 0
        
        console.log("PC rolls 2d6: " + roll1 + " + " + roll2 + " = " + twoD6)
        
        // The difference in level adjusts the "to hit" value.
        let pcLevel = playerCharacter.level
        let minionLevel = minions.level
        console.log("player character level: " + playerCharacter.level)
        console.log("minion level: " + minions.level)
        let attackMod = playerCharacter.level - minions.level
        console.log(playerCharacter.name + " attack mod is: " + attackMod)
        
        let total = (twoD6 + attackMod)
        console.log("total (2d6 + attack modifier): " + total)
        
        // "target" should default to: 6
        let target = playerCharacter.attack
        console.log("target number: " + target)
        
        if (total < target) {
          console.log("PC missed!")
          rowString = `<tr><td class="border-0 defaultText text-left"> ${playerCharacter.name} missed!</td></tr>`
          $("#combatTableBody").append(rowString)
        } else if (total == target) {
          rowString = `<tr><td class="border-0 defaultText text-left"> ${playerCharacter.name} killed 1</td></tr>`
          $("#combatTableBody").append(rowString)
          console.log("hit but 0 damage.  This still kills one minion")
          minions.numCur --
          
          $("#npcParagraph").html("Your Opponent: <strong>" + minions.numCur + " " + minions.name + "!!!</strong>")
          
          
          console.log("num of minions is now: " + minions.numCur)
          updateMinion()
        } else {
          damage = (total - target) + playerCharacter.dmg_mod
          console.log("damage: " + damage)
          // now check the level difference to see how many minions are killed
          let num = Math.floor(damage / minions.level)
          console.log("num killed: " + num)
          if (num > 0) {
            if (num > minions.numCur) {
              num = minions.numCur
            }
            minions.numCur -= num
            console.log("num of minions is now: " + minions.numCur)
            rowString = `<tr><td class="border-0 defaultText text-left"> ${playerCharacter.name} killed ${num}</td></tr>`
            $("#combatTableBody").append(rowString)
            
            
            $("#npcParagraph").html("Your Opponent: <strong>" + minions.numCur + " " + minions.name + "!!!</strong>")
            
            
            updateMinion()
          } else {
            minions.numCur --
            console.log("num of minions is now: " + minions.numCur)
            rowString = `<tr><td class="border-0 defaultText text-left"> ${playerCharacter.name} killed 1</td></tr>`
            $("#combatTableBody").append(rowString)
            
            
            $("#npcParagraph").html("Your Opponent: <strong>" + minions.numCur + " " + minions.name + "!!!</strong>")
            
            
            updateMinion()
          }
        }
      }
      
      if (minions.numCur < 1) {
        console.log("no more minions")
        $("#npcParagraph").html("You have defeated: <strong>" + minions.numStart + " " + minions.name + "!!!</strong>")
        console.log("PC get treasure")

        playerCharacter.status = "alive"

        let treasureText = rollTreasure(0)
        $("#gameTableText").append("<br>You find: " + treasureText)
        let rowString = `
          <div class="d-flex mt-2">
            <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
            <i class="mt-2"></i>
            Journey On
          </button>
          </div>`
        $("#gameButtons").html(rowString)
        return
      }
      
      // now loop through the retainers
      retainers.forEach(function(key, value) {
        if (minions.numCur < 1) {
          console.log("at start of retainer loop there are no more minions")
          $("#npcParagraph").html("You have defeated: <strong>" + minions.numStart + " " + minions.name + "!!!</strong>")
          console.log("should have gotten treasure already")
          let rowString = `
            <div class="d-flex mt-2">
              <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Journey On
            </button>
            </div>`
          $("#gameButtons").html(rowString)
          return
        }
        let retainer_name = key.name
        let retainer_profession = key.profession
        let retainer_level = key.level
        let retainer_attack = key.attack
        let retainer_dmg_bonus = key.damage_bonus
        console.log("Retainer: " + retainer_name)
        
        if (key.alive) {
          let roll1 = rollDie(6)
          let roll2 = rollDie(6)
          let twoD6 = roll1 + roll2
          let damage = 0
          console.log(retainer_name + " rolls 2d6: " + roll1 + " + " + roll2 + " = " + twoD6)
          // The difference in level adjusts the "to hit" value.
          let attackMod = retainer_level - minions.level
          console.log(retainer_name + " attack mod is: " + attackMod)
          let total = (twoD6 + attackMod)
          console.log("total: " + total)
          // "target" should default to: 6
          let target = retainer_attack
          console.log("target number: " + target)
          if (total < target) {
            console.log("Retainer missed!")
            //$("#gameTableText").append(retainer_name + " missed!")
            rowString = `<tr><td class="border-0 defaultText text-left"> ${retainer_name} missed!</td></tr>`
            $("#combatTableBody").append(rowString)
          } else if (total == target) {
            console.log("hit but 0 damage.  This still kills one minion")
            minions.numCur --
            console.log("num of minions is now: " + minions.numCur)
            rowString = `<tr><td class="border-0 defaultText text-left"> ${retainer_name} killed 1</td></tr>`
            $("#combatTableBody").append(rowString)
            
            
            $("#npcParagraph").html("Your Opponent: <strong>" + minions.numCur + " " + minions.name + "!!!</strong>")
            
            updateMinion()
          } else {
            damage = (total - target) + retainer_dmg_bonus
            console.log("damage: " + damage)
            // now check the level difference to see how many minions are killed
            let num = Math.floor(damage / minions.level)
            console.log("number killed: " + num)
            if (num > 0) {
              if (num > minions.numCur) {
                num = minions.numCur
              }
              minions.numCur -= num
              console.log("num of minions is now: " + minions.numCur)
              rowString = `<tr><td class="border-0 defaultText text-left"> ${retainer_name} killed ${num} </td></tr>`
              $("#combatTableBody").append(rowString)
              
              $("#npcParagraph").html("Your Opponent: <strong>" + minions.numCur + " " + minions.name + "!!!</strong>")
              
              
              updateMinion()
            } else {
              minions.numCur --
              console.log("num of minions is now: " + minions.numCur)
              rowString = `<tr><td class="border-0 defaultText text-left"> ${retainer_name} killed 1 </td></tr>`
              $("#combatTableBody").append(rowString)
              
              $("#npcParagraph").html("Your Opponent: <strong>" + minions.numCur + " " + minions.name + "!!!</strong>")
              
              
              updateMinion()
            }
          }
        }
        if (minions.numCur < 1) {
          console.log("At the end of the retainer loop there are no more minions")
          $("#npcParagraph").html("You have defeated: <strong>" + minions.numStart + " " + minions.name + "!!!</strong>")

          playerCharacter.status = "alive"

          if (minions.treasureRolls < 1) {
            $("#gameTableText").append("<br>Unfortunatly these minions have no treasure.")
          } else {
            console.log("get treasure")
            $("#gameTableText").append("<br>You find: <br>")
            for (let i = 0; i < minions.treasureRolls; i++) {
              let treasureText = rollTreasure(0)
              $("#gameTableText").append(treasureText + "<br>")
            }
          }
          let rowString = `
            <div class="d-flex mt-2">
              <button onclick="rollJourneyTable()" data-id="rollJourneyBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
              <i class="mt-2"></i>
              Journey On
            </button>
            </div>`
          $("#gameButtons").html(rowString)
          return
        }
      }) 
    }
    
    function minionsAttack(round) {
      // each minion attacks a different character in the PC group
      
      // use a counter for the number of attacks
      // say 5 minions and only 2 PCs:
      // loop through PCs
      //   first loop = 5 - 2 = 3
      //   second loop = 3 - 2 = 1
      //   third loop = 1 - 2 = 1
      
      // This way, the player character's paladin will always take the majority of the attacks, which is as it should be.
      
      // however, I can randomize the attacks too.  We'll see how it goes.
      
      console.log("global var: numMinions = " + numMinions)
      console.log("num of minions: " + minions.numCur)
      let numOfMinions = minions.numCur
      let counter = 0
      
      let continueAttack = true
      let numDead = 0
      let totalNum = retainers.length + 1
      console.log("total number of PC group: " + totalNum)
      if (numOfMinions < 1) {
        console.log("no minions are alive to fight.")
        return
      }
      if (numDead >= totalNum) {
        console.log("The player's entire party is dead or out of action.")
        return
      }
      while (continueAttack) {
        
        if (numOfMinions < 1) {
          console.log("all minions have gone")
          continueAttack = false
          return
        }
        counter++
        console.log("num of minions: " + numOfMinions)
        console.log("minion counter: " +  counter)
        // one minion attacks the player character
        numOfMinions--
        console.log("num of minions to attack is now: " + numOfMinions)
        

        //if (playerCharacter.status == "alive") {
          // The difference in level adjusts the "to hit" value.
          let pcLevel = playerCharacter.level
          let minionLevel = minions.level
          console.log("player character level: " + playerCharacter.level)
          console.log("minion level: " + minions.level)
          let attackMod = minions.level - playerCharacter.level
          console.log(minions.name + " attack mod is: " + attackMod)
        
          let roll1 = rollDie(6)
          let roll2 = rollDie(6)
          let twoD6 = roll1 + roll2
          let damage = 0
          console.log("Minion: " + counter + " attacks the player character --> roll 2d6: " + roll1 + " + " + roll2 + " = " + twoD6)
        
          let total = (twoD6 + attackMod)
          console.log("total (2d6 + attack modifier): " + total)
        
          // "target" should default to: 7
          let target = minions.attack
          console.log("minion target number: " + target)
        
          if (total < target) {
            console.log("minion missed!")
            rowString = `<tr><td class="border-0 defaultText text-left"> * ${minions.name} #${counter} attacked ${playerCharacter.name} but missed!</td></tr>`
            $("#combatTableBody").append(rowString)
          } else {
            console.log("minion hit the PC")
            console.log("minion damage mod: " + minions.dmg_mod)
            let dmg = total - target
            console.log("dmg = " + total + " - " + target + " = " + dmg)
            dmg += minions.dmg_mod
            console.log("dmg + minions.dmg_mod = " + dmg)
          
            // subtract PC's armor (if any)
            console.log("PC armor: " + playerCharacter.armor)
            dmg = dmg - playerCharacter.armor
            console.log("dmg is now: " + dmg)
            if (dmg < 1) {
              rowString = `<tr><td class="border-0 defaultText text-left">* ${minions.name} #${counter} hits ${playerCharacter.name} for 0 damage!</td></tr>`
              $("#combatTableBody").append(rowString)
            } else {
              console.log("PC was hit for " + dmg)
              playerCharacter.cur_hp = playerCharacter.cur_hp - dmg
              updateNavbar()

              rowString = `<tr><td class="border-0 defaultText text-left">* ${minions.name} #${counter} hits ${playerCharacter.name} for <span class="rounded" style="padding: 2px; background-color: red">${dmg}</span> damage!</td></tr>`
              $("#combatTableBody").append(rowString)
            
              // check to see if the pc is alive, knocked out or dead
              if (playerCharacter.cur_hp < 6 && playerCharacter.cur_hp > 0) {
                // PC is knocked out
                round = 0
                console.log("PC is alive but knocked out")
                $("#npcParagraph").append('<p>' + playerCharacter.name + ' has been knocked out! You had best start praying!</p>')
                // To do: it is possible that the PCs minions can save the day
                // but if there are no retainers, roll to see if the PC has to start over
                //if (retainers.length < 1) {

                  continueAttack = false
                  let roll = rollDie(6)
                  if (roll > 3) {
                    // PC lives to fight another day and wakes up at an inn
                    $("#npcParagraph").append(`<br><br>${minions.name} leave ${playerCharacter.name} for dead... but he lives!<br>`)
                    btnString = `
                      <div class="d-flex mt-2 justify-content-around">
                      <button onclick="rollInnTable()" data-id="rollInnBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                        <i class="mt-2"></i>
                        Go to Inn
                      </button>
                      </div>`
                    $("#gameButtons").html(btnString)
                  } else {
                    // The evil minions kill the helpless PC.  Game over man...
                    playerCharacter.alive = false
                    updateNavbar()
                    $("#npcParagraph").empty()
                    $("#npcParagraph").html('<p>' + playerCharacter.name + ' has been slain by ' + minions.name + '!<br>  May God have mercy on your soul. <br><br>REQVIESCAT IN PACE</p>')
                    rowString = `
                      <div class="d-flex mt-2">
                      <button onclick="startNewGame()" data-id="startNewGameBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                        <i class="mt-2"></i>
                        Start New Game
                      </button>
                      </div>`
                    $("#gameButtons").html(rowString)
                  }
                //} else {
                  // minions can save the day here?

                //}
              }
              if (playerCharacter.cur_hp < 1) {
                continueAttack = false
                round = 0
                // pc is dead!
                playerCharacter.status = "dead"
                console.log("PC has died")
                $("#storyDivHead").empty()
                $("#npcParagraph").empty()
                $("#npcParagraph").html('<p>' + playerCharacter.name + ' has been slain by ' + minions.name + '!<br>  May God have mercy on your soul. <br><br>REQVIESCAT IN PACE</p>')
                rowString = `
                  <div class="d-flex mt-2">
                  <button onclick="startNewGame()" data-id="startNewGameBtn" type="button" class="btn btn-dark rounded-pill mx-2 btn-sm">
                    <i class="mt-2"></i>
                    Start New Game
                  </button>
                  </div>`
                $("#gameButtons").html(rowString)
              }
              updateNavbar()
            } 
          }
        //}
        
        
        if (!continueAttack) return
        if (numOfMinions < 1) {
          console.log("all minions have gone")
          continueAttack = false
          return
        }
        
        
        
        // loop through retainers
        // minions attack each retainer
        
        if (retainers.length < 1) {
          // no retainers to fight
          console.log("no retainers")
        } else {
          retainers.forEach(function(key, value) {
            if (retainers.length > 0) {
              // attack retainers
              if (numOfMinions < 1) {
                console.log("no minions left to attack retainers")
                continueAttack = false
                //break
              } else {
                if (key.alive) {
                  counter++
                  numOfMinions--
                  console.log("  -- now retainers --")
                  console.log("counter is now: " + counter)
                  // The difference in level adjusts the "to hit" value.
                  let retainerLevel = key.level
                  let minionLevel = minions.level
                  console.log("Retainer (" + key.name + ") level: " + retainerLevel)
                  console.log("minion level: " + minions.level)
                  let attackMod = retainerLevel - minions.level
                  console.log(key.name + " attack mod is: " + attackMod)
                  let roll1 = rollDie(6)
                  let roll2 = rollDie(6)
                  let twoD6 = roll1 + roll2
                  let damage = 0
                  console.log("Minion: " + counter + " attacks " + key.name + " --> roll 2d6: " + roll1 + " + " + roll2 + " = " + twoD6)
                  let total = (twoD6 + attackMod)
                  console.log("total (2d6 + attack modifier): " + total)
                  // "target" should default to: 7
                  let target = minions.attack
                  console.log("minion target number: " + target)
                  if (total < target) {
                    console.log("minion missed!")
                    rowString = `<tr><td class="border-0 defaultText text-left">* ${minions.name} #${counter} attacked ${key.name} but missed!</td></tr>`
                    $("#combatTableBody").append(rowString)
                  } else {
                    console.log("minion hit " + key.name)
                    console.log("minion damage mod: " + minions.dmg_mod)
                    let dmg = total - target
                    console.log("dmg = " + total + " - " + target + " = " + dmg)
                    dmg += minions.dmg_mod
                    console.log("dmg + minions.dmg_mod = " + dmg)
                    // subtract PC's armor (if any)
                    console.log("Retainer armor: " + key.armor_bonus)
                    dmg = dmg - key.armor_bonus
                    console.log("dmg is now: " + dmg)
                    if (dmg < 1) {
                      rowString = `<tr><td class="border-0 defaultText text-left">* ${minions.name} #${counter} hits ${key.name} for 0 damage!</td></tr>`
                      $("#combatTableBody").append(rowString)
                    } else {
                      console.log(key.name +" was hit for " + dmg)
                      key.cur_hp = key.cur_hp - dmg
                      rowString = `<tr><td class="border-0 defaultText text-left">* ${minions.name} #${counter} hits ${key.name} for <span class="rounded" style="padding: 2px; background-color: red">${dmg}</span> damage!</td></tr>`
                      $("#combatTableBody").append(rowString)
                      // check to see if the retainer is alive or dead
                      if (key.cur_hp < 1) {
                        key.alive = false
                        numDead++
                        $("#npcParagraph").append(key.name + " has been killed!")
                        // remove the retainer from the array
                        retainers = $.grep(retainers, function(e) {
                          return e.name != key.name
                        })
                      }
                    }
                  }
                }
              }
            }
            
            //counter++
          })
        }
        
        if (counter > 500) {
          continueAttack = false
          alert("infinite loop detected")
        }
      }
      
    }
    // -----------------------------------------------------
    // end minion combat - multiple combatants per side
    // -----------------------------------------------------
    
    
    // -----------------------------------------------------
    // treasure tables
    // -----------------------------------------------------
    
    function rollTreasure(modifier) {
      let silver = 0
      let treasureText = ""
      
      let roll = rollDie(6) + modifier
      switch(roll) {
        case 1: 
          silver = rollDie(6)
          treasureText = silver + " silver pieces"
          playerCharacter.money += silver
          updateNavbar()
        break;
        case 2: 
          silver = rollDie(6)
          silver += rollDie(6)
          treasureText = silver + " silver pieces"
          playerCharacter.money += silver
          updateNavbar()
        break;
        case 3: 
          silver = rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          treasureText = silver + " silver pieces"
          playerCharacter.money += silver
          updateNavbar()
        break;
        case 4: 
          silver = rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver = silver * 2
          treasureText = "Silver Cutlery and Goblets worth " + silver + " silver pieces"
          // To do: add this to the inventory.
          // for now, just convert to silver and add to the player's total
          playerCharacter.money += silver
          updateNavbar()
        break;
        case 5: 
          silver = rollDie(6)
          silver += rollDie(6)
          silver = silver * 5
          treasureText = "Gold Jewelry worth " + silver + " silver pieces"
          // To do: add this to the inventory.
          // for now, just convert to silver and add to the player's total
          playerCharacter.money += silver
          updateNavbar()
        break;
        default:
          // roll on the rare item table
          treasureText = rollRareItems()
        break;
      }
      return treasureText
    }
    
    function rollRareItems() {
      let silver = 0
      let treasureText = ""
      
      let roll = rollDie(6)
      switch(roll) {
        case 1: 
          // apothecary stuff
          silver = rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver = silver * 5
          treasureText = "Apothecary materials worth " + silver + " silver pieces AND a potion of healing!"
          // To do: add this to the inventory.
          // for now, just convert to silver and add to the player's total
          playerCharacter.healingPotions++
          playerCharacter.money += silver
          updateNavbar()
        break;
        case 2: 
          silver = rollDie(6)
          silver += rollDie(6)
          silver = silver * 10
          treasureText = "Rolls of silk and velvet worth " + silver + " silver pieces"
          // To do: add this to the inventory.
          // for now, just convert to silver and add to the player's total
          playerCharacter.money += silver
          updateNavbar()
        break;
        case 3: 
          silver = rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver = silver * 10
          treasureText = "Jars of Saffron spice worth " + silver + " silver pieces"
          // To do: add this to the inventory.
          // for now, just convert to silver and add to the player's total
          playerCharacter.money += silver
          updateNavbar()
        break;
        case 4: 
          silver = rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver = silver * 10
          treasureText = "Relic of a Saint worth " + silver + " silver pieces"
          // To do: add this to the inventory.
          // for now, just convert to silver and add to the player's total
          playerCharacter.money += silver
          updateNavbar()
        break;
        case 5: 
          silver = rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver = silver * 10
          treasureText = "Fragment of the True Cross worth " + silver + " silver pieces"
          // To do: add this to the inventory.
          // for now, just convert to silver and add to the player's total
          playerCharacter.money += silver
          updateNavbar()
        break;
        case 6: 
          silver = rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver += rollDie(6)
          silver = silver * 10
          treasureText = "Spear of Longinus and " + silver + " silver pieces"
          // To do: add this to the inventory.
          // for now, just convert to silver and add to the player's total
          playerCharacter.money += silver
          updateNavbar()
        break;
      }
      
      return treasureText
    }
    
    // -----------------------------------------------------
    // end treasure tables
    // -----------------------------------------------------
    

    // -----------------------------------------------------
    // XP Roll
    // -----------------------------------------------------

    function xpRoll() {
      let roll = rollDie(6)
      if (roll > playerCharacter.level) {
        console.log("player gained a level")
        playerCharacter.level++
        let hpRoll1 = rollDie(6)
        let hpRoll2 = rollDie(6)
        playerCharacter.max_hp = playerCharacter.max_hp + hpRoll1 + hpRoll2
        playerCharacter.cur_hp = playerCharacter.max_hp
        updateNavbar()
        return true
      } else {
        console.log("player did not gain a level")
        return false
      }
    }

    // -----------------------------------------------------
    // End XP Roll
    // -----------------------------------------------------


    
  </script>

</body>

</html>
